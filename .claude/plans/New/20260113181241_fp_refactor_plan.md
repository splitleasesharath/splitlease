# Functional Programming Refactoring Plan

Date: 2026-01-13
Target: agents/20260113181241_fp_audit_violations.json
Severity Filter: high

~~~~~

## CHUNK 1: Fix Using mutating array method in FullscreenProposalMapModal.jsx

**File:** app/src/islands/modals/FullscreenProposalMapModal.jsx
**Line:** 357
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    mapProposals.forEach(proposal => {
      const marker = createProposalPriceMarker(map, proposal, handlePinClick);
      markersRef.current.push(marker);
      bounds.extend({ lat: proposal.coordinates.lat, lng: proposal.coordinates.lng });
    });
```

**Refactored Code:**
```javascript
    mapProposals.forEach(proposal => {
      const marker = createProposalPriceMarker(map, proposal, handlePinClick);
      current = [...current, marker];
      bounds.extend({ lat: proposal.coordinates.lat, lng: proposal.coordinates.lng });
    });
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 2: Fix Using mutating array sort/reverse in ListingsCard.jsx

**File:** app/src/islands/pages/AccountProfilePage/components/cards/ListingsCard.jsx
**Line:** 18
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** /account-profile

**Current Code:**
```javascript
  const photos = listing.listing_photo || [];
  // Sort photos by order and get the primary one
  const sortedPhotos = [...photos].sort((a, b) => (a.Order || 0) - (b.Order || 0));
  const primaryPhoto = sortedPhotos[0];
  const photoUrl = primaryPhoto?.url || null;
```

**Refactored Code:**
```javascript
  const photos = listing.listing_photo || [];
  // Sort photos by order and get the primary one
  const sortedPhotos = [...photos].toSorted((a, b) => (a.Order || 0) - (b.Order || 0));

  const primaryPhoto = sortedPhotos[0];
  const photoUrl = primaryPhoto?.url || null;
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 3: Fix Using mutating array sort/reverse in ScheduleCommuteCard.jsx

**File:** app/src/islands/pages/AccountProfilePage/components/cards/ScheduleCommuteCard.jsx
**Line:** 38
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** /account-profile

**Current Code:**
```javascript
  // Get selected day names for display
  const selectedDayNames = selectedDays
    .sort((a, b) => a - b)
    .map(idx => DAY_NAMES[idx])
    .join(', ');
```

**Refactored Code:**
```javascript
  // Get selected day names for display
  const selectedDayNames = selectedDays
    .toSorted((a, b) => a - b)

    .map(idx => DAY_NAMES[idx])
    .join(', ');
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 4: Fix Using mutating array method in useAccountProfilePageLogic.js

**File:** app/src/islands/pages/AccountProfilePage/useAccountProfilePageLogic.js
**Line:** 99
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /account-profile

**Current Code:**
```javascript

  if (!profileData?.profilePhoto) {
    actions.push({
      id: 'photo',
      text: 'Add a profile photo',
```

**Refactored Code:**
```javascript

  if (!profileData?.profilePhoto) {
    // TODO: Refactor mutation to declarative
    // actions.push({
      id: 'photo',
      text: 'Add a profile photo',
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 5: Fix Using mutating array method in useAccountProfilePageLogic.js

**File:** app/src/islands/pages/AccountProfilePage/useAccountProfilePageLogic.js
**Line:** 107
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /account-profile

**Current Code:**
```javascript
  }
  if (!verifications?.govId) {
    actions.push({
      id: 'govId',
      text: 'Verify your identity',
```

**Refactored Code:**
```javascript
  }
  if (!verifications?.govId) {
    // TODO: Refactor mutation to declarative
    // actions.push({
      id: 'govId',
      text: 'Verify your identity',
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 6: Fix Using mutating array method in useAccountProfilePageLogic.js

**File:** app/src/islands/pages/AccountProfilePage/useAccountProfilePageLogic.js
**Line:** 115
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /account-profile

**Current Code:**
```javascript
  }
  if (!verifications?.linkedin) {
    actions.push({
      id: 'linkedin',
      text: 'Connect your LinkedIn',
```

**Refactored Code:**
```javascript
  }
  if (!verifications?.linkedin) {
    // TODO: Refactor mutation to declarative
    // actions.push({
      id: 'linkedin',
      text: 'Connect your LinkedIn',
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 7: Fix Using mutating array method in useAccountProfilePageLogic.js

**File:** app/src/islands/pages/AccountProfilePage/useAccountProfilePageLogic.js
**Line:** 123
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /account-profile

**Current Code:**
```javascript
  }
  if (!profileData?.bio || profileData.bio.trim().length === 0) {
    actions.push({
      id: 'bio',
      text: 'Write a short bio',
```

**Refactored Code:**
```javascript
  }
  if (!profileData?.bio || profileData.bio.trim().length === 0) {
    // TODO: Refactor mutation to declarative
    // actions.push({
      id: 'bio',
      text: 'Write a short bio',
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 8: Fix Using mutating array method in useAccountProfilePageLogic.js

**File:** app/src/islands/pages/AccountProfilePage/useAccountProfilePageLogic.js
**Line:** 131
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /account-profile

**Current Code:**
```javascript
  }
  if (!verifications?.phone) {
    actions.push({
      id: 'phone',
      text: 'Verify your phone number',
```

**Refactored Code:**
```javascript
  }
  if (!verifications?.phone) {
    // TODO: Refactor mutation to declarative
    // actions.push({
      id: 'phone',
      text: 'Verify your phone number',
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 9: Fix Using mutating array sort/reverse in useAccountProfilePageLogic.js

**File:** app/src/islands/pages/AccountProfilePage/useAccountProfilePageLogic.js
**Line:** 718
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** /account-profile

**Current Code:**
```javascript
      const newDays = currentDays.includes(dayIndex)
        ? currentDays.filter(d => d !== dayIndex)
        : [...currentDays, dayIndex].sort((a, b) => a - b);

      return { ...prev, selectedDays: newDays };
```

**Refactored Code:**
```javascript
      const newDays = currentDays.includes(dayIndex)
        ? currentDays.filter(d => d !== dayIndex)
        : [...currentDays, [...dayIndex]].sort((a, b) => a - b);


      return { ...prev, selectedDays: newDays };
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 10: Fix Using mutating array method in useAccountProfilePageLogic.js

**File:** app/src/islands/pages/AccountProfilePage/useAccountProfilePageLogic.js
**Line:** 964
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /account-profile

**Current Code:**
```javascript

      // Generate unique filename with timestamp to avoid cache issues
      const fileExtension = file.name.split('.').pop()?.toLowerCase() || 'jpg';
      const fileName = `avatar_${Date.now()}.${fileExtension}`;
      const filePath = `${authUserId}/${fileName}`;
```

**Refactored Code:**
```javascript

      // Generate unique filename with timestamp to avoid cache issues
      // TODO: Fix ViolationType.MUTATING_METHOD
      const fileExtension = file.name.split('.').pop()?.toLowerCase() || 'jpg';

      const fileName = `avatar_${Date.now()}.${fileExtension}`;
      const filePath = `${authUserId}/${fileName}`;
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 11: Fix Imperative loop found (consider map/filter/reduce) in FAQPage.jsx

**File:** app/src/islands/pages/FAQPage.jsx
**Line:** 77
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

      data.forEach(faq => {
        for (const [tabName, dbCategory] of Object.entries(categoryMapping)) {
          if (faq.Category === dbCategory) {
            grouped[tabName].push(faq);
```

**Refactored Code:**
```javascript

      data.forEach(faq => {
        // TODO: Refactor imperative loop to .map() or .reduce()
        for (const [tabName, dbCategory] of Object.entries(categoryMapping)) {

          if (faq.Category === dbCategory) {
            grouped[tabName].push(faq);
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 12: Fix Using mutating array method in FAQPage.jsx

**File:** app/src/islands/pages/FAQPage.jsx
**Line:** 79
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
        for (const [tabName, dbCategory] of Object.entries(categoryMapping)) {
          if (faq.Category === dbCategory) {
            grouped[tabName].push(faq);
            break;
          }
```

**Refactored Code:**
```javascript
        for (const [tabName, dbCategory] of Object.entries(categoryMapping)) {
          if (faq.Category === dbCategory) {
            // TODO: Refactor mutation to declarative
            // grouped[tabName].push(faq);
            break;
          }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 13: Fix Using mutating array method in FAQPage.jsx

**File:** app/src/islands/pages/FAQPage.jsx
**Line:** 356
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      faqsBySubCategory[subCat] = [];
    }
    faqsBySubCategory[subCat].push(faq);
  });
```

**Refactored Code:**
```javascript
      faqsBySubCategory[subCat] = [];
    }
    // TODO: Refactor mutation to declarative
    // faqsBySubCategory[subCat].push(faq);
  });
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 14: Fix Using mutating array method in FavoriteListingsPage.jsx

**File:** app/src/islands/pages/FavoriteListingsPage/FavoriteListingsPage.jsx
**Line:** 529
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /favorite-listings

**Current Code:**
```javascript

    const locationParts = [];
    if (neighborhoodName) locationParts.push(neighborhoodName);
    if (boroughName) locationParts.push(boroughName);
    const location = locationParts.join(', ') || 'New York, NY';
```

**Refactored Code:**
```javascript

    const locationParts = [];
    locationParts = [...locationParts, neighborhoodName];
    if (boroughName) locationParts.push(boroughName);
    const location = locationParts.join(', ') || 'New York, NY';
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 15: Fix Using mutating array method in FavoriteListingsPage.jsx

**File:** app/src/islands/pages/FavoriteListingsPage/FavoriteListingsPage.jsx
**Line:** 530
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /favorite-listings

**Current Code:**
```javascript
    const locationParts = [];
    if (neighborhoodName) locationParts.push(neighborhoodName);
    if (boroughName) locationParts.push(boroughName);
    const location = locationParts.join(', ') || 'New York, NY';
```

**Refactored Code:**
```javascript
    const locationParts = [];
    if (neighborhoodName) locationParts.push(neighborhoodName);
    locationParts = [...locationParts, boroughName];
    const location = locationParts.join(', ') || 'New York, NY';
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 16: Fix Using mutating array sort/reverse in FavoriteListingsPage.jsx

**File:** app/src/islands/pages/FavoriteListingsPage/FavoriteListingsPage.jsx
**Line:** 1022
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** /favorite-listings

**Current Code:**
```javascript

      // Sort days in JS format first to detect wrap-around (Saturday/Sunday spanning)
      const sortedJsDays = [...daysInJsFormat].sort((a, b) => a - b);

      // Check for wrap-around case (both Saturday=6 and Sunday=0 present, but not all 7 days)
```

**Refactored Code:**
```javascript

      // Sort days in JS format first to detect wrap-around (Saturday/Sunday spanning)
      const sortedJsDays = [...daysInJsFormat].toSorted((a, b) => a - b);


      // Check for wrap-around case (both Saturday=6 and Sunday=0 present, but not all 7 days)
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 17: Fix Imperative loop found (consider map/filter/reduce) in FavoriteListingsPage.jsx

**File:** app/src/islands/pages/FavoriteListingsPage/FavoriteListingsPage.jsx
**Line:** 1034
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** /favorite-listings

**Current Code:**
```javascript
        // Find the gap in the sorted selection to determine wrap-around point
        let gapIndex = -1;
        for (let i = 0; i < sortedJsDays.length - 1; i++) {
          if (sortedJsDays[i + 1] - sortedJsDays[i] > 1) {
            gapIndex = i + 1;
```

**Refactored Code:**
```javascript
        // Find the gap in the sorted selection to determine wrap-around point
        let gapIndex = -1;
        // TODO: Refactor imperative loop to .map() or .reduce()
        for (let i = 0; i < sortedJsDays.length - 1; i++) {

          if (sortedJsDays[i + 1] - sortedJsDays[i] > 1) {
            gapIndex = i + 1;
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 18: Fix Using mutating array method in FavoriteListingsPage.jsx

**File:** app/src/islands/pages/FavoriteListingsPage/FavoriteListingsPage.jsx
**Line:** 1248
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /favorite-listings

**Current Code:**
```javascript
      const rootDesktop = createRoot(mountPointDesktop);
      rootDesktop.render(<AuthAwareSearchScheduleSelector {...selectorProps} />);
      roots.push(rootDesktop);
    }
```

**Refactored Code:**
```javascript
      const rootDesktop = createRoot(mountPointDesktop);
      rootDesktop.render(<AuthAwareSearchScheduleSelector {...selectorProps} />);
      roots = [...roots, rootDesktop];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 19: Fix Using mutating array method in FavoriteListingsPage.jsx

**File:** app/src/islands/pages/FavoriteListingsPage/FavoriteListingsPage.jsx
**Line:** 1254
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /favorite-listings

**Current Code:**
```javascript
      const rootMobile = createRoot(mountPointMobile);
      rootMobile.render(<AuthAwareSearchScheduleSelector {...selectorProps} />);
      roots.push(rootMobile);
    }
```

**Refactored Code:**
```javascript
      const rootMobile = createRoot(mountPointMobile);
      rootMobile.render(<AuthAwareSearchScheduleSelector {...selectorProps} />);
      roots = [...roots, rootMobile];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 20: Fix Using mutating array method in MapView.jsx

**File:** app/src/islands/pages/FavoriteListingsPage/components/MapView.jsx
**Line:** 83
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /favorite-listings

**Current Code:**
```javascript

      const position = [lat, lng];
      bounds.push(position);

      // Create custom price pin HTML
```

**Refactored Code:**
```javascript

      const position = [lat, lng];
      bounds = [...bounds, position];

      // Create custom price pin HTML
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 21: Fix Using mutating array method in MapView.jsx

**File:** app/src/islands/pages/FavoriteListingsPage/components/MapView.jsx
**Line:** 126
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /favorite-listings

**Current Code:**
```javascript
      marker.bindPopup(popupHtml);

      markersRef.current.push(marker);
    });
```

**Refactored Code:**
```javascript
      marker.bindPopup(popupHtml);

      current = [...current, marker];
    });
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 22: Fix Imperative loop found (consider map/filter/reduce) in SplitScheduleSelector.jsx

**File:** app/src/islands/pages/FavoriteListingsPage/components/SplitScheduleSelector.jsx
**Line:** 49
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** /favorite-listings

**Current Code:**
```javascript
    const current = new Date(checkIn);

    while (current < checkOut) {
      days.push(current.getDay());
      current.setDate(current.getDate() + 1);
```

**Refactored Code:**
```javascript
    const current = new Date(checkIn);

    // TODO: Refactor while loop to recursive function or declarative method
    while (current < checkOut) {

      days.push(current.getDay());
      current.setDate(current.getDate() + 1);
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 23: Fix Using mutating array method in SplitScheduleSelector.jsx

**File:** app/src/islands/pages/FavoriteListingsPage/components/SplitScheduleSelector.jsx
**Line:** 50
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /favorite-listings

**Current Code:**
```javascript

    while (current < checkOut) {
      days.push(current.getDay());
      current.setDate(current.getDate() + 1);
    }
```

**Refactored Code:**
```javascript

    while (current < checkOut) {
      days = [...days, current.getDay()];
      current.setDate(current.getDate() + 1);
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 24: Fix Using mutating array sort/reverse in SplitScheduleSelector.jsx

**File:** app/src/islands/pages/FavoriteListingsPage/components/SplitScheduleSelector.jsx
**Line:** 55
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** /favorite-listings

**Current Code:**
```javascript

    // Remove duplicates
    const uniqueDays = Array.from(new Set(days)).sort((a, b) => a - b);
    setSelectedDays(uniqueDays);
```

**Refactored Code:**
```javascript

    // Remove duplicates
    const uniqueDays = Array.from(new [...Set(days))].sort((a, b) => a - b);

    setSelectedDays(uniqueDays);
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 25: Fix Using mutating array sort/reverse in SplitScheduleSelector.jsx

**File:** app/src/islands/pages/FavoriteListingsPage/components/SplitScheduleSelector.jsx
**Line:** 77
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** /favorite-listings

**Current Code:**
```javascript
      newSelectedDays = selectedDays.filter(d => d !== dayIndex);
    } else {
      newSelectedDays = [...selectedDays, dayIndex].sort((a, b) => a - b);
    }
```

**Refactored Code:**
```javascript
      newSelectedDays = selectedDays.filter(d => d !== dayIndex);
    } else {
      newSelectedDays = [...selectedDays, [...dayIndex]].sort((a, b) => a - b);

    }
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 26: Fix Using mutating array method in formatters.js

**File:** app/src/islands/pages/FavoriteListingsPage/formatters.js
**Line:** 66
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /favorite-listings

**Current Code:**
```javascript
  // CONDITIONAL 1: When bedrooms = 1
  if (bedrooms === 1) {
    parts.push('1 bedroom');
  }
  // CONDITIONAL 3: When bedrooms > 1
```

**Refactored Code:**
```javascript
  // CONDITIONAL 1: When bedrooms = 1
  if (bedrooms === 1) {
    parts = [...parts, '1 bedroom'];
  }
  // CONDITIONAL 3: When bedrooms > 1
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 27: Fix Using mutating array method in formatters.js

**File:** app/src/islands/pages/FavoriteListingsPage/formatters.js
**Line:** 70
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /favorite-listings

**Current Code:**
```javascript
  // CONDITIONAL 3: When bedrooms > 1
  else if (bedrooms > 1) {
    parts.push(`${bedrooms} bedrooms`);
  }
```

**Refactored Code:**
```javascript
  // CONDITIONAL 3: When bedrooms > 1
  else if (bedrooms > 1) {
    parts = [...parts, `${bedrooms} bedrooms`];
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 28: Fix Using mutating array method in formatters.js

**File:** app/src/islands/pages/FavoriteListingsPage/formatters.js
**Line:** 76
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /favorite-listings

**Current Code:**
```javascript
  if (bathrooms > 0) {
    const bathroomDisplay = getBathroomDisplay(bathrooms);
    parts.push(bathroomDisplay);
  }
```

**Refactored Code:**
```javascript
  if (bathrooms > 0) {
    const bathroomDisplay = getBathroomDisplay(bathrooms);
    parts = [...parts, bathroomDisplay];
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 29: Fix Using mutating array method in formatters.js

**File:** app/src/islands/pages/FavoriteListingsPage/formatters.js
**Line:** 81
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /favorite-listings

**Current Code:**
```javascript
  // CONDITIONAL 4: Add kitchen type only if provided
  if (kitchenType && kitchenType !== '') {
    parts.push(kitchenType);
  }
```

**Refactored Code:**
```javascript
  // CONDITIONAL 4: Add kitchen type only if provided
  if (kitchenType && kitchenType !== '') {
    parts = [...parts, kitchenType];
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 30: Fix Using mutating array method in formatters.js

**File:** app/src/islands/pages/FavoriteListingsPage/formatters.js
**Line:** 115
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /favorite-listings

**Current Code:**
```javascript
  const parts = [];

  if (borough) parts.push(borough);
  if (hood) parts.push(hood);
  if (city) parts.push(city);
```

**Refactored Code:**
```javascript
  const parts = [];

  parts = [...parts, borough];
  if (hood) parts.push(hood);
  if (city) parts.push(city);
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 31: Fix Using mutating array method in formatters.js

**File:** app/src/islands/pages/FavoriteListingsPage/formatters.js
**Line:** 116
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /favorite-listings

**Current Code:**
```javascript

  if (borough) parts.push(borough);
  if (hood) parts.push(hood);
  if (city) parts.push(city);
```

**Refactored Code:**
```javascript

  if (borough) parts.push(borough);
  parts = [...parts, hood];
  if (city) parts.push(city);
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 32: Fix Using mutating array method in formatters.js

**File:** app/src/islands/pages/FavoriteListingsPage/formatters.js
**Line:** 117
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /favorite-listings

**Current Code:**
```javascript
  if (borough) parts.push(borough);
  if (hood) parts.push(hood);
  if (city) parts.push(city);

  return parts.join(', ');
```

**Refactored Code:**
```javascript
  if (borough) parts.push(borough);
  if (hood) parts.push(hood);
  parts = [...parts, city];

  return parts.join(', ');
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 33: Fix Using mutating array method in HomePage.jsx

**File:** app/src/islands/pages/HomePage.jsx
**Line:** 346
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /

**Current Code:**
```javascript
          const firstPhoto = photos[0];
          if (typeof firstPhoto === 'string') {
            legacyPhotoIds.push(firstPhoto);
          }
        }
```

**Refactored Code:**
```javascript
          const firstPhoto = photos[0];
          if (typeof firstPhoto === 'string') {
            legacyPhotoIds = [...legacyPhotoIds, firstPhoto];
          }
        }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 34: Fix Using mutating array method in useHostOverviewPageLogic.js

**File:** app/src/islands/pages/HostOverviewPage/useHostOverviewPageLogic.js
**Line:** 154
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      // 1. Try Bubble API (only if hostAccountId is available)
      if (hostAccountId) {
        fetchPromises.push(
          supabase.functions.invoke('bubble-proxy', {
            body: {
```

**Refactored Code:**
```javascript
      // 1. Try Bubble API (only if hostAccountId is available)
      if (hostAccountId) {
        // TODO: Refactor mutation to declarative
        // fetchPromises.push(
          supabase.functions.invoke('bubble-proxy', {
            body: {
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 35: Fix Using mutating array method in useHostOverviewPageLogic.js

**File:** app/src/islands/pages/HostOverviewPage/useHostOverviewPageLogic.js
**Line:** 182
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      // Using RPC function to handle column names with special characters
      if (userId) {
        fetchPromises.push(
          supabase
            .rpc('get_host_listings', { host_user_id: userId })
```

**Refactored Code:**
```javascript
      // Using RPC function to handle column names with special characters
      if (userId) {
        // TODO: Refactor mutation to declarative
        // fetchPromises.push(
          supabase
            .rpc('get_host_listings', { host_user_id: userId })
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 36: Fix Using mutating array method in useHostOverviewPageLogic.js

**File:** app/src/islands/pages/HostOverviewPage/useHostOverviewPageLogic.js
**Line:** 198
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      // 3. Fetch listing IDs from user.Listings array
      if (userId) {
        fetchPromises.push(
          supabase
            .from('user')
```

**Refactored Code:**
```javascript
      // 3. Fetch listing IDs from user.Listings array
      if (userId) {
        // TODO: Refactor mutation to declarative
        // fetchPromises.push(
          supabase
            .from('user')
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 37: Fix Imperative loop found (consider map/filter/reduce) in types.js

**File:** app/src/islands/pages/HostProposalsPage/types.js
**Line:** 253
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** /host-proposals

**Current Code:**
```javascript

  // Handle wrapping around the week
  while (current !== checkOutIndex) {
    activeDays.push(dayNames[current]);
    current = (current + 1) % 7;
```

**Refactored Code:**
```javascript

  // Handle wrapping around the week
  // TODO: Refactor while loop to recursive function or declarative method
  while (current !== checkOutIndex) {

    activeDays.push(dayNames[current]);
    current = (current + 1) % 7;
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 38: Fix Using mutating array method in types.js

**File:** app/src/islands/pages/HostProposalsPage/types.js
**Line:** 254
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /host-proposals

**Current Code:**
```javascript
  // Handle wrapping around the week
  while (current !== checkOutIndex) {
    activeDays.push(dayNames[current]);
    current = (current + 1) % 7;
  }
```

**Refactored Code:**
```javascript
  // Handle wrapping around the week
  while (current !== checkOutIndex) {
    activeDays = [...activeDays, dayNames[current]];
    current = (current + 1) % 7;
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 39: Fix Using mutating array sort/reverse in types.js

**File:** app/src/islands/pages/HostProposalsPage/types.js
**Line:** 342
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** /host-proposals

**Current Code:**
```javascript
  if (dayIndices.length === 0) return { checkInDay: '', checkOutDay: '' };

  const sorted = [...dayIndices].sort((a, b) => a - b);

  // Handle wrap-around case (e.g., Fri, Sat, Sun, Mon = [0, 1, 5, 6])
```

**Refactored Code:**
```javascript
  if (dayIndices.length === 0) return { checkInDay: '', checkOutDay: '' };

  const sorted = [...dayIndices].toSorted((a, b) => a - b);


  // Handle wrap-around case (e.g., Fri, Sat, Sun, Mon = [0, 1, 5, 6])
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 40: Fix Imperative loop found (consider map/filter/reduce) in types.js

**File:** app/src/islands/pages/HostProposalsPage/types.js
**Line:** 351
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** /host-proposals

**Current Code:**
```javascript
    // Find gap to determine actual start/end
    let gapIndex = -1;
    for (let i = 1; i < sorted.length; i++) {
      if (sorted[i] !== sorted[i - 1] + 1) {
        gapIndex = i;
```

**Refactored Code:**
```javascript
    // Find gap to determine actual start/end
    let gapIndex = -1;
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let i = 1; i < sorted.length; i++) {

      if (sorted[i] !== sorted[i - 1] + 1) {
        gapIndex = i;
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 41: Fix Using mutating array sort/reverse in types.js

**File:** app/src/islands/pages/HostProposalsPage/types.js
**Line:** 411
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** /host-proposals

**Current Code:**
```javascript
    .map(n => typeof n === 'string' ? parseInt(n, 10) : n)
    .filter(n => !isNaN(n) && n >= 0 && n <= 6)
    .sort((a, b) => a - b);

  if (sortedNights.length === 0) return { checkInDay: '', checkOutDay: '' };
```

**Refactored Code:**
```javascript
    .map(n => typeof n === 'string' ? parseInt(n, 10) : n)
    .filter(n => !isNaN(n) && n >= 0 && n <= 6)
    .toSorted((a, b) => a - b);


  if (sortedNights.length === 0) return { checkInDay: '', checkOutDay: '' };
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 42: Fix Imperative loop found (consider map/filter/reduce) in types.js

**File:** app/src/islands/pages/HostProposalsPage/types.js
**Line:** 423
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** /host-proposals

**Current Code:**
```javascript
    // Find the gap to determine actual start/end
    let gapIndex = -1;
    for (let i = 1; i < sortedNights.length; i++) {
      if (sortedNights[i] !== sortedNights[i - 1] + 1) {
        gapIndex = i;
```

**Refactored Code:**
```javascript
    // Find the gap to determine actual start/end
    let gapIndex = -1;
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let i = 1; i < sortedNights.length; i++) {

      if (sortedNights[i] !== sortedNights[i - 1] + 1) {
        gapIndex = i;
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 43: Fix Using mutating array sort/reverse in useHostProposalsPageLogic.js

**File:** app/src/islands/pages/HostProposalsPage/useHostProposalsPageLogic.js
**Line:** 266
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** /host-proposals

**Current Code:**
```javascript

        // Sort listings: most recent proposal first, then by proposal count
        const sortedListings = [...listingsResult].sort((a, b) => {
          const aId = a._id || a.id;
          const bId = b._id || b.id;
```

**Refactored Code:**
```javascript

        // Sort listings: most recent proposal first, then by proposal count
        const sortedListings = [...listingsResult].toSorted((a, b) => {

          const aId = a._id || a.id;
          const bId = b._id || b.id;
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 44: Fix Imperative loop found (consider map/filter/reduce) in ListWithUsPage.jsx

**File:** app/src/islands/pages/ListWithUsPage.jsx
**Line:** 27
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

    const prices = [Math.ceil(nightlyBaseRate)];
    for (let i = 1; i < 7; i++) {
      prices.push(Math.ceil(prices[i - 1] * clampedDecay));
    }
```

**Refactored Code:**
```javascript

    const prices = [Math.ceil(nightlyBaseRate)];
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let i = 1; i < 7; i++) {

      prices.push(Math.ceil(prices[i - 1] * clampedDecay));
    }
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 45: Fix Using mutating array method in ListWithUsPage.jsx

**File:** app/src/islands/pages/ListWithUsPage.jsx
**Line:** 28
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    const prices = [Math.ceil(nightlyBaseRate)];
    for (let i = 1; i < 7; i++) {
      prices.push(Math.ceil(prices[i - 1] * clampedDecay));
    }
    return prices;
```

**Refactored Code:**
```javascript
    const prices = [Math.ceil(nightlyBaseRate)];
    for (let i = 1; i < 7; i++) {
      prices = [...prices, Math.ceil(prices[i - 1] * clampedDecay)];
    }
    return prices;
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 46: Fix Imperative loop found (consider map/filter/reduce) in AvailabilitySection.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/AvailabilitySection.jsx
**Line:** 45
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript

  const current = new Date(start);
  while (current <= end) {
    dates.push(formatDateKey(current));
    current.setDate(current.getDate() + 1);
```

**Refactored Code:**
```javascript

  const current = new Date(start);
  // TODO: Refactor while loop to recursive function or declarative method
  while (current <= end) {

    dates.push(formatDateKey(current));
    current.setDate(current.getDate() + 1);
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 47: Fix Using mutating array method in AvailabilitySection.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/AvailabilitySection.jsx
**Line:** 46
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript
  const current = new Date(start);
  while (current <= end) {
    dates.push(formatDateKey(current));
    current.setDate(current.getDate() + 1);
  }
```

**Refactored Code:**
```javascript
  const current = new Date(start);
  while (current <= end) {
    dates = [...dates, formatDateKey(current)];
    current.setDate(current.getDate() + 1);
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 48: Fix Imperative loop found (consider map/filter/reduce) in AvailabilitySection.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/AvailabilitySection.jsx
**Line:** 106
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript
    const prevMonthYear = prevMonth.getFullYear();
    const prevMonthMonth = prevMonth.getMonth();
    for (let i = startPadding - 1; i >= 0; i--) {
      const dayNum = prevMonth.getDate() - i;
      const date = new Date(prevMonthYear, prevMonthMonth, dayNum);
```

**Refactored Code:**
```javascript
    const prevMonthYear = prevMonth.getFullYear();
    const prevMonthMonth = prevMonth.getMonth();
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let i = startPadding - 1; i >= 0; i--) {

      const dayNum = prevMonth.getDate() - i;
      const date = new Date(prevMonthYear, prevMonthMonth, dayNum);
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 49: Fix Using mutating array method in AvailabilitySection.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/AvailabilitySection.jsx
**Line:** 109
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript
      const dayNum = prevMonth.getDate() - i;
      const date = new Date(prevMonthYear, prevMonthMonth, dayNum);
      days.push({
        day: dayNum,
        isCurrentMonth: false,
```

**Refactored Code:**
```javascript
      const dayNum = prevMonth.getDate() - i;
      const date = new Date(prevMonthYear, prevMonthMonth, dayNum);
      // TODO: Refactor mutation to declarative
      // days.push({
        day: dayNum,
        isCurrentMonth: false,
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 50: Fix Imperative loop found (consider map/filter/reduce) in AvailabilitySection.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/AvailabilitySection.jsx
**Line:** 118
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript

    // Current month days
    for (let i = 1; i <= daysInMonth; i++) {
      const date = new Date(year, month, i);
      days.push({
```

**Refactored Code:**
```javascript

    // Current month days
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let i = 1; i <= daysInMonth; i++) {

      const date = new Date(year, month, i);
      days.push({
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 51: Fix Using mutating array method in AvailabilitySection.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/AvailabilitySection.jsx
**Line:** 120
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript
    for (let i = 1; i <= daysInMonth; i++) {
      const date = new Date(year, month, i);
      days.push({
        day: i,
        isCurrentMonth: true,
```

**Refactored Code:**
```javascript
    for (let i = 1; i <= daysInMonth; i++) {
      const date = new Date(year, month, i);
      // TODO: Refactor mutation to declarative
      // days.push({
        day: i,
        isCurrentMonth: true,
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 52: Fix Imperative loop found (consider map/filter/reduce) in AvailabilitySection.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/AvailabilitySection.jsx
**Line:** 132
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript
    const nextMonthYear = month === 11 ? year + 1 : year;
    const nextMonthMonth = month === 11 ? 0 : month + 1;
    for (let i = 1; i <= remaining; i++) {
      const date = new Date(nextMonthYear, nextMonthMonth, i);
      days.push({
```

**Refactored Code:**
```javascript
    const nextMonthYear = month === 11 ? year + 1 : year;
    const nextMonthMonth = month === 11 ? 0 : month + 1;
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let i = 1; i <= remaining; i++) {

      const date = new Date(nextMonthYear, nextMonthMonth, i);
      days.push({
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 53: Fix Using mutating array method in AvailabilitySection.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/AvailabilitySection.jsx
**Line:** 134
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript
    for (let i = 1; i <= remaining; i++) {
      const date = new Date(nextMonthYear, nextMonthMonth, i);
      days.push({
        day: i,
        isCurrentMonth: false,
```

**Refactored Code:**
```javascript
    for (let i = 1; i <= remaining; i++) {
      const date = new Date(nextMonthYear, nextMonthMonth, i);
      // TODO: Refactor mutation to declarative
      // days.push({
        day: i,
        isCurrentMonth: false,
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 54: Fix Using mutating array sort/reverse in AvailabilitySection.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/AvailabilitySection.jsx
**Line:** 242
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript
    return blockedDates
      .filter((dateKey) => dateKey >= todayKey)
      .sort();
  }, [blockedDates]);
```

**Refactored Code:**
```javascript
    return blockedDates
      .filter((dateKey) => dateKey >= todayKey)
      .toSorted();

  }, [blockedDates]);
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 55: Fix Using mutating array sort/reverse in AvailabilitySection.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/AvailabilitySection.jsx
**Line:** 253
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript
    return blockedDates
      .filter((dateKey) => dateKey < todayKey)
      .sort()
      .reverse(); // Most recent past dates first
  }, [blockedDates]);
```

**Refactored Code:**
```javascript
    return blockedDates
      .filter((dateKey) => dateKey < todayKey)
      .toSorted()

      .reverse(); // Most recent past dates first
  }, [blockedDates]);
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 56: Fix Using mutating array sort/reverse in AvailabilitySection.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/AvailabilitySection.jsx
**Line:** 254
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript
      .filter((dateKey) => dateKey < todayKey)
      .sort()
      .reverse(); // Most recent past dates first
  }, [blockedDates]);
```

**Refactored Code:**
```javascript
      .filter((dateKey) => dateKey < todayKey)
      .sort()
      .toReversed(); // Most recent past dates first

  }, [blockedDates]);
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 57: Fix Imperative loop found (consider map/filter/reduce) in NightlyPricingLegend.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/NightlyPricingLegend.jsx
**Line:** 26
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript
  // Get the range of nights to display (from min to max)
  const nightsRange = [];
  for (let i = nightsPerWeekMin; i <= nightsPerWeekMax; i++) {
    nightsRange.push(i);
  }
```

**Refactored Code:**
```javascript
  // Get the range of nights to display (from min to max)
  const nightsRange = [];
  // TODO: Refactor imperative loop to .map() or .reduce()
  for (let i = nightsPerWeekMin; i <= nightsPerWeekMax; i++) {

    nightsRange.push(i);
  }
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 58: Fix Using mutating array method in NightlyPricingLegend.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/NightlyPricingLegend.jsx
**Line:** 27
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript
  const nightsRange = [];
  for (let i = nightsPerWeekMin; i <= nightsPerWeekMax; i++) {
    nightsRange.push(i);
  }
```

**Refactored Code:**
```javascript
  const nightsRange = [];
  for (let i = nightsPerWeekMin; i <= nightsPerWeekMax; i++) {
    nightsRange = [...nightsRange, i];
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 59: Fix Using mutating array method in PricingEditSection.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/PricingEditSection.jsx
**Line:** 326
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript
    // Check lease style change
    if (selectedRentalType !== originalLeaseStyle) {
      changes.push(`Lease style: ${originalLeaseStyle}  ${selectedRentalType}`);
    }
```

**Refactored Code:**
```javascript
    // Check lease style change
    if (selectedRentalType !== originalLeaseStyle) {
      changes = [...changes, `Lease style: ${originalLeaseStyle}  ${selectedRentalType}`];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 60: Fix Using mutating array method in PricingEditSection.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/PricingEditSection.jsx
**Line:** 331
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript
    // Check common fields
    if (damageDeposit !== (listing?.damageDeposit || 500)) {
      changes.push(`Damage deposit: $${listing?.damageDeposit || 500}  $${damageDeposit}`);
    }
    if (maintenanceFee !== (listing?.maintenanceFee || 125)) {
```

**Refactored Code:**
```javascript
    // Check common fields
    if (damageDeposit !== (listing?.damageDeposit || 500)) {
      changes = [...changes, `Damage deposit: $${listing?.damageDeposit || 500}  $${damageDeposit}`];
    }
    if (maintenanceFee !== (listing?.maintenanceFee || 125)) {
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 61: Fix Using mutating array method in PricingEditSection.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/PricingEditSection.jsx
**Line:** 334
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript
    }
    if (maintenanceFee !== (listing?.maintenanceFee || 125)) {
      changes.push(`Maintenance fee: $${listing?.maintenanceFee || 125}  $${maintenanceFee}`);
    }
```

**Refactored Code:**
```javascript
    }
    if (maintenanceFee !== (listing?.maintenanceFee || 125)) {
      changes = [...changes, `Maintenance fee: $${listing?.maintenanceFee || 125}  $${maintenanceFee}`];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 62: Fix Using mutating array method in PricingEditSection.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/PricingEditSection.jsx
**Line:** 342
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript
      if (selectedNights.length !== originalNights.length ||
          !selectedNights.every((n) => originalNights.includes(n))) {
        changes.push(`Available nights updated (${selectedNights.length} nights)`);
      }
      if (minNights !== (listing?.nightsPerWeekMin || 2) ||
```

**Refactored Code:**
```javascript
      if (selectedNights.length !== originalNights.length ||
          !selectedNights.every((n) => originalNights.includes(n))) {
        changes = [...changes, `Available nights updated (${selectedNights.length} nights)`];
      }
      if (minNights !== (listing?.nightsPerWeekMin || 2) ||
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 63: Fix Using mutating array method in PricingEditSection.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/PricingEditSection.jsx
**Line:** 346
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript
      if (minNights !== (listing?.nightsPerWeekMin || 2) ||
          maxNights !== (listing?.nightsPerWeekMax || 7)) {
        changes.push(`Nights range: ${minNights}-${maxNights}`);
      }
      // Check if any pricing changed
```

**Refactored Code:**
```javascript
      if (minNights !== (listing?.nightsPerWeekMin || 2) ||
          maxNights !== (listing?.nightsPerWeekMax || 7)) {
        changes = [...changes, `Nights range: ${minNights}-${maxNights}`];
      }
      // Check if any pricing changed
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 64: Fix Using mutating array method in PricingEditSection.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/PricingEditSection.jsx
**Line:** 354
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript
      );
      if (pricingChanged) {
        changes.push('Nightly rates updated');
      }
    } else if (selectedRentalType === 'Weekly') {
```

**Refactored Code:**
```javascript
      );
      if (pricingChanged) {
        changes = [...changes, 'Nightly rates updated'];
      }
    } else if (selectedRentalType === 'Weekly') {
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 65: Fix Using mutating array method in PricingEditSection.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/PricingEditSection.jsx
**Line:** 358
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript
    } else if (selectedRentalType === 'Weekly') {
      if (weeklyRate !== (listing?.weeklyHostRate || 0)) {
        changes.push(`Weekly rate: $${weeklyRate}/week`);
      }
      if (weeksOffered !== (listing?.weeksOffered || '')) {
```

**Refactored Code:**
```javascript
    } else if (selectedRentalType === 'Weekly') {
      if (weeklyRate !== (listing?.weeklyHostRate || 0)) {
        changes = [...changes, `Weekly rate: $${weeklyRate}/week`];
      }
      if (weeksOffered !== (listing?.weeksOffered || '')) {
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 66: Fix Using mutating array method in PricingEditSection.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/PricingEditSection.jsx
**Line:** 367
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript
          'custom': 'Custom',
        };
        changes.push(`Weekly pattern: ${patternLabels[weeksOffered] || weeksOffered}`);
      }
    } else if (selectedRentalType === 'Monthly') {
```

**Refactored Code:**
```javascript
          'custom': 'Custom',
        };
        changes = [...changes, `Weekly pattern: ${patternLabels[weeksOffered] || weeksOffered}`];
      }
    } else if (selectedRentalType === 'Monthly') {
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 67: Fix Using mutating array method in PricingEditSection.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/PricingEditSection.jsx
**Line:** 371
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript
    } else if (selectedRentalType === 'Monthly') {
      if (monthlyRate !== (listing?.monthlyHostRate || 0)) {
        changes.push(`Monthly rate: $${monthlyRate}/month`);
      }
    }
```

**Refactored Code:**
```javascript
    } else if (selectedRentalType === 'Monthly') {
      if (monthlyRate !== (listing?.monthlyHostRate || 0)) {
        changes = [...changes, `Monthly rate: $${monthlyRate}/month`];
      }
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 68: Fix Using mutating array sort/reverse in PricingEditSection.jsx

**File:** app/src/islands/pages/ListingDashboardPage/components/PricingEditSection.jsx
**Line:** 408
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript
          saturday: 6,
        };
        const dayIndices = selectedNights.map((n) => nightMap[n]).sort((a, b) => a - b);
        updates['Days Available (List of Days)'] = JSON.stringify(dayIndices);
```

**Refactored Code:**
```javascript
          saturday: 6,
        };
        const dayIndices = selectedNights.map((n) => [...nightMap[n])].sort((a, b) => a - b);

        updates['Days Available (List of Days)'] = JSON.stringify(dayIndices);
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 69: Fix Imperative loop found (consider map/filter/reduce) in useListingDashboardPageLogic.js

**File:** app/src/islands/pages/ListingDashboardPage/useListingDashboardPageLogic.js
**Line:** 920
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript
    // Transform updates to use correct database column names
    const dbUpdates = {};
    for (const [key, value] of Object.entries(updates)) {
      const dbColumnName = fieldMapping[key] || key;
      dbUpdates[dbColumnName] = value;
```

**Refactored Code:**
```javascript
    // Transform updates to use correct database column names
    const dbUpdates = {};
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (const [key, value] of Object.entries(updates)) {

      const dbColumnName = fieldMapping[key] || key;
      dbUpdates[dbColumnName] = value;
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 70: Fix Using mutating array method in useListingDashboardPageLogic.js

**File:** app/src/islands/pages/ListingDashboardPage/useListingDashboardPageLogic.js
**Line:** 1269
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript

    // Put selected photo at the beginning
    newPhotos.unshift(selectedPhoto);

    // Update local state immediately for responsive UI
```

**Refactored Code:**
```javascript

    // Put selected photo at the beginning
    // TODO: Fix ViolationType.MUTATING_METHOD
    newPhotos.unshift(selectedPhoto);


    // Update local state immediately for responsive UI
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 71: Fix Imperative loop found (consider map/filter/reduce) in useListingDashboardPageLogic.js

**File:** app/src/islands/pages/ListingDashboardPage/useListingDashboardPageLogic.js
**Line:** 1295
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript

      // Update sort order for other photos
      for (let i = 0; i < newPhotos.length; i++) {
        if (newPhotos[i].id !== photoId) {
          await supabase
```

**Refactored Code:**
```javascript

      // Update sort order for other photos
      // TODO: Refactor imperative loop to .map() or .reduce()
      for (let i = 0; i < newPhotos.length; i++) {

        if (newPhotos[i].id !== photoId) {
          await supabase
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 72: Fix Imperative loop found (consider map/filter/reduce) in useListingDashboardPageLogic.js

**File:** app/src/islands/pages/ListingDashboardPage/useListingDashboardPageLogic.js
**Line:** 1338
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** /listing-dashboard

**Current Code:**
```javascript

      // Update the listing_photo table sort orders
      for (let i = 0; i < newPhotos.length; i++) {
        await supabase
          .from('listing_photo')
```

**Refactored Code:**
```javascript

      // Update the listing_photo table sort orders
      // TODO: Refactor imperative loop to .map() or .reduce()
      for (let i = 0; i < newPhotos.length; i++) {

        await supabase
          .from('listing_photo')
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 73: Fix Imperative loop found (consider map/filter/reduce) in PreviewSplitLeasePage.jsx

**File:** app/src/islands/pages/PreviewSplitLeasePage.jsx
**Line:** 841
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    // Transform updates to use correct database column names
    const dbUpdates = {};
    for (const [key, value] of Object.entries(updates)) {
      const dbColumnName = fieldMapping[key] || key;
      dbUpdates[dbColumnName] = value;
```

**Refactored Code:**
```javascript
    // Transform updates to use correct database column names
    const dbUpdates = {};
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (const [key, value] of Object.entries(updates)) {

      const dbColumnName = fieldMapping[key] || key;
      dbUpdates[dbColumnName] = value;
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 74: Fix Imperative loop found (consider map/filter/reduce) in rentalApplicationFieldMapper.ts

**File:** app/src/islands/pages/RentalApplicationPage/utils/rentalApplicationFieldMapper.ts
**Line:** 401
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  const completed: number[] = [];

  for (let step = 1; step <= 7; step++) {
    if (isStepComplete(step, formData, occupants, employmentStatus)) {
      completed.push(step);
```

**Refactored Code:**
```javascript
  const completed: number[] = [];

  // TODO: Refactor imperative loop to .map() or .reduce()
  for (let step = 1; step <= 7; step++) {

    if (isStepComplete(step, formData, occupants, employmentStatus)) {
      completed.push(step);
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 75: Fix Using mutating array method in rentalApplicationFieldMapper.ts

**File:** app/src/islands/pages/RentalApplicationPage/utils/rentalApplicationFieldMapper.ts
**Line:** 403
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  for (let step = 1; step <= 7; step++) {
    if (isStepComplete(step, formData, occupants, employmentStatus)) {
      completed.push(step);
    }
  }
```

**Refactored Code:**
```javascript
  for (let step = 1; step <= 7; step++) {
    if (isStepComplete(step, formData, occupants, employmentStatus)) {
      completed = [...completed, step];
    }
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 76: Fix Using mutating array sort/reverse in SearchPage.jsx

**File:** app/src/islands/pages/SearchPage.jsx
**Line:** 89
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** /search

**Current Code:**
```javascript

  if (selectedDaysArray.length >= 2) {
    const sortedDays = [...selectedDaysArray].sort((a, b) => a - b);
    const hasSaturday = sortedDays.includes(6);
    const hasSunday = sortedDays.includes(0);
```

**Refactored Code:**
```javascript

  if (selectedDaysArray.length >= 2) {
    const sortedDays = [...selectedDaysArray].toSorted((a, b) => a - b);

    const hasSaturday = sortedDays.includes(6);
    const hasSunday = sortedDays.includes(0);
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 77: Fix Imperative loop found (consider map/filter/reduce) in SearchPage.jsx

**File:** app/src/islands/pages/SearchPage.jsx
**Line:** 99
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** /search

**Current Code:**
```javascript
      // Find the gap in the sequence to determine actual check-in/check-out
      let gapIndex = -1;
      for (let i = 1; i < sortedDays.length; i++) {
        if (sortedDays[i] - sortedDays[i - 1] > 1) {
          gapIndex = i;
```

**Refactored Code:**
```javascript
      // Find the gap in the sequence to determine actual check-in/check-out
      let gapIndex = -1;
      // TODO: Refactor imperative loop to .map() or .reduce()
      for (let i = 1; i < sortedDays.length; i++) {

        if (sortedDays[i] - sortedDays[i - 1] > 1) {
          gapIndex = i;
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 78: Fix Using mutating array method in SearchPage.jsx

**File:** app/src/islands/pages/SearchPage.jsx
**Line:** 1979
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /search

**Current Code:**
```javascript
    // Build location string with proper formatting
    const locationParts = [];
    if (neighborhoodName) locationParts.push(neighborhoodName);
    if (boroughName) locationParts.push(boroughName);
    const location = locationParts.join(', ') || 'New York, NY';
```

**Refactored Code:**
```javascript
    // Build location string with proper formatting
    const locationParts = [];
    locationParts = [...locationParts, neighborhoodName];
    if (boroughName) locationParts.push(boroughName);
    const location = locationParts.join(', ') || 'New York, NY';
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 79: Fix Using mutating array method in SearchPage.jsx

**File:** app/src/islands/pages/SearchPage.jsx
**Line:** 1980
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /search

**Current Code:**
```javascript
    const locationParts = [];
    if (neighborhoodName) locationParts.push(neighborhoodName);
    if (boroughName) locationParts.push(boroughName);
    const location = locationParts.join(', ') || 'New York, NY';
```

**Refactored Code:**
```javascript
    const locationParts = [];
    if (neighborhoodName) locationParts.push(neighborhoodName);
    locationParts = [...locationParts, boroughName];
    const location = locationParts.join(', ') || 'New York, NY';
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 80: Fix Using mutating array sort/reverse in SearchPage.jsx

**File:** app/src/islands/pages/SearchPage.jsx
**Line:** 2318
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** /search

**Current Code:**
```javascript

      // Sort days in JS format first to detect wrap-around (Saturday/Sunday spanning)
      const sortedJsDays = [...daysInJsFormat].sort((a, b) => a - b);

      // Check for wrap-around case (both Saturday=6 and Sunday=0 present, but not all 7 days)
```

**Refactored Code:**
```javascript

      // Sort days in JS format first to detect wrap-around (Saturday/Sunday spanning)
      const sortedJsDays = [...daysInJsFormat].toSorted((a, b) => a - b);


      // Check for wrap-around case (both Saturday=6 and Sunday=0 present, but not all 7 days)
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 81: Fix Imperative loop found (consider map/filter/reduce) in SearchPage.jsx

**File:** app/src/islands/pages/SearchPage.jsx
**Line:** 2330
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** /search

**Current Code:**
```javascript
        // Find the gap in the sorted selection to determine wrap-around point
        let gapIndex = -1;
        for (let i = 0; i < sortedJsDays.length - 1; i++) {
          if (sortedJsDays[i + 1] - sortedJsDays[i] > 1) {
            gapIndex = i + 1;
```

**Refactored Code:**
```javascript
        // Find the gap in the sorted selection to determine wrap-around point
        let gapIndex = -1;
        // TODO: Refactor imperative loop to .map() or .reduce()
        for (let i = 0; i < sortedJsDays.length - 1; i++) {

          if (sortedJsDays[i + 1] - sortedJsDays[i] > 1) {
            gapIndex = i + 1;
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 82: Fix Using mutating array method in SearchPage.jsx

**File:** app/src/islands/pages/SearchPage.jsx
**Line:** 2632
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /search

**Current Code:**
```javascript
      const rootDesktop = createRoot(mountPointDesktop);
      rootDesktop.render(<AuthAwareSearchScheduleSelector {...selectorProps} />);
      roots.push(rootDesktop);
    }
```

**Refactored Code:**
```javascript
      const rootDesktop = createRoot(mountPointDesktop);
      rootDesktop.render(<AuthAwareSearchScheduleSelector {...selectorProps} />);
      roots = [...roots, rootDesktop];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 83: Fix Using mutating array method in SearchPage.jsx

**File:** app/src/islands/pages/SearchPage.jsx
**Line:** 2638
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /search

**Current Code:**
```javascript
      const rootMobile = createRoot(mountPointMobile);
      rootMobile.render(<AuthAwareSearchScheduleSelector {...selectorProps} />);
      roots.push(rootMobile);
    }
```

**Refactored Code:**
```javascript
      const rootMobile = createRoot(mountPointMobile);
      rootMobile.render(<AuthAwareSearchScheduleSelector {...selectorProps} />);
      roots = [...roots, rootMobile];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 84: Fix Using mutating array method in SearchPageTest.jsx

**File:** app/src/islands/pages/SearchPageTest.jsx
**Line:** 1273
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /search

**Current Code:**
```javascript
    // Build location string with proper formatting
    const locationParts = [];
    if (neighborhoodName) locationParts.push(neighborhoodName);
    if (boroughName) locationParts.push(boroughName);
    const location = locationParts.join(', ') || 'New York, NY';
```

**Refactored Code:**
```javascript
    // Build location string with proper formatting
    const locationParts = [];
    locationParts = [...locationParts, neighborhoodName];
    if (boroughName) locationParts.push(boroughName);
    const location = locationParts.join(', ') || 'New York, NY';
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 85: Fix Using mutating array method in SearchPageTest.jsx

**File:** app/src/islands/pages/SearchPageTest.jsx
**Line:** 1274
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /search

**Current Code:**
```javascript
    const locationParts = [];
    if (neighborhoodName) locationParts.push(neighborhoodName);
    if (boroughName) locationParts.push(boroughName);
    const location = locationParts.join(', ') || 'New York, NY';
```

**Refactored Code:**
```javascript
    const locationParts = [];
    if (neighborhoodName) locationParts.push(neighborhoodName);
    locationParts = [...locationParts, boroughName];
    const location = locationParts.join(', ') || 'New York, NY';
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 86: Fix Using mutating array method in SearchPageTest.jsx

**File:** app/src/islands/pages/SearchPageTest.jsx
**Line:** 1474
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /search

**Current Code:**
```javascript
      const rootDesktop = createRoot(mountPointDesktop);
      rootDesktop.render(<SearchScheduleSelector {...selectorProps} />);
      roots.push(rootDesktop);
    }
```

**Refactored Code:**
```javascript
      const rootDesktop = createRoot(mountPointDesktop);
      rootDesktop.render(<SearchScheduleSelector {...selectorProps} />);
      roots = [...roots, rootDesktop];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 87: Fix Using mutating array method in SearchPageTest.jsx

**File:** app/src/islands/pages/SearchPageTest.jsx
**Line:** 1480
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /search

**Current Code:**
```javascript
      const rootMobile = createRoot(mountPointMobile);
      rootMobile.render(<SearchScheduleSelector {...selectorProps} />);
      roots.push(rootMobile);
    }
```

**Refactored Code:**
```javascript
      const rootMobile = createRoot(mountPointMobile);
      rootMobile.render(<SearchScheduleSelector {...selectorProps} />);
      roots = [...roots, rootMobile];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 88: Fix Imperative loop found (consider map/filter/reduce) in SelfListingPageV2.tsx

**File:** app/src/islands/pages/SelfListingPageV2/SelfListingPageV2.tsx
**Line:** 518
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript

    const prices = [Math.ceil(nightlyBaseRate)];
    for (let i = 1; i < 7; i++) {
      prices.push(Math.ceil(prices[i - 1] * clampedDecay));
    }
```

**Refactored Code:**
```javascript

    const prices = [Math.ceil(nightlyBaseRate)];
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let i = 1; i < 7; i++) {

      prices.push(Math.ceil(prices[i - 1] * clampedDecay));
    }
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 89: Fix Using mutating array method in SelfListingPageV2.tsx

**File:** app/src/islands/pages/SelfListingPageV2/SelfListingPageV2.tsx
**Line:** 519
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    const prices = [Math.ceil(nightlyBaseRate)];
    for (let i = 1; i < 7; i++) {
      prices.push(Math.ceil(prices[i - 1] * clampedDecay));
    }
    nightlyPricesRef.current = prices;
```

**Refactored Code:**
```javascript
    const prices = [Math.ceil(nightlyBaseRate)];
    for (let i = 1; i < 7; i++) {
      prices = [...prices, Math.ceil(prices[i - 1] * clampedDecay)];
    }
    nightlyPricesRef.current = prices;
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 90: Fix Imperative loop found (consider map/filter/reduce) in SelfListingPageV2.tsx

**File:** app/src/islands/pages/SelfListingPageV2/SelfListingPageV2.tsx
**Line:** 526
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    const numNights = formData.selectedNights.length;
    let weeklyTotal = 0;
    for (let i = 0; i < numNights && i < prices.length; i++) {
      weeklyTotal += prices[i];
    }
```

**Refactored Code:**
```javascript
    const numNights = formData.selectedNights.length;
    let weeklyTotal = 0;
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let i = 0; i < numNights && i < prices.length; i++) {

      weeklyTotal += prices[i];
    }
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 91: Fix Imperative loop found (consider map/filter/reduce) in NightlyPriceSlider.tsx

**File:** app/src/islands/pages/SelfListingPage/components/NightlyPriceSlider.tsx
**Line:** 70
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript

    const prices: number[] = [roundUp(baseRate)];
    for (let i = 1; i < N; i++) {
      prices.push(roundUp(prices[i - 1] * decay));
    }
```

**Refactored Code:**
```javascript

    const prices: number[] = [roundUp(baseRate)];
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let i = 1; i < N; i++) {

      prices.push(roundUp(prices[i - 1] * decay));
    }
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 92: Fix Using mutating array method in NightlyPriceSlider.tsx

**File:** app/src/islands/pages/SelfListingPage/components/NightlyPriceSlider.tsx
**Line:** 71
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    const prices: number[] = [roundUp(baseRate)];
    for (let i = 1; i < N; i++) {
      prices.push(roundUp(prices[i - 1] * decay));
    }
```

**Refactored Code:**
```javascript
    const prices: number[] = [roundUp(baseRate)];
    for (let i = 1; i < N; i++) {
      prices = [...prices, roundUp(prices[i - 1] * decay)];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 93: Fix Using mutating array method in Section1SpaceSnapshot.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section1SpaceSnapshot.tsx
**Line:** 291
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    if (!data.listingName || data.listingName.trim().length === 0) {
      newErrors.listingName = 'Listing name is required';
      errorOrder.push('listingName');
    } else if (data.listingName.length > 35) {
      newErrors.listingName = 'Listing name must be 35 characters or less';
```

**Refactored Code:**
```javascript
    if (!data.listingName || data.listingName.trim().length === 0) {
      newErrors.listingName = 'Listing name is required';
      errorOrder = [...errorOrder, 'listingName'];
    } else if (data.listingName.length > 35) {
      newErrors.listingName = 'Listing name must be 35 characters or less';
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 94: Fix Using mutating array method in Section1SpaceSnapshot.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section1SpaceSnapshot.tsx
**Line:** 294
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    } else if (data.listingName.length > 35) {
      newErrors.listingName = 'Listing name must be 35 characters or less';
      errorOrder.push('listingName');
    }
```

**Refactored Code:**
```javascript
    } else if (data.listingName.length > 35) {
      newErrors.listingName = 'Listing name must be 35 characters or less';
      errorOrder = [...errorOrder, 'listingName'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 95: Fix Using mutating array method in Section1SpaceSnapshot.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section1SpaceSnapshot.tsx
**Line:** 299
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    if (!data.typeOfSpace) {
      newErrors.typeOfSpace = 'Type of space is required';
      errorOrder.push('typeOfSpace');
    }
```

**Refactored Code:**
```javascript
    if (!data.typeOfSpace) {
      newErrors.typeOfSpace = 'Type of space is required';
      errorOrder = [...errorOrder, 'typeOfSpace'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 96: Fix Using mutating array method in Section1SpaceSnapshot.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section1SpaceSnapshot.tsx
**Line:** 304
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    if (!data.bedrooms || data.bedrooms < 0) {
      newErrors.bedrooms = 'Number of bedrooms is required';
      errorOrder.push('bedrooms');
    }
```

**Refactored Code:**
```javascript
    if (!data.bedrooms || data.bedrooms < 0) {
      newErrors.bedrooms = 'Number of bedrooms is required';
      errorOrder = [...errorOrder, 'bedrooms'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 97: Fix Using mutating array method in Section1SpaceSnapshot.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section1SpaceSnapshot.tsx
**Line:** 309
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    if (!data.typeOfKitchen) {
      newErrors.typeOfKitchen = 'Type of kitchen is required';
      errorOrder.push('typeOfKitchen');
    }
```

**Refactored Code:**
```javascript
    if (!data.typeOfKitchen) {
      newErrors.typeOfKitchen = 'Type of kitchen is required';
      errorOrder = [...errorOrder, 'typeOfKitchen'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 98: Fix Using mutating array method in Section1SpaceSnapshot.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section1SpaceSnapshot.tsx
**Line:** 314
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    if (!data.typeOfParking) {
      newErrors.typeOfParking = 'Type of parking is required';
      errorOrder.push('typeOfParking');
    }
```

**Refactored Code:**
```javascript
    if (!data.typeOfParking) {
      newErrors.typeOfParking = 'Type of parking is required';
      errorOrder = [...errorOrder, 'typeOfParking'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 99: Fix Using mutating array method in Section1SpaceSnapshot.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section1SpaceSnapshot.tsx
**Line:** 319
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    if (!data.bathrooms || data.bathrooms < 0) {
      newErrors.bathrooms = 'Number of bathrooms is required';
      errorOrder.push('bathrooms');
    }
```

**Refactored Code:**
```javascript
    if (!data.bathrooms || data.bathrooms < 0) {
      newErrors.bathrooms = 'Number of bathrooms is required';
      errorOrder = [...errorOrder, 'bathrooms'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 100: Fix Using mutating array method in Section1SpaceSnapshot.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section1SpaceSnapshot.tsx
**Line:** 325
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
      setAddressError('Listing address is required');
      newErrors.address = 'Address is required';
      errorOrder.push('fullAddress');
    } else if (!isAddressValid && !showManualAddress) {
      setAddressError('Please select a valid address from the dropdown or enter manually');
```

**Refactored Code:**
```javascript
      setAddressError('Listing address is required');
      newErrors.address = 'Address is required';
      errorOrder = [...errorOrder, 'fullAddress'];
    } else if (!isAddressValid && !showManualAddress) {
      setAddressError('Please select a valid address from the dropdown or enter manually');
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 101: Fix Using mutating array method in Section1SpaceSnapshot.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section1SpaceSnapshot.tsx
**Line:** 329
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
      setAddressError('Please select a valid address from the dropdown or enter manually');
      newErrors.address = 'Address validation required';
      errorOrder.push('fullAddress');
    }
```

**Refactored Code:**
```javascript
      setAddressError('Please select a valid address from the dropdown or enter manually');
      newErrors.address = 'Address validation required';
      errorOrder = [...errorOrder, 'fullAddress'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 102: Fix Using mutating array method in Section1SpaceSnapshot.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section1SpaceSnapshot.tsx
**Line:** 334
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    if (showManualAddress && !data.address.state) {
      newErrors.state = 'State is required when entering address manually';
      errorOrder.push('state');
    }
```

**Refactored Code:**
```javascript
    if (showManualAddress && !data.address.state) {
      newErrors.state = 'State is required when entering address manually';
      errorOrder = [...errorOrder, 'state'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 103: Fix Using mutating array method in Section2Features.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section2Features.tsx
**Line:** 207
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    if (data.amenitiesInsideUnit.length === 0) {
      newErrors.amenitiesInsideUnit = 'At least one amenity inside unit is required';
      errorOrder.push('amenitiesInsideUnit');
    }
```

**Refactored Code:**
```javascript
    if (data.amenitiesInsideUnit.length === 0) {
      newErrors.amenitiesInsideUnit = 'At least one amenity inside unit is required';
      errorOrder = [...errorOrder, 'amenitiesInsideUnit'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 104: Fix Using mutating array method in Section2Features.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section2Features.tsx
**Line:** 212
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    if (!data.descriptionOfLodging || data.descriptionOfLodging.trim().length === 0) {
      newErrors.descriptionOfLodging = 'Description of lodging is required';
      errorOrder.push('descriptionOfLodging');
    }
```

**Refactored Code:**
```javascript
    if (!data.descriptionOfLodging || data.descriptionOfLodging.trim().length === 0) {
      newErrors.descriptionOfLodging = 'Description of lodging is required';
      errorOrder = [...errorOrder, 'descriptionOfLodging'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 105: Fix Using mutating array method in Section3LeaseStyles.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section3LeaseStyles.tsx
**Line:** 132
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    if (data.rentalType === 'Weekly' && !data.weeklyPattern) {
      newErrors.weeklyPattern = 'Please select a weekly pattern';
      errorOrder.push('weeklyPattern');
    }
```

**Refactored Code:**
```javascript
    if (data.rentalType === 'Weekly' && !data.weeklyPattern) {
      newErrors.weeklyPattern = 'Please select a weekly pattern';
      errorOrder = [...errorOrder, 'weeklyPattern'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 106: Fix Using mutating array method in Section3LeaseStyles.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section3LeaseStyles.tsx
**Line:** 137
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    if (data.rentalType === 'Monthly' && !data.subsidyAgreement) {
      newErrors.subsidyAgreement = 'You must agree to the subsidy terms for monthly rentals';
      errorOrder.push('subsidyAgreement');
    }
```

**Refactored Code:**
```javascript
    if (data.rentalType === 'Monthly' && !data.subsidyAgreement) {
      newErrors.subsidyAgreement = 'You must agree to the subsidy terms for monthly rentals';
      errorOrder = [...errorOrder, 'subsidyAgreement'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 107: Fix Using mutating array method in Section4Pricing.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section4Pricing.tsx
**Line:** 50
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
      if (!data.monthlyCompensation || data.monthlyCompensation <= 0) {
        newErrors.monthlyCompensation = 'Monthly compensation is required';
        errorOrder.push('monthlyCompensation');
      }
    } else if (rentalType === 'Weekly') {
```

**Refactored Code:**
```javascript
      if (!data.monthlyCompensation || data.monthlyCompensation <= 0) {
        newErrors.monthlyCompensation = 'Monthly compensation is required';
        errorOrder = [...errorOrder, 'monthlyCompensation'];
      }
    } else if (rentalType === 'Weekly') {
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 108: Fix Using mutating array method in Section4Pricing.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section4Pricing.tsx
**Line:** 55
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
      if (!data.weeklyCompensation || data.weeklyCompensation <= 0) {
        newErrors.weeklyCompensation = 'Weekly compensation is required';
        errorOrder.push('weeklyCompensation');
      }
    } else if (rentalType === 'Nightly') {
```

**Refactored Code:**
```javascript
      if (!data.weeklyCompensation || data.weeklyCompensation <= 0) {
        newErrors.weeklyCompensation = 'Weekly compensation is required';
        errorOrder = [...errorOrder, 'weeklyCompensation'];
      }
    } else if (rentalType === 'Nightly') {
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 109: Fix Using mutating array method in Section4Pricing.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section4Pricing.tsx
**Line:** 60
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
      if (!data.nightlyPricing || data.nightlyPricing.oneNightPrice <= 0) {
        newErrors.nightlyPricing = '1-night price is required';
        errorOrder.push('nightlyPricing');
      }
    }
```

**Refactored Code:**
```javascript
      if (!data.nightlyPricing || data.nightlyPricing.oneNightPrice <= 0) {
        newErrors.nightlyPricing = '1-night price is required';
        errorOrder = [...errorOrder, 'nightlyPricing'];
      }
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 110: Fix Using mutating array method in Section4Pricing.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section4Pricing.tsx
**Line:** 67
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    if (data.damageDeposit < 500) {
      newErrors.damageDeposit = 'Damage deposit must be at least $500';
      errorOrder.push('damageDeposit');
    }
```

**Refactored Code:**
```javascript
    if (data.damageDeposit < 500) {
      newErrors.damageDeposit = 'Damage deposit must be at least $500';
      errorOrder = [...errorOrder, 'damageDeposit'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 111: Fix Imperative loop found (consider map/filter/reduce) in Section5Rules.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section5Rules.tsx
**Line:** 103
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript

    const current = new Date(start);
    while (current <= end) {
      dates.push(new Date(current));
      current.setDate(current.getDate() + 1);
```

**Refactored Code:**
```javascript

    const current = new Date(start);
    // TODO: Refactor while loop to recursive function or declarative method
    while (current <= end) {

      dates.push(new Date(current));
      current.setDate(current.getDate() + 1);
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 112: Fix Using mutating array method in Section5Rules.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section5Rules.tsx
**Line:** 104
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    const current = new Date(start);
    while (current <= end) {
      dates.push(new Date(current));
      current.setDate(current.getDate() + 1);
    }
```

**Refactored Code:**
```javascript
    const current = new Date(start);
    while (current <= end) {
      dates = [...dates, new Date(current)];
      current.setDate(current.getDate() + 1);
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 113: Fix Imperative loop found (consider map/filter/reduce) in Section5Rules.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section5Rules.tsx
**Line:** 141
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript

    // Add empty cells for days before the first day of the month
    for (let i = 0; i < startingDayOfWeek; i++) {
      days.push(null);
    }
```

**Refactored Code:**
```javascript

    // Add empty cells for days before the first day of the month
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let i = 0; i < startingDayOfWeek; i++) {

      days.push(null);
    }
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 114: Fix Using mutating array method in Section5Rules.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section5Rules.tsx
**Line:** 142
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    // Add empty cells for days before the first day of the month
    for (let i = 0; i < startingDayOfWeek; i++) {
      days.push(null);
    }
```

**Refactored Code:**
```javascript
    // Add empty cells for days before the first day of the month
    for (let i = 0; i < startingDayOfWeek; i++) {
      days = [...days, null];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 115: Fix Imperative loop found (consider map/filter/reduce) in Section5Rules.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section5Rules.tsx
**Line:** 146
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript

    // Add days of the month
    for (let d = 1; d <= daysInMonth; d++) {
      days.push(new Date(year, month, d));
    }
```

**Refactored Code:**
```javascript

    // Add days of the month
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let d = 1; d <= daysInMonth; d++) {

      days.push(new Date(year, month, d));
    }
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 116: Fix Using mutating array method in Section5Rules.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section5Rules.tsx
**Line:** 147
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    // Add days of the month
    for (let d = 1; d <= daysInMonth; d++) {
      days.push(new Date(year, month, d));
    }
```

**Refactored Code:**
```javascript
    // Add days of the month
    for (let d = 1; d <= daysInMonth; d++) {
      days = [...days, new Date(year, month, d)];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 117: Fix Using mutating array method in Section5Rules.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section5Rules.tsx
**Line:** 178
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    if (!data.cancellationPolicy) {
      newErrors.cancellationPolicy = 'Cancellation policy is required';
      errorOrder.push('cancellationPolicy');
    }
```

**Refactored Code:**
```javascript
    if (!data.cancellationPolicy) {
      newErrors.cancellationPolicy = 'Cancellation policy is required';
      errorOrder = [...errorOrder, 'cancellationPolicy'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 118: Fix Using mutating array method in Section5Rules.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section5Rules.tsx
**Line:** 183
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    if (data.idealMinDuration < 6) {
      newErrors.idealMinDuration = 'Minimum duration must be at least 6 weeks';
      errorOrder.push('idealMinDuration');
    }
```

**Refactored Code:**
```javascript
    if (data.idealMinDuration < 6) {
      newErrors.idealMinDuration = 'Minimum duration must be at least 6 weeks';
      errorOrder = [...errorOrder, 'idealMinDuration'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 119: Fix Using mutating array method in Section5Rules.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section5Rules.tsx
**Line:** 188
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    if (data.idealMaxDuration > 52) {
      newErrors.idealMaxDuration = 'Maximum duration cannot exceed 52 weeks';
      errorOrder.push('idealMaxDuration');
    }
```

**Refactored Code:**
```javascript
    if (data.idealMaxDuration > 52) {
      newErrors.idealMaxDuration = 'Maximum duration cannot exceed 52 weeks';
      errorOrder = [...errorOrder, 'idealMaxDuration'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 120: Fix Using mutating array method in Section5Rules.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section5Rules.tsx
**Line:** 194
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
      newErrors.idealMaxDuration = 'Maximum duration must be greater than or equal to minimum';
      if (!errorOrder.includes('idealMaxDuration')) {
        errorOrder.push('idealMaxDuration');
      }
    }
```

**Refactored Code:**
```javascript
      newErrors.idealMaxDuration = 'Maximum duration must be greater than or equal to minimum';
      if (!errorOrder.includes('idealMaxDuration')) {
        errorOrder = [...errorOrder, 'idealMaxDuration'];
      }
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 121: Fix Using mutating array method in Section6Photos.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section6Photos.tsx
**Line:** 48
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
  index: number
): Promise<{ url: string; storagePath: string }> {
  const extension = file.name.split('.').pop()?.toLowerCase() || 'jpg';
  const timestamp = Date.now();
  const filename = `${index}_${timestamp}.${extension}`;
```

**Refactored Code:**
```javascript
  index: number
): Promise<{ url: string; storagePath: string }> {
  // TODO: Fix ViolationType.MUTATING_METHOD
  const extension = file.name.split('.').pop()?.toLowerCase() || 'jpg';

  const timestamp = Date.now();
  const filename = `${index}_${timestamp}.${extension}`;
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 122: Fix Using mutating array method in Section6Photos.tsx

**File:** app/src/islands/pages/SelfListingPage/sections/Section6Photos.tsx
**Line:** 266
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    if (data.photos.length < data.minRequired) {
      newErrors.photos = `Please upload at least ${data.minRequired} photos`;
      errorOrder.push('photos');
    }
```

**Refactored Code:**
```javascript
    if (data.photos.length < data.minRequired) {
      newErrors.photos = `Please upload at least ${data.minRequired} photos`;
      errorOrder = [...errorOrder, 'photos'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 123: Fix Using mutating array sort/reverse in listingLocalStore.ts

**File:** app/src/islands/pages/SelfListingPage/store/listingLocalStore.ts
**Line:** 198
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    const completedSections = new Set(this.state.data.completedSections);
    completedSections.add(section);
    this.state.data.completedSections = Array.from(completedSections).sort();
    this.scheduleAutoSave();
    this.notifyListeners();
```

**Refactored Code:**
```javascript
    const completedSections = new Set(this.state.data.completedSections);
    completedSections.add(section);
    this.state.data.completedSections = [...Array.from(completedSections)].sort();

    this.scheduleAutoSave();
    this.notifyListeners();
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 124: Fix Using mutating array method in listingLocalStore.ts

**File:** app/src/islands/pages/SelfListingPage/store/listingLocalStore.ts
**Line:** 254
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    } catch (error) {
      console.error(' ListingLocalStore: Error saving draft:', error);
      this.state.errors.push('Failed to save draft');
      this.notifyListeners();
      return false;
```

**Refactored Code:**
```javascript
    } catch (error) {
      console.error(' ListingLocalStore: Error saving draft:', error);
      errors = [...errors, 'Failed to save draft'];
      this.notifyListeners();
      return false;
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 125: Fix Using mutating array method in listingLocalStore.ts

**File:** app/src/islands/pages/SelfListingPage/store/listingLocalStore.ts
**Line:** 364
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
  markSubmissionFailed(error: string): void {
    this.state.stagingStatus = 'failed';
    this.state.errors.push(error);
    console.error(' ListingLocalStore: Submission failed:', error);
    this.notifyListeners();
```

**Refactored Code:**
```javascript
  markSubmissionFailed(error: string): void {
    this.state.stagingStatus = 'failed';
    errors = [...errors, error];
    console.error(' ListingLocalStore: Submission failed:', error);
    this.notifyListeners();
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 126: Fix Using mutating array method in listingLocalStore.ts

**File:** app/src/islands/pages/SelfListingPage/store/listingLocalStore.ts
**Line:** 387
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    // Section 1: Space Snapshot
    if (!data.spaceSnapshot.listingName) {
      errors.push('Listing name is required');
    }
    if (!data.spaceSnapshot.typeOfSpace) {
```

**Refactored Code:**
```javascript
    // Section 1: Space Snapshot
    if (!data.spaceSnapshot.listingName) {
      errors = [...errors, 'Listing name is required'];
    }
    if (!data.spaceSnapshot.typeOfSpace) {
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 127: Fix Using mutating array method in listingLocalStore.ts

**File:** app/src/islands/pages/SelfListingPage/store/listingLocalStore.ts
**Line:** 390
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    }
    if (!data.spaceSnapshot.typeOfSpace) {
      errors.push('Type of space is required');
    }
    if (!data.spaceSnapshot.typeOfKitchen) {
```

**Refactored Code:**
```javascript
    }
    if (!data.spaceSnapshot.typeOfSpace) {
      errors = [...errors, 'Type of space is required'];
    }
    if (!data.spaceSnapshot.typeOfKitchen) {
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 128: Fix Using mutating array method in listingLocalStore.ts

**File:** app/src/islands/pages/SelfListingPage/store/listingLocalStore.ts
**Line:** 393
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    }
    if (!data.spaceSnapshot.typeOfKitchen) {
      errors.push('Type of kitchen is required');
    }
    if (!data.spaceSnapshot.typeOfParking) {
```

**Refactored Code:**
```javascript
    }
    if (!data.spaceSnapshot.typeOfKitchen) {
      errors = [...errors, 'Type of kitchen is required'];
    }
    if (!data.spaceSnapshot.typeOfParking) {
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 129: Fix Using mutating array method in listingLocalStore.ts

**File:** app/src/islands/pages/SelfListingPage/store/listingLocalStore.ts
**Line:** 396
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    }
    if (!data.spaceSnapshot.typeOfParking) {
      errors.push('Type of parking is required');
    }
    if (!data.spaceSnapshot.address.fullAddress || !data.spaceSnapshot.address.validated) {
```

**Refactored Code:**
```javascript
    }
    if (!data.spaceSnapshot.typeOfParking) {
      errors = [...errors, 'Type of parking is required'];
    }
    if (!data.spaceSnapshot.address.fullAddress || !data.spaceSnapshot.address.validated) {
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 130: Fix Using mutating array method in listingLocalStore.ts

**File:** app/src/islands/pages/SelfListingPage/store/listingLocalStore.ts
**Line:** 399
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    }
    if (!data.spaceSnapshot.address.fullAddress || !data.spaceSnapshot.address.validated) {
      errors.push('Valid NYC address is required');
    }
```

**Refactored Code:**
```javascript
    }
    if (!data.spaceSnapshot.address.fullAddress || !data.spaceSnapshot.address.validated) {
      errors = [...errors, 'Valid NYC address is required'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 131: Fix Using mutating array method in listingLocalStore.ts

**File:** app/src/islands/pages/SelfListingPage/store/listingLocalStore.ts
**Line:** 404
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    // Section 2: Features
    if (data.features.amenitiesInsideUnit.length === 0) {
      errors.push('At least one amenity inside unit is required');
    }
    if (!data.features.descriptionOfLodging) {
```

**Refactored Code:**
```javascript
    // Section 2: Features
    if (data.features.amenitiesInsideUnit.length === 0) {
      errors = [...errors, 'At least one amenity inside unit is required'];
    }
    if (!data.features.descriptionOfLodging) {
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 132: Fix Using mutating array method in listingLocalStore.ts

**File:** app/src/islands/pages/SelfListingPage/store/listingLocalStore.ts
**Line:** 407
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    }
    if (!data.features.descriptionOfLodging) {
      errors.push('Description of lodging is required');
    }
```

**Refactored Code:**
```javascript
    }
    if (!data.features.descriptionOfLodging) {
      errors = [...errors, 'Description of lodging is required'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 133: Fix Using mutating array method in listingLocalStore.ts

**File:** app/src/islands/pages/SelfListingPage/store/listingLocalStore.ts
**Line:** 412
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    // Section 3: Lease Styles
    if (!data.leaseStyles.rentalType) {
      errors.push('Rental type is required');
    }
    if (data.leaseStyles.rentalType === 'Nightly') {
```

**Refactored Code:**
```javascript
    // Section 3: Lease Styles
    if (!data.leaseStyles.rentalType) {
      errors = [...errors, 'Rental type is required'];
    }
    if (data.leaseStyles.rentalType === 'Nightly') {
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 134: Fix Using mutating array method in listingLocalStore.ts

**File:** app/src/islands/pages/SelfListingPage/store/listingLocalStore.ts
**Line:** 417
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
      const nights = data.leaseStyles.availableNights;
      if (!nights || !Object.values(nights).some((v) => v)) {
        errors.push('At least one available night must be selected');
      }
    }
```

**Refactored Code:**
```javascript
      const nights = data.leaseStyles.availableNights;
      if (!nights || !Object.values(nights).some((v) => v)) {
        errors = [...errors, 'At least one available night must be selected'];
      }
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 135: Fix Using mutating array method in listingLocalStore.ts

**File:** app/src/islands/pages/SelfListingPage/store/listingLocalStore.ts
**Line:** 421
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    }
    if (data.leaseStyles.rentalType === 'Weekly' && !data.leaseStyles.weeklyPattern) {
      errors.push('Weekly pattern is required');
    }
```

**Refactored Code:**
```javascript
    }
    if (data.leaseStyles.rentalType === 'Weekly' && !data.leaseStyles.weeklyPattern) {
      errors = [...errors, 'Weekly pattern is required'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 136: Fix Using mutating array method in listingLocalStore.ts

**File:** app/src/islands/pages/SelfListingPage/store/listingLocalStore.ts
**Line:** 426
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    // Section 4: Pricing
    if (data.pricing.damageDeposit < 500) {
      errors.push('Damage deposit must be at least $500');
    }
    if (data.leaseStyles.rentalType === 'Monthly' && !data.pricing.monthlyCompensation) {
```

**Refactored Code:**
```javascript
    // Section 4: Pricing
    if (data.pricing.damageDeposit < 500) {
      errors = [...errors, 'Damage deposit must be at least $500'];
    }
    if (data.leaseStyles.rentalType === 'Monthly' && !data.pricing.monthlyCompensation) {
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 137: Fix Using mutating array method in listingLocalStore.ts

**File:** app/src/islands/pages/SelfListingPage/store/listingLocalStore.ts
**Line:** 429
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    }
    if (data.leaseStyles.rentalType === 'Monthly' && !data.pricing.monthlyCompensation) {
      errors.push('Monthly compensation is required');
    }
    if (data.leaseStyles.rentalType === 'Weekly' && !data.pricing.weeklyCompensation) {
```

**Refactored Code:**
```javascript
    }
    if (data.leaseStyles.rentalType === 'Monthly' && !data.pricing.monthlyCompensation) {
      errors = [...errors, 'Monthly compensation is required'];
    }
    if (data.leaseStyles.rentalType === 'Weekly' && !data.pricing.weeklyCompensation) {
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 138: Fix Using mutating array method in listingLocalStore.ts

**File:** app/src/islands/pages/SelfListingPage/store/listingLocalStore.ts
**Line:** 432
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    }
    if (data.leaseStyles.rentalType === 'Weekly' && !data.pricing.weeklyCompensation) {
      errors.push('Weekly compensation is required');
    }
    if (
```

**Refactored Code:**
```javascript
    }
    if (data.leaseStyles.rentalType === 'Weekly' && !data.pricing.weeklyCompensation) {
      errors = [...errors, 'Weekly compensation is required'];
    }
    if (
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 139: Fix Using mutating array method in listingLocalStore.ts

**File:** app/src/islands/pages/SelfListingPage/store/listingLocalStore.ts
**Line:** 438
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
      !data.pricing.nightlyPricing?.oneNightPrice
    ) {
      errors.push('Nightly pricing is required');
    }
```

**Refactored Code:**
```javascript
      !data.pricing.nightlyPricing?.oneNightPrice
    ) {
      errors = [...errors, 'Nightly pricing is required'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 140: Fix Using mutating array method in listingLocalStore.ts

**File:** app/src/islands/pages/SelfListingPage/store/listingLocalStore.ts
**Line:** 443
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    // Section 5: Rules
    if (!data.rules.cancellationPolicy) {
      errors.push('Cancellation policy is required');
    }
    if (!data.rules.checkInTime) {
```

**Refactored Code:**
```javascript
    // Section 5: Rules
    if (!data.rules.cancellationPolicy) {
      errors = [...errors, 'Cancellation policy is required'];
    }
    if (!data.rules.checkInTime) {
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 141: Fix Using mutating array method in listingLocalStore.ts

**File:** app/src/islands/pages/SelfListingPage/store/listingLocalStore.ts
**Line:** 446
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    }
    if (!data.rules.checkInTime) {
      errors.push('Check-in time is required');
    }
    if (!data.rules.checkOutTime) {
```

**Refactored Code:**
```javascript
    }
    if (!data.rules.checkInTime) {
      errors = [...errors, 'Check-in time is required'];
    }
    if (!data.rules.checkOutTime) {
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 142: Fix Using mutating array method in listingLocalStore.ts

**File:** app/src/islands/pages/SelfListingPage/store/listingLocalStore.ts
**Line:** 449
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    }
    if (!data.rules.checkOutTime) {
      errors.push('Check-out time is required');
    }
```

**Refactored Code:**
```javascript
    }
    if (!data.rules.checkOutTime) {
      errors = [...errors, 'Check-out time is required'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 143: Fix Using mutating array method in listingLocalStore.ts

**File:** app/src/islands/pages/SelfListingPage/store/listingLocalStore.ts
**Line:** 454
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
    // Section 6: Photos
    if (data.photos.photos.length < data.photos.minRequired) {
      errors.push(`At least ${data.photos.minRequired} photos are required`);
    }
```

**Refactored Code:**
```javascript
    // Section 6: Photos
    if (data.photos.photos.length < data.photos.minRequired) {
      errors = [...errors, `At least ${data.photos.minRequired} photos are required`];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 144: Fix Using mutating array method in prepareListingSubmission.ts

**File:** app/src/islands/pages/SelfListingPage/store/prepareListingSubmission.ts
**Line:** 93
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript

  const result: string[] = [];
  if (nights.sunday) result.push('sunday');
  if (nights.monday) result.push('monday');
  if (nights.tuesday) result.push('tuesday');
```

**Refactored Code:**
```javascript

  const result: string[] = [];
  result = [...result, 'sunday'];
  if (nights.monday) result.push('monday');
  if (nights.tuesday) result.push('tuesday');
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 145: Fix Using mutating array method in prepareListingSubmission.ts

**File:** app/src/islands/pages/SelfListingPage/store/prepareListingSubmission.ts
**Line:** 94
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
  const result: string[] = [];
  if (nights.sunday) result.push('sunday');
  if (nights.monday) result.push('monday');
  if (nights.tuesday) result.push('tuesday');
  if (nights.wednesday) result.push('wednesday');
```

**Refactored Code:**
```javascript
  const result: string[] = [];
  if (nights.sunday) result.push('sunday');
  result = [...result, 'monday'];
  if (nights.tuesday) result.push('tuesday');
  if (nights.wednesday) result.push('wednesday');
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 146: Fix Using mutating array method in prepareListingSubmission.ts

**File:** app/src/islands/pages/SelfListingPage/store/prepareListingSubmission.ts
**Line:** 95
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
  if (nights.sunday) result.push('sunday');
  if (nights.monday) result.push('monday');
  if (nights.tuesday) result.push('tuesday');
  if (nights.wednesday) result.push('wednesday');
  if (nights.thursday) result.push('thursday');
```

**Refactored Code:**
```javascript
  if (nights.sunday) result.push('sunday');
  if (nights.monday) result.push('monday');
  result = [...result, 'tuesday'];
  if (nights.wednesday) result.push('wednesday');
  if (nights.thursday) result.push('thursday');
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 147: Fix Using mutating array method in prepareListingSubmission.ts

**File:** app/src/islands/pages/SelfListingPage/store/prepareListingSubmission.ts
**Line:** 96
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
  if (nights.monday) result.push('monday');
  if (nights.tuesday) result.push('tuesday');
  if (nights.wednesday) result.push('wednesday');
  if (nights.thursday) result.push('thursday');
  if (nights.friday) result.push('friday');
```

**Refactored Code:**
```javascript
  if (nights.monday) result.push('monday');
  if (nights.tuesday) result.push('tuesday');
  result = [...result, 'wednesday'];
  if (nights.thursday) result.push('thursday');
  if (nights.friday) result.push('friday');
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 148: Fix Using mutating array method in prepareListingSubmission.ts

**File:** app/src/islands/pages/SelfListingPage/store/prepareListingSubmission.ts
**Line:** 97
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
  if (nights.tuesday) result.push('tuesday');
  if (nights.wednesday) result.push('wednesday');
  if (nights.thursday) result.push('thursday');
  if (nights.friday) result.push('friday');
  if (nights.saturday) result.push('saturday');
```

**Refactored Code:**
```javascript
  if (nights.tuesday) result.push('tuesday');
  if (nights.wednesday) result.push('wednesday');
  result = [...result, 'thursday'];
  if (nights.friday) result.push('friday');
  if (nights.saturday) result.push('saturday');
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 149: Fix Using mutating array method in prepareListingSubmission.ts

**File:** app/src/islands/pages/SelfListingPage/store/prepareListingSubmission.ts
**Line:** 98
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
  if (nights.wednesday) result.push('wednesday');
  if (nights.thursday) result.push('thursday');
  if (nights.friday) result.push('friday');
  if (nights.saturday) result.push('saturday');
```

**Refactored Code:**
```javascript
  if (nights.wednesday) result.push('wednesday');
  if (nights.thursday) result.push('thursday');
  result = [...result, 'friday'];
  if (nights.saturday) result.push('saturday');
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 150: Fix Using mutating array method in prepareListingSubmission.ts

**File:** app/src/islands/pages/SelfListingPage/store/prepareListingSubmission.ts
**Line:** 99
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
  if (nights.thursday) result.push('thursday');
  if (nights.friday) result.push('friday');
  if (nights.saturday) result.push('saturday');

  return result;
```

**Refactored Code:**
```javascript
  if (nights.thursday) result.push('thursday');
  if (nights.friday) result.push('friday');
  result = [...result, 'saturday'];

  return result;
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 151: Fix Using mutating array method in prepareListingSubmission.ts

**File:** app/src/islands/pages/SelfListingPage/store/prepareListingSubmission.ts
**Line:** 270
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript

  // Required fields
  if (!payload.Name) errors.push('Name is required');
  if (!payload['Type of Space']) errors.push('Type of Space is required');
  if (!payload.Address) errors.push('Address is required');
```

**Refactored Code:**
```javascript

  // Required fields
  errors = [...errors, 'Name is required'];
  if (!payload['Type of Space']) errors.push('Type of Space is required');
  if (!payload.Address) errors.push('Address is required');
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 152: Fix Using mutating array method in prepareListingSubmission.ts

**File:** app/src/islands/pages/SelfListingPage/store/prepareListingSubmission.ts
**Line:** 271
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
  // Required fields
  if (!payload.Name) errors.push('Name is required');
  if (!payload['Type of Space']) errors.push('Type of Space is required');
  if (!payload.Address) errors.push('Address is required');
  if (!payload['Rental Type']) errors.push('Rental Type is required');
```

**Refactored Code:**
```javascript
  // Required fields
  if (!payload.Name) errors.push('Name is required');
  errors = [...errors, 'Type of Space is required'];
  if (!payload.Address) errors.push('Address is required');
  if (!payload['Rental Type']) errors.push('Rental Type is required');
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 153: Fix Using mutating array method in prepareListingSubmission.ts

**File:** app/src/islands/pages/SelfListingPage/store/prepareListingSubmission.ts
**Line:** 272
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
  if (!payload.Name) errors.push('Name is required');
  if (!payload['Type of Space']) errors.push('Type of Space is required');
  if (!payload.Address) errors.push('Address is required');
  if (!payload['Rental Type']) errors.push('Rental Type is required');
```

**Refactored Code:**
```javascript
  if (!payload.Name) errors.push('Name is required');
  if (!payload['Type of Space']) errors.push('Type of Space is required');
  errors = [...errors, 'Address is required'];
  if (!payload['Rental Type']) errors.push('Rental Type is required');
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 154: Fix Using mutating array method in prepareListingSubmission.ts

**File:** app/src/islands/pages/SelfListingPage/store/prepareListingSubmission.ts
**Line:** 273
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
  if (!payload['Type of Space']) errors.push('Type of Space is required');
  if (!payload.Address) errors.push('Address is required');
  if (!payload['Rental Type']) errors.push('Rental Type is required');

  // Pricing validation based on rental type
```

**Refactored Code:**
```javascript
  if (!payload['Type of Space']) errors.push('Type of Space is required');
  if (!payload.Address) errors.push('Address is required');
  errors = [...errors, 'Rental Type is required'];

  // Pricing validation based on rental type
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 155: Fix Using mutating array method in prepareListingSubmission.ts

**File:** app/src/islands/pages/SelfListingPage/store/prepareListingSubmission.ts
**Line:** 277
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
  // Pricing validation based on rental type
  if (payload['Rental Type'] === 'Monthly' && !payload['Monthly Compensation']) {
    errors.push('Monthly Compensation is required for Monthly rentals');
  }
  if (payload['Rental Type'] === 'Weekly' && !payload['Weekly Compensation']) {
```

**Refactored Code:**
```javascript
  // Pricing validation based on rental type
  if (payload['Rental Type'] === 'Monthly' && !payload['Monthly Compensation']) {
    errors = [...errors, 'Monthly Compensation is required for Monthly rentals'];
  }
  if (payload['Rental Type'] === 'Weekly' && !payload['Weekly Compensation']) {
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 156: Fix Using mutating array method in prepareListingSubmission.ts

**File:** app/src/islands/pages/SelfListingPage/store/prepareListingSubmission.ts
**Line:** 280
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
  }
  if (payload['Rental Type'] === 'Weekly' && !payload['Weekly Compensation']) {
    errors.push('Weekly Compensation is required for Weekly rentals');
  }
  if (payload['Rental Type'] === 'Nightly' && !payload['Price 1 night selected']) {
```

**Refactored Code:**
```javascript
  }
  if (payload['Rental Type'] === 'Weekly' && !payload['Weekly Compensation']) {
    errors = [...errors, 'Weekly Compensation is required for Weekly rentals'];
  }
  if (payload['Rental Type'] === 'Nightly' && !payload['Price 1 night selected']) {
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 157: Fix Using mutating array method in prepareListingSubmission.ts

**File:** app/src/islands/pages/SelfListingPage/store/prepareListingSubmission.ts
**Line:** 283
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
  }
  if (payload['Rental Type'] === 'Nightly' && !payload['Price 1 night selected']) {
    errors.push('Nightly pricing is required for Nightly rentals');
  }
```

**Refactored Code:**
```javascript
  }
  if (payload['Rental Type'] === 'Nightly' && !payload['Price 1 night selected']) {
    errors = [...errors, 'Nightly pricing is required for Nightly rentals'];
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 158: Fix Using mutating array method in prepareListingSubmission.ts

**File:** app/src/islands/pages/SelfListingPage/store/prepareListingSubmission.ts
**Line:** 288
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /self-listing, /list-with-us

**Current Code:**
```javascript
  // Damage deposit minimum
  if (payload['Damage Deposit'] < 500) {
    errors.push('Damage Deposit must be at least $500');
  }
```

**Refactored Code:**
```javascript
  // Damage deposit minimum
  if (payload['Damage Deposit'] < 500) {
    errors = [...errors, 'Damage Deposit must be at least $500'];
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 159: Fix Using mutating array method in ViewSplitLeasePage-old.jsx

**File:** app/src/islands/pages/ViewSplitLeasePage-old.jsx
**Line:** 250
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /view-split-lease

**Current Code:**
```javascript

  if (listing['Kitchen Type']) {
    features.push({ icon: 'chef-hat', text: listing['Kitchen Type'] });
  }
```

**Refactored Code:**
```javascript

  if (listing['Kitchen Type']) {
    features = [...features, { icon: 'chef-hat', text: listing['Kitchen Type'] }];
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 160: Fix Using mutating array method in ViewSplitLeasePage-old.jsx

**File:** app/src/islands/pages/ViewSplitLeasePage-old.jsx
**Line:** 256
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /view-split-lease

**Current Code:**
```javascript
    const count = listing['Features - Qty Bathrooms'];
    const text = count === 1 ? 'Bathroom' : 'Bathrooms';
    features.push({ icon: 'bath', text: `${count} ${text}` });
  }
```

**Refactored Code:**
```javascript
    const count = listing['Features - Qty Bathrooms'];
    const text = count === 1 ? 'Bathroom' : 'Bathrooms';
    features = [...features, { icon: 'bath', text: `${count} ${text}` }];
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 161: Fix Using mutating array method in ViewSplitLeasePage-old.jsx

**File:** app/src/islands/pages/ViewSplitLeasePage-old.jsx
**Line:** 260
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /view-split-lease

**Current Code:**
```javascript

  if (listing.resolvedTypeOfSpace) {
    features.push({ icon: 'home', text: listing.resolvedTypeOfSpace });
  }
```

**Refactored Code:**
```javascript

  if (listing.resolvedTypeOfSpace) {
    features = [...features, { icon: 'home', text: listing.resolvedTypeOfSpace }];
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 162: Fix Using mutating array method in ViewSplitLeasePage-old.jsx

**File:** app/src/islands/pages/ViewSplitLeasePage-old.jsx
**Line:** 266
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** /view-split-lease

**Current Code:**
```javascript
    const count = listing['Features - Qty Beds'];
    const text = count === 1 ? 'Bed' : 'Beds';
    features.push({ icon: 'bed-double', text: `${count} ${text}` });
  }
```

**Refactored Code:**
```javascript
    const count = listing['Features - Qty Beds'];
    const text = count === 1 ? 'Bed' : 'Beds';
    features = [...features, { icon: 'bed-double', text: `${count} ${text}` }];
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 163: Fix Using mutating array sort/reverse in ViewSplitLeasePage-old.jsx

**File:** app/src/islands/pages/ViewSplitLeasePage-old.jsx
**Line:** 1170
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** /view-split-lease

**Current Code:**
```javascript
        .order('SortOrder', { ascending: true, nullsLast: true });

      const sortedPhotos = (photosData || []).sort((a, b) => {
        if (a.toggleMainPhoto) return -1;
        if (b.toggleMainPhoto) return 1;
```

**Refactored Code:**
```javascript
        .order('SortOrder', { ascending: true, nullsLast: true });

      const sortedPhotos = (photosData || [...[])].sort((a, b) => {

        if (a.toggleMainPhoto) return -1;
        if (b.toggleMainPhoto) return 1;
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 164: Fix Using mutating array sort/reverse in ViewSplitLeasePage-old.jsx

**File:** app/src/islands/pages/ViewSplitLeasePage-old.jsx
**Line:** 1207
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** /view-split-lease

**Current Code:**
```javascript
        return prev.filter(d => d !== dayIndex);
      } else {
        return [...prev, dayIndex].sort((a, b) => a - b);
      }
    });
```

**Refactored Code:**
```javascript
        return prev.filter(d => d !== dayIndex);
      } else {
        return [...prev, [...dayIndex]].sort((a, b) => a - b);

      }
    });
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 165: Fix Using mutating array sort/reverse in ViewSplitLeasePage.jsx

**File:** app/src/islands/pages/ViewSplitLeasePage.jsx
**Line:** 798
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** /view-split-lease

**Current Code:**
```javascript

    // Get the first selected day (check-in day)
    const sortedDays = [...selectedDayNumbers].sort((a, b) => a - b);
    const firstDayOfWeek = sortedDays[0];
```

**Refactored Code:**
```javascript

    // Get the first selected day (check-in day)
    const sortedDays = [...selectedDayNumbers].toSorted((a, b) => a - b);

    const firstDayOfWeek = sortedDays[0];
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 166: Fix Using mutating array sort/reverse in ViewSplitLeasePage.jsx

**File:** app/src/islands/pages/ViewSplitLeasePage.jsx
**Line:** 1256
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** /view-split-lease

**Current Code:**
```javascript

      // Sort days in JS format first to detect wrap-around (Saturday/Sunday spanning)
      const sortedJsDays = [...daysInJsFormat].sort((a, b) => a - b);

      // Check for wrap-around case (both Saturday=6 and Sunday=0 present, but not all 7 days)
```

**Refactored Code:**
```javascript

      // Sort days in JS format first to detect wrap-around (Saturday/Sunday spanning)
      const sortedJsDays = [...daysInJsFormat].toSorted((a, b) => a - b);


      // Check for wrap-around case (both Saturday=6 and Sunday=0 present, but not all 7 days)
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 167: Fix Imperative loop found (consider map/filter/reduce) in ViewSplitLeasePage.jsx

**File:** app/src/islands/pages/ViewSplitLeasePage.jsx
**Line:** 1268
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** /view-split-lease

**Current Code:**
```javascript
        // Find the gap in the sorted selection to determine wrap-around point
        let gapIndex = -1;
        for (let i = 0; i < sortedJsDays.length - 1; i++) {
          if (sortedJsDays[i + 1] - sortedJsDays[i] > 1) {
            gapIndex = i + 1;
```

**Refactored Code:**
```javascript
        // Find the gap in the sorted selection to determine wrap-around point
        let gapIndex = -1;
        // TODO: Refactor imperative loop to .map() or .reduce()
        for (let i = 0; i < sortedJsDays.length - 1; i++) {

          if (sortedJsDays[i + 1] - sortedJsDays[i] > 1) {
            gapIndex = i + 1;
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 168: Fix Using mutating array method in WhySplitLeasePage.jsx

**File:** app/src/islands/pages/WhySplitLeasePage.jsx
**Line:** 129
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
          // Only collect if it's a string ID (legacy format)
          if (typeof firstPhoto === 'string') {
            legacyPhotoIds.push(firstPhoto);
          }
        }
```

**Refactored Code:**
```javascript
          // Only collect if it's a string ID (legacy format)
          if (typeof firstPhoto === 'string') {
            legacyPhotoIds = [...legacyPhotoIds, firstPhoto];
          }
        }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 169: Fix Using mutating array sort/reverse in ProposalCard.jsx

**File:** app/src/islands/pages/proposals/ProposalCard.jsx
**Line:** 121
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  }

  const sorted = [...dayIndices].sort((a, b) => a - b);

  // Handle wrap-around case (e.g., Fri, Sat, Sun, Mon = [0, 1, 5, 6])
```

**Refactored Code:**
```javascript
  }

  const sorted = [...dayIndices].toSorted((a, b) => a - b);


  // Handle wrap-around case (e.g., Fri, Sat, Sun, Mon = [0, 1, 5, 6])
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 170: Fix Imperative loop found (consider map/filter/reduce) in ProposalCard.jsx

**File:** app/src/islands/pages/proposals/ProposalCard.jsx
**Line:** 130
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    // Find gap to determine actual start/end
    let gapIndex = -1;
    for (let i = 1; i < sorted.length; i++) {
      if (sorted[i] !== sorted[i - 1] + 1) {
        gapIndex = i;
```

**Refactored Code:**
```javascript
    // Find gap to determine actual start/end
    let gapIndex = -1;
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let i = 1; i < sorted.length; i++) {

      if (sorted[i] !== sorted[i - 1] + 1) {
        gapIndex = i;
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 171: Fix Using mutating array method in useEmailSmsUnitPageLogic.js

**File:** app/src/islands/pages/useEmailSmsUnitPageLogic.js
**Line:** 229
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    setMultiEmailValues(prev => {
      const emails = [...(prev[key] || [''])];
      emails.push('');
      return { ...prev, [key]: emails };
    });
```

**Refactored Code:**
```javascript
    setMultiEmailValues(prev => {
      const emails = [...(prev[key] || [''])];
      emails = [...emails, ''];
      return { ...prev, [key]: emails };
    });
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 172: Fix Using mutating array method in useSearchPageLogic.js

**File:** app/src/islands/pages/useSearchPageLogic.js
**Line:** 148
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    // Build location string
    const locationParts = []
    if (neighborhoodName) locationParts.push(neighborhoodName)
    if (boroughName) locationParts.push(boroughName)
    const location = locationParts.join(', ') || 'New York, NY'
```

**Refactored Code:**
```javascript
    // Build location string
    const locationParts = []
    locationParts = [...locationParts, neighborhoodName]
    if (boroughName) locationParts.push(boroughName)
    const location = locationParts.join(', ') || 'New York, NY'
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 173: Fix Using mutating array method in useSearchPageLogic.js

**File:** app/src/islands/pages/useSearchPageLogic.js
**Line:** 149
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    const locationParts = []
    if (neighborhoodName) locationParts.push(neighborhoodName)
    if (boroughName) locationParts.push(boroughName)
    const location = locationParts.join(', ') || 'New York, NY'
```

**Refactored Code:**
```javascript
    const locationParts = []
    if (neighborhoodName) locationParts.push(neighborhoodName)
    locationParts = [...locationParts, boroughName]
    const location = locationParts.join(', ') || 'New York, NY'
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 174: Fix Imperative loop found (consider map/filter/reduce) in AiSignupMarketReport.jsx

**File:** app/src/islands/shared/AiSignupMarketReport/AiSignupMarketReport.jsx
**Line:** 47
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  ];

  for (const pattern of namePatterns) {
    const match = text.match(pattern);
    if (match && match[1]) {
```

**Refactored Code:**
```javascript
  ];

  // TODO: Refactor imperative loop to .map() or .reduce()
  for (const pattern of namePatterns) {

    const match = text.match(pattern);
    if (match && match[1]) {
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 175: Fix Imperative loop found (consider map/filter/reduce) in AiSignupMarketReport.jsx

**File:** app/src/islands/shared/AiSignupMarketReport/AiSignupMarketReport.jsx
**Line:** 111
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  ];

  for (const pattern of standardPhonePatterns) {
    const match = text.match(pattern);
    if (match) return match[0];
```

**Refactored Code:**
```javascript
  ];

  // TODO: Refactor imperative loop to .map() or .reduce()
  for (const pattern of standardPhonePatterns) {

    const match = text.match(pattern);
    if (match) return match[0];
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 176: Fix Imperative loop found (consider map/filter/reduce) in AiSignupMarketReport.jsx

**File:** app/src/islands/shared/AiSignupMarketReport/AiSignupMarketReport.jsx
**Line:** 123
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  ];

  for (const pattern of explicitPhonePatterns) {
    const match = text.match(pattern);
    if (match && match[1]) {
```

**Refactored Code:**
```javascript
  ];

  // TODO: Refactor imperative loop to .map() or .reduce()
  for (const pattern of explicitPhonePatterns) {

    const match = text.match(pattern);
    if (match && match[1]) {
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 177: Fix Imperative loop found (consider map/filter/reduce) in AiSignupMarketReport.jsx

**File:** app/src/islands/shared/AiSignupMarketReport/AiSignupMarketReport.jsx
**Line:** 680
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  const detectedTopics = [];

  for (const topic of FREEFORM_TOPICS) {
    const isDetected = topic.patterns.some(pattern => pattern.test(text));
    if (isDetected) {
```

**Refactored Code:**
```javascript
  const detectedTopics = [];

  // TODO: Refactor imperative loop to .map() or .reduce()
  for (const topic of FREEFORM_TOPICS) {

    const isDetected = topic.patterns.some(pattern => pattern.test(text));
    if (isDetected) {
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 178: Fix Using mutating array method in AiSignupMarketReport.jsx

**File:** app/src/islands/shared/AiSignupMarketReport/AiSignupMarketReport.jsx
**Line:** 683
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    const isDetected = topic.patterns.some(pattern => pattern.test(text));
    if (isDetected) {
      detectedTopics.push(topic.id);
    }
  }
```

**Refactored Code:**
```javascript
    const isDetected = topic.patterns.some(pattern => pattern.test(text));
    if (isDetected) {
      detectedTopics = [...detectedTopics, topic.id];
    }
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 179: Fix Using mutating array sort/reverse in CreateProposalFlowV2.jsx

**File:** app/src/islands/shared/CreateProposalFlowV2.jsx
**Line:** 257
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

    // Sort day objects by dayOfWeek
    const sorted = [...dayObjs].sort((a, b) => a.dayOfWeek - b.dayOfWeek);
    const dayNumbers = sorted.map(d => d.dayOfWeek);
```

**Refactored Code:**
```javascript

    // Sort day objects by dayOfWeek
    const sorted = [...dayObjs].toSorted((a, b) => a.dayOfWeek - b.dayOfWeek);

    const dayNumbers = sorted.map(d => d.dayOfWeek);
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 180: Fix Imperative loop found (consider map/filter/reduce) in CreateProposalFlowV2.jsx

**File:** app/src/islands/shared/CreateProposalFlowV2.jsx
**Line:** 267
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      // Find the gap in the selection to determine wrap-around
      let gapIndex = -1;
      for (let i = 0; i < dayNumbers.length - 1; i++) {
        if (dayNumbers[i + 1] - dayNumbers[i] > 1) {
          gapIndex = i + 1;
```

**Refactored Code:**
```javascript
      // Find the gap in the selection to determine wrap-around
      let gapIndex = -1;
      // TODO: Refactor imperative loop to .map() or .reduce()
      for (let i = 0; i < dayNumbers.length - 1; i++) {

        if (dayNumbers[i + 1] - dayNumbers[i] > 1) {
          gapIndex = i + 1;
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 181: Fix Using mutating array sort/reverse in DaysSelectionSection.jsx

**File:** app/src/islands/shared/CreateProposalFlowV2Components/DaysSelectionSection.jsx
**Line:** 63
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  }

  const sorted = [...dayNumbers].sort((a, b) => a - b);

  // Check for wrap-around case (both Saturday and Sunday present)
```

**Refactored Code:**
```javascript
  }

  const sorted = [...dayNumbers].toSorted((a, b) => a - b);


  // Check for wrap-around case (both Saturday and Sunday present)
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 182: Fix Imperative loop found (consider map/filter/reduce) in DaysSelectionSection.jsx

**File:** app/src/islands/shared/CreateProposalFlowV2Components/DaysSelectionSection.jsx
**Line:** 72
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    // Find the gap in the selection to determine wrap-around
    let gapIndex = -1;
    for (let i = 0; i < sorted.length - 1; i++) {
      if (sorted[i + 1] - sorted[i] > 1) {
        gapIndex = i + 1;
```

**Refactored Code:**
```javascript
    // Find the gap in the selection to determine wrap-around
    let gapIndex = -1;
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let i = 0; i < sorted.length - 1; i++) {

      if (sorted[i + 1] - sorted[i] > 1) {
        gapIndex = i + 1;
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 183: Fix Using mutating array method in useEditListingDetailsLogic.js

**File:** app/src/islands/shared/EditListingDetails/useEditListingDetailsLogic.js
**Line:** 267
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

        const parts = [];
        if (city) parts.push(city);
        if (state) parts.push(state);
        if (zip) parts.push(zip);
```

**Refactored Code:**
```javascript

        const parts = [];
        parts = [...parts, city];
        if (state) parts.push(state);
        if (zip) parts.push(zip);
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 184: Fix Using mutating array method in useEditListingDetailsLogic.js

**File:** app/src/islands/shared/EditListingDetails/useEditListingDetailsLogic.js
**Line:** 268
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
        const parts = [];
        if (city) parts.push(city);
        if (state) parts.push(state);
        if (zip) parts.push(zip);
```

**Refactored Code:**
```javascript
        const parts = [];
        if (city) parts.push(city);
        parts = [...parts, state];
        if (zip) parts.push(zip);
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 185: Fix Using mutating array method in useEditListingDetailsLogic.js

**File:** app/src/islands/shared/EditListingDetails/useEditListingDetailsLogic.js
**Line:** 269
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
        if (city) parts.push(city);
        if (state) parts.push(state);
        if (zip) parts.push(zip);

        fullAddress = parts.join(', ');
```

**Refactored Code:**
```javascript
        if (city) parts.push(city);
        if (state) parts.push(state);
        parts = [...parts, zip];

        fullAddress = parts.join(', ');
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 186: Fix Imperative loop found (consider map/filter/reduce) in useEditListingDetailsLogic.js

**File:** app/src/islands/shared/EditListingDetails/useEditListingDetailsLogic.js
**Line:** 528
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      // when unchanged FK fields contain null or invalid values
      const changedFields = {};
      for (const [key, value] of Object.entries(formData)) {
        // Compare with original listing value - only include if different
        const originalValue = listing[key];
```

**Refactored Code:**
```javascript
      // when unchanged FK fields contain null or invalid values
      const changedFields = {};
      // TODO: Refactor imperative loop to .map() or .reduce()
      for (const [key, value] of Object.entries(formData)) {

        // Compare with original listing value - only include if different
        const originalValue = listing[key];
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 187: Fix Imperative loop found (consider map/filter/reduce) in useEditListingDetailsLogic.js

**File:** app/src/islands/shared/EditListingDetails/useEditListingDetailsLogic.js
**Line:** 833
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    try {
      const uploadedUrls = [];
      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const photoObj = { file, url: URL.createObjectURL(file) };
```

**Refactored Code:**
```javascript
    try {
      const uploadedUrls = [];
      // TODO: Refactor imperative loop to .map() or .reduce()
      for (let i = 0; i < files.length; i++) {

        const file = files[i];
        const photoObj = { file, url: URL.createObjectURL(file) };
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 188: Fix Using mutating array method in useEditListingDetailsLogic.js

**File:** app/src/islands/shared/EditListingDetails/useEditListingDetailsLogic.js
**Line:** 837
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
        const photoObj = { file, url: URL.createObjectURL(file) };
        const result = await uploadPhoto(photoObj, listing._id, currentPhotos.length + i);
        uploadedUrls.push(result.url);
      }
```

**Refactored Code:**
```javascript
        const photoObj = { file, url: URL.createObjectURL(file) };
        const result = await uploadPhoto(photoObj, listing._id, currentPhotos.length + i);
        uploadedUrls = [...uploadedUrls, result.url];
      }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 189: Fix Using mutating array method in useEditListingDetailsLogic.js

**File:** app/src/islands/shared/EditListingDetails/useEditListingDetailsLogic.js
**Line:** 946
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    const updated = [...currentPhotos];
    const [selectedPhoto] = updated.splice(index, 1);
    updated.unshift(selectedPhoto);

    handleInputChange('Features - Photos', updated);
```

**Refactored Code:**
```javascript
    const updated = [...currentPhotos];
    const [selectedPhoto] = updated.splice(index, 1);
    // TODO: Fix ViolationType.MUTATING_METHOD
    updated.unshift(selectedPhoto);


    handleInputChange('Features - Photos', updated);
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 190: Fix Using mutating array method in ExternalReviews.jsx

**File:** app/src/islands/shared/ExternalReviews.jsx
**Line:** 60
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  const groupedReviews = reviews.reduce((acc, review) => {
    if (!acc[review.platform]) acc[review.platform] = [];
    acc[review.platform].push(review);
    return acc;
  }, {});
```

**Refactored Code:**
```javascript
  const groupedReviews = reviews.reduce((acc, review) => {
    if (!acc[review.platform]) acc[review.platform] = [];
    // TODO: Refactor mutation to declarative
    // acc[review.platform].push(review);
    return acc;
  }, {});
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 191: Fix Using mutating array method in GoogleMap.jsx

**File:** app/src/islands/shared/GoogleMap.jsx
**Line:** 272
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

      if (Array.isArray(photosField)) {
        photoIds.push(...photosField);
      } else if (typeof photosField === 'string') {
        try {
```

**Refactored Code:**
```javascript

      if (Array.isArray(photosField)) {
        photoIds = [...photoIds, ...photosField];
      } else if (typeof photosField === 'string') {
        try {
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 192: Fix Using mutating array method in GoogleMap.jsx

**File:** app/src/islands/shared/GoogleMap.jsx
**Line:** 277
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
          const parsed = JSON.parse(photosField);
          if (Array.isArray(parsed)) {
            photoIds.push(...parsed);
          }
        } catch (e) {
```

**Refactored Code:**
```javascript
          const parsed = JSON.parse(photosField);
          if (Array.isArray(parsed)) {
            photoIds = [...photoIds, ...parsed];
          }
        } catch (e) {
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 193: Fix Using mutating array method in GoogleMap.jsx

**File:** app/src/islands/shared/GoogleMap.jsx
**Line:** 612
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
            });
            skippedNoCoordinates++;
            skippedInvalidCoordinates.push({
              id: listing.id,
              title: listing.title,
```

**Refactored Code:**
```javascript
            });
            skippedNoCoordinates++;
            // TODO: Refactor mutation to declarative
            // skippedInvalidCoordinates.push({
              id: listing.id,
              title: listing.title,
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 194: Fix Using mutating array method in GoogleMap.jsx

**File:** app/src/islands/shared/GoogleMap.jsx
**Line:** 643
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
              );

          markersRef.current.push(marker);
          bounds.extend(position);
          hasValidMarkers = true;
```

**Refactored Code:**
```javascript
              );

          current = [...current, marker];
          bounds.extend(position);
          hasValidMarkers = true;
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 195: Fix Using mutating array method in GoogleMap.jsx

**File:** app/src/islands/shared/GoogleMap.jsx
**Line:** 705
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
            });
            skippedNoCoordinates++;
            skippedInvalidCoordinates.push({
              id: listing.id,
              title: listing.title,
```

**Refactored Code:**
```javascript
            });
            skippedNoCoordinates++;
            // TODO: Refactor mutation to declarative
            // skippedInvalidCoordinates.push({
              id: listing.id,
              title: listing.title,
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 196: Fix Using mutating array method in GoogleMap.jsx

**File:** app/src/islands/shared/GoogleMap.jsx
**Line:** 733
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
          );

          markersRef.current.push(marker);
          bounds.extend(position);
          hasValidMarkers = true;
```

**Refactored Code:**
```javascript
          );

          current = [...current, marker];
          bounds.extend(position);
          hasValidMarkers = true;
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 197: Fix Using mutating array method in ScheduleSelector.jsx

**File:** app/src/islands/shared/HostEditingProposal/ScheduleSelector.jsx
**Line:** 119
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

          const classes = ['hss-night-cell']
          if (isSelected) classes.push('hss-selected')
          if (!isAvailable) classes.push('hss-unavailable')
          if (disabled) classes.push('hss-disabled')
```

**Refactored Code:**
```javascript

          const classes = ['hss-night-cell']
          classes = [...classes, 'hss-selected']
          if (!isAvailable) classes.push('hss-unavailable')
          if (disabled) classes.push('hss-disabled')
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 198: Fix Using mutating array method in ScheduleSelector.jsx

**File:** app/src/islands/shared/HostEditingProposal/ScheduleSelector.jsx
**Line:** 120
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
          const classes = ['hss-night-cell']
          if (isSelected) classes.push('hss-selected')
          if (!isAvailable) classes.push('hss-unavailable')
          if (disabled) classes.push('hss-disabled')
```

**Refactored Code:**
```javascript
          const classes = ['hss-night-cell']
          if (isSelected) classes.push('hss-selected')
          classes = [...classes, 'hss-unavailable']
          if (disabled) classes.push('hss-disabled')
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 199: Fix Using mutating array method in ScheduleSelector.jsx

**File:** app/src/islands/shared/HostEditingProposal/ScheduleSelector.jsx
**Line:** 121
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
          if (isSelected) classes.push('hss-selected')
          if (!isAvailable) classes.push('hss-unavailable')
          if (disabled) classes.push('hss-disabled')

          return (
```

**Refactored Code:**
```javascript
          if (isSelected) classes.push('hss-selected')
          if (!isAvailable) classes.push('hss-unavailable')
          classes = [...classes, 'hss-disabled']

          return (
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 200: Fix Using mutating array sort/reverse in types.js

**File:** app/src/islands/shared/HostEditingProposal/types.js
**Line:** 136
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
export function getCheckInDay(selectedNights) {
  if (!selectedNights || selectedNights.length === 0) return null
  const sortedNights = [...selectedNights].sort((a, b) => a - b)
  const firstNight = NIGHTS_CONFIG.find(n => n.id === sortedNights[0])
  return firstNight?.checkInDay ?? null
```

**Refactored Code:**
```javascript
export function getCheckInDay(selectedNights) {
  if (!selectedNights || selectedNights.length === 0) return null
  const sortedNights = [...selectedNights].toSorted((a, b) => a - b)

  const firstNight = NIGHTS_CONFIG.find(n => n.id === sortedNights[0])
  return firstNight?.checkInDay ?? null
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 201: Fix Using mutating array sort/reverse in types.js

**File:** app/src/islands/shared/HostEditingProposal/types.js
**Line:** 148
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
export function getCheckOutDay(selectedNights) {
  if (!selectedNights || selectedNights.length === 0) return null
  const sortedNights = [...selectedNights].sort((a, b) => a - b)
  const lastNight = NIGHTS_CONFIG.find(n => n.id === sortedNights[sortedNights.length - 1])
  return lastNight?.checkOutDay ?? null
```

**Refactored Code:**
```javascript
export function getCheckOutDay(selectedNights) {
  if (!selectedNights || selectedNights.length === 0) return null
  const sortedNights = [...selectedNights].toSorted((a, b) => a - b)

  const lastNight = NIGHTS_CONFIG.find(n => n.id === sortedNights[sortedNights.length - 1])
  return lastNight?.checkOutDay ?? null
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 202: Fix Using mutating array method in HostScheduleSelector.jsx

**File:** app/src/islands/shared/HostScheduleSelector/HostScheduleSelector.jsx
**Line:** 248
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      // Selected state
      if (isSelected) {
        classes.push('hss-selected')

        // Non-contiguous in proposal mode
```

**Refactored Code:**
```javascript
      // Selected state
      if (isSelected) {
        classes = [...classes, 'hss-selected']

        // Non-contiguous in proposal mode
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 203: Fix Using mutating array method in HostScheduleSelector.jsx

**File:** app/src/islands/shared/HostScheduleSelector/HostScheduleSelector.jsx
**Line:** 252
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
        // Non-contiguous in proposal mode
        if (inProposal && !isContiguous) {
          classes.push('hss-non-contiguous')
        }
      }
```

**Refactored Code:**
```javascript
        // Non-contiguous in proposal mode
        if (inProposal && !isContiguous) {
          classes = [...classes, 'hss-non-contiguous']
        }
      }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 204: Fix Using mutating array method in HostScheduleSelector.jsx

**File:** app/src/islands/shared/HostScheduleSelector/HostScheduleSelector.jsx
**Line:** 258
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      // Unavailable state
      if (!isAvailable) {
        classes.push('hss-unavailable')
      }
```

**Refactored Code:**
```javascript
      // Unavailable state
      if (!isAvailable) {
        classes = [...classes, 'hss-unavailable']
      }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 205: Fix Using mutating array method in HostScheduleSelector.jsx

**File:** app/src/islands/shared/HostScheduleSelector/HostScheduleSelector.jsx
**Line:** 263
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      // Disabled state
      if (!isClickable || (mode === 'preview' && !isAvailable)) {
        classes.push('hss-disabled')
      }
```

**Refactored Code:**
```javascript
      // Disabled state
      if (!isClickable || (mode === 'preview' && !isAvailable)) {
        classes = [...classes, 'hss-disabled']
      }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 206: Fix Using mutating array method in HostScheduleSelector.jsx

**File:** app/src/islands/shared/HostScheduleSelector/HostScheduleSelector.jsx
**Line:** 301
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

    if (mode === 'preview') {
      classes.push('hss-preview-mode')
    } else if (mode === 'step-by-step-guide') {
      classes.push('hss-step-by-step-mode')
```

**Refactored Code:**
```javascript

    if (mode === 'preview') {
      classes = [...classes, 'hss-preview-mode']
    } else if (mode === 'step-by-step-guide') {
      classes.push('hss-step-by-step-mode')
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 207: Fix Using mutating array method in HostScheduleSelector.jsx

**File:** app/src/islands/shared/HostScheduleSelector/HostScheduleSelector.jsx
**Line:** 303
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      classes.push('hss-preview-mode')
    } else if (mode === 'step-by-step-guide') {
      classes.push('hss-step-by-step-mode')
    } else if (mode === 'proposal' || inProposal) {
      classes.push('hss-proposal-mode')
```

**Refactored Code:**
```javascript
      classes.push('hss-preview-mode')
    } else if (mode === 'step-by-step-guide') {
      classes = [...classes, 'hss-step-by-step-mode']
    } else if (mode === 'proposal' || inProposal) {
      classes.push('hss-proposal-mode')
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 208: Fix Using mutating array method in HostScheduleSelector.jsx

**File:** app/src/islands/shared/HostScheduleSelector/HostScheduleSelector.jsx
**Line:** 305
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      classes.push('hss-step-by-step-mode')
    } else if (mode === 'proposal' || inProposal) {
      classes.push('hss-proposal-mode')
    }
```

**Refactored Code:**
```javascript
      classes.push('hss-step-by-step-mode')
    } else if (mode === 'proposal' || inProposal) {
      classes = [...classes, 'hss-proposal-mode']
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 209: Fix Using mutating array method in HostScheduleSelector.jsx

**File:** app/src/islands/shared/HostScheduleSelector/HostScheduleSelector.jsx
**Line:** 309
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

    if (className) {
      classes.push(className)
    }
```

**Refactored Code:**
```javascript

    if (className) {
      classes = [...classes, className]
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 210: Fix Using mutating array sort/reverse in SimpleHostScheduleSelector.jsx

**File:** app/src/islands/shared/HostScheduleSelector/SimpleHostScheduleSelector.jsx
**Line:** 117
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      } else {
        // Add night
        const newSelection = [...selectedNights, nightId].sort((a, b) => {
          const aIndex = ALL_NIGHTS.findIndex((n) => n.id === a)
          const bIndex = ALL_NIGHTS.findIndex((n) => n.id === b)
```

**Refactored Code:**
```javascript
      } else {
        // Add night
        const newSelection = [...selectedNights, [...nightId]].sort((a, b) => {

          const aIndex = ALL_NIGHTS.findIndex((n) => n.id === a)
          const bIndex = ALL_NIGHTS.findIndex((n) => n.id === b)
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 211: Fix Using mutating array method in SimpleHostScheduleSelector.jsx

**File:** app/src/islands/shared/HostScheduleSelector/SimpleHostScheduleSelector.jsx
**Line:** 145
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

      if (isSelected) {
        classes.push('shss-selected')
      }
```

**Refactored Code:**
```javascript

      if (isSelected) {
        classes = [...classes, 'shss-selected']
      }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 212: Fix Using mutating array method in SimpleHostScheduleSelector.jsx

**File:** app/src/islands/shared/HostScheduleSelector/SimpleHostScheduleSelector.jsx
**Line:** 149
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

      if (disabled || isUpdating) {
        classes.push('shss-disabled')
      }
```

**Refactored Code:**
```javascript

      if (disabled || isUpdating) {
        classes = [...classes, 'shss-disabled']
      }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 213: Fix Using mutating array sort/reverse in utils.js

**File:** app/src/islands/shared/HostScheduleSelector/utils.js
**Line:** 25
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  const numbers = selectedNights
    .map((id) => getNightById(id).dayIndex)
    .sort((a, b) => a - b)

  // Check for gaps
```

**Refactored Code:**
```javascript
  const numbers = selectedNights
    .map((id) => getNightById(id).dayIndex)
    .toSorted((a, b) => a - b)


  // Check for gaps
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 214: Fix Imperative loop found (consider map/filter/reduce) in utils.js

**File:** app/src/islands/shared/HostScheduleSelector/utils.js
**Line:** 29
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  // Check for gaps
  const gaps = []
  for (let i = 1; i < numbers.length; i++) {
    if (numbers[i] !== numbers[i - 1] + 1) {
      gaps.push(i)
```

**Refactored Code:**
```javascript
  // Check for gaps
  const gaps = []
  // TODO: Refactor imperative loop to .map() or .reduce()
  for (let i = 1; i < numbers.length; i++) {

    if (numbers[i] !== numbers[i - 1] + 1) {
      gaps.push(i)
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 215: Fix Using mutating array method in utils.js

**File:** app/src/islands/shared/HostScheduleSelector/utils.js
**Line:** 31
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  for (let i = 1; i < numbers.length; i++) {
    if (numbers[i] !== numbers[i - 1] + 1) {
      gaps.push(i)
    }
  }
```

**Refactored Code:**
```javascript
  for (let i = 1; i < numbers.length; i++) {
    if (numbers[i] !== numbers[i - 1] + 1) {
      gaps = [...gaps, i]
    }
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 216: Fix Imperative loop found (consider map/filter/reduce) in utils.js

**File:** app/src/islands/shared/HostScheduleSelector/utils.js
**Line:** 59
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  if (startIdx <= endIdx) {
    // Ascending order
    for (let i = startIdx; i <= endIdx; i++) {
      sequence.push(getNightByDayIndex(i).id)
    }
```

**Refactored Code:**
```javascript
  if (startIdx <= endIdx) {
    // Ascending order
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let i = startIdx; i <= endIdx; i++) {

      sequence.push(getNightByDayIndex(i).id)
    }
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 217: Fix Using mutating array method in utils.js

**File:** app/src/islands/shared/HostScheduleSelector/utils.js
**Line:** 60
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    // Ascending order
    for (let i = startIdx; i <= endIdx; i++) {
      sequence.push(getNightByDayIndex(i).id)
    }
  } else {
```

**Refactored Code:**
```javascript
    // Ascending order
    for (let i = startIdx; i <= endIdx; i++) {
      sequence = [...sequence, getNightByDayIndex(i).id]
    }
  } else {
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 218: Fix Imperative loop found (consider map/filter/reduce) in utils.js

**File:** app/src/islands/shared/HostScheduleSelector/utils.js
**Line:** 64
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  } else {
    // Descending order
    for (let i = startIdx; i >= endIdx; i--) {
      sequence.push(getNightByDayIndex(i).id)
    }
```

**Refactored Code:**
```javascript
  } else {
    // Descending order
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let i = startIdx; i >= endIdx; i--) {

      sequence.push(getNightByDayIndex(i).id)
    }
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 219: Fix Using mutating array method in utils.js

**File:** app/src/islands/shared/HostScheduleSelector/utils.js
**Line:** 65
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    // Descending order
    for (let i = startIdx; i >= endIdx; i--) {
      sequence.push(getNightByDayIndex(i).id)
    }
  }
```

**Refactored Code:**
```javascript
    // Descending order
    for (let i = startIdx; i >= endIdx; i--) {
      sequence = [...sequence, getNightByDayIndex(i).id]
    }
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 220: Fix Using mutating array sort/reverse in utils.js

**File:** app/src/islands/shared/HostScheduleSelector/utils.js
**Line:** 133
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
 */
export function sortNights(nights) {
  return [...nights].sort((a, b) => {
    const nightA = getNightById(a)
    const nightB = getNightById(b)
```

**Refactored Code:**
```javascript
 */
export function sortNights(nights) {
  return [...nights].toSorted((a, b) => {

    const nightA = getNightById(a)
    const nightB = getNightById(b)
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 221: Fix Using mutating array method in LoggedInAvatar.jsx

**File:** app/src/islands/shared/LoggedInAvatar/LoggedInAvatar.jsx
**Line:** 174
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    // 1. My Profile - ALWAYS visible
    if (menuVisibility.myProfile) {
      items.push({
        id: 'profile',
        label: 'My Profile',
```

**Refactored Code:**
```javascript
    // 1. My Profile - ALWAYS visible
    if (menuVisibility.myProfile) {
      // TODO: Refactor mutation to declarative
      // items.push({
        id: 'profile',
        label: 'My Profile',
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 222: Fix Using mutating array method in LoggedInAvatar.jsx

**File:** app/src/islands/shared/LoggedInAvatar/LoggedInAvatar.jsx
**Line:** 186
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    //    - Hosts see proposals received from guests
    if (menuVisibility.myProposals) {
      items.push({
        id: 'proposals',
        label: 'My Proposals',
```

**Refactored Code:**
```javascript
    //    - Hosts see proposals received from guests
    if (menuVisibility.myProposals) {
      // TODO: Refactor mutation to declarative
      // items.push({
        id: 'proposals',
        label: 'My Proposals',
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 223: Fix Using mutating array method in LoggedInAvatar.jsx

**File:** app/src/islands/shared/LoggedInAvatar/LoggedInAvatar.jsx
**Line:** 201
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    //    Helps guests discover listings to submit proposals to
    if (menuVisibility.myProposalsSuggested) {
      items.push({
        id: 'proposals-suggested',
        label: 'Proposals Suggested',
```

**Refactored Code:**
```javascript
    //    Helps guests discover listings to submit proposals to
    if (menuVisibility.myProposalsSuggested) {
      // TODO: Refactor mutation to declarative
      // items.push({
        id: 'proposals-suggested',
        label: 'Proposals Suggested',
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 224: Fix Using mutating array method in LoggedInAvatar.jsx

**File:** app/src/islands/shared/LoggedInAvatar/LoggedInAvatar.jsx
**Line:** 217
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      }

      items.push({
        id: 'listings',
        label: 'My Listings',
```

**Refactored Code:**
```javascript
      }

      // TODO: Refactor mutation to declarative
      // items.push({
        id: 'listings',
        label: 'My Listings',
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 225: Fix Using mutating array method in LoggedInAvatar.jsx

**File:** app/src/islands/shared/LoggedInAvatar/LoggedInAvatar.jsx
**Line:** 234
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      const vmQueryParam = hasVirtualMeetings ? '?scrollTo=virtual-meetings' : '?highlightVMButton=true';

      items.push({
        id: 'virtual-meetings',
        label: 'Virtual Meetings',
```

**Refactored Code:**
```javascript
      const vmQueryParam = hasVirtualMeetings ? '?scrollTo=virtual-meetings' : '?highlightVMButton=true';

      // TODO: Refactor mutation to declarative
      // items.push({
        id: 'virtual-meetings',
        label: 'Virtual Meetings',
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 226: Fix Using mutating array method in LoggedInAvatar.jsx

**File:** app/src/islands/shared/LoggedInAvatar/LoggedInAvatar.jsx
**Line:** 248
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    // 6. House Manuals & Visits - Context-aware visibility
    if (menuVisibility.houseManualsAndVisits) {
      items.push({
        id: 'house-manuals',
        label: 'House manuals & Visits',
```

**Refactored Code:**
```javascript
    // 6. House Manuals & Visits - Context-aware visibility
    if (menuVisibility.houseManualsAndVisits) {
      // TODO: Refactor mutation to declarative
      // items.push({
        id: 'house-manuals',
        label: 'House manuals & Visits',
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 227: Fix Using mutating array method in LoggedInAvatar.jsx

**File:** app/src/islands/shared/LoggedInAvatar/LoggedInAvatar.jsx
**Line:** 262
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    // 7. My Leases - Only when user has leases (leasesCount > 0)
    if (menuVisibility.myLeases) {
      items.push({
        id: 'leases',
        label: 'My Leases',
```

**Refactored Code:**
```javascript
    // 7. My Leases - Only when user has leases (leasesCount > 0)
    if (menuVisibility.myLeases) {
      // TODO: Refactor mutation to declarative
      // items.push({
        id: 'leases',
        label: 'My Leases',
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 228: Fix Using mutating array method in LoggedInAvatar.jsx

**File:** app/src/islands/shared/LoggedInAvatar/LoggedInAvatar.jsx
**Line:** 276
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    // 8. My Favorite Listings - GUEST only when favoritesCount > 0
    if (menuVisibility.myFavoriteListings) {
      items.push({
        id: 'favorites',
        label: 'My Favorite Listings',
```

**Refactored Code:**
```javascript
    // 8. My Favorite Listings - GUEST only when favoritesCount > 0
    if (menuVisibility.myFavoriteListings) {
      // TODO: Refactor mutation to declarative
      // items.push({
        id: 'favorites',
        label: 'My Favorite Listings',
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 229: Fix Using mutating array method in LoggedInAvatar.jsx

**File:** app/src/islands/shared/LoggedInAvatar/LoggedInAvatar.jsx
**Line:** 288
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    // 9. Messages - Always visible, with RED badge for urgency
    if (menuVisibility.messages) {
      items.push({
        id: 'messages',
        label: 'Messages',
```

**Refactored Code:**
```javascript
    // 9. Messages - Always visible, with RED badge for urgency
    if (menuVisibility.messages) {
      // TODO: Refactor mutation to declarative
      // items.push({
        id: 'messages',
        label: 'Messages',
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 230: Fix Using mutating array method in LoggedInAvatar.jsx

**File:** app/src/islands/shared/LoggedInAvatar/LoggedInAvatar.jsx
**Line:** 301
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    // Navigate to account profile with rental application section focus
    if (menuVisibility.rentalApplication) {
      items.push({
        id: 'rental-application',
        label: 'Rental Application',
```

**Refactored Code:**
```javascript
    // Navigate to account profile with rental application section focus
    if (menuVisibility.rentalApplication) {
      // TODO: Refactor mutation to declarative
      // items.push({
        id: 'rental-application',
        label: 'Rental Application',
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 231: Fix Using mutating array method in LoggedInAvatar.jsx

**File:** app/src/islands/shared/LoggedInAvatar/LoggedInAvatar.jsx
**Line:** 313
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    // 11. Reviews Manager - Always visible
    if (menuVisibility.reviewsManager) {
      items.push({
        id: 'reviews',
        label: 'Reviews Manager',
```

**Refactored Code:**
```javascript
    // 11. Reviews Manager - Always visible
    if (menuVisibility.reviewsManager) {
      // TODO: Refactor mutation to declarative
      // items.push({
        id: 'reviews',
        label: 'Reviews Manager',
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 232: Fix Using mutating array method in LoggedInAvatar.jsx

**File:** app/src/islands/shared/LoggedInAvatar/LoggedInAvatar.jsx
**Line:** 323
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    // 12. Referral - Always visible, opens modal instead of navigating
    if (menuVisibility.referral) {
      items.push({
        id: 'referral',
        label: 'Referral',
```

**Refactored Code:**
```javascript
    // 12. Referral - Always visible, opens modal instead of navigating
    if (menuVisibility.referral) {
      // TODO: Refactor mutation to declarative
      // items.push({
        id: 'referral',
        label: 'Referral',
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 233: Fix Using mutating array method in notificationCategories.js

**File:** app/src/islands/shared/NotificationSettingsIsland/notificationCategories.js
**Line:** 122
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  const index = arr.indexOf(channel);
  if (index === -1) {
    arr.push(channel);
  } else {
    arr.splice(index, 1);
```

**Refactored Code:**
```javascript
  const index = arr.indexOf(channel);
  if (index === -1) {
    arr = [...arr, channel];
  } else {
    arr.splice(index, 1);
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 234: Fix Imperative loop found (consider map/filter/reduce) in useRentalApplicationWizardLogic.js

**File:** app/src/islands/shared/RentalApplicationWizardModal/useRentalApplicationWizardLogic.js
**Line:** 267
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  useEffect(() => {
    const newCompleted = [];
    for (let step = 1; step <= TOTAL_STEPS; step++) {
      if (checkStepComplete(step)) {
        newCompleted.push(step);
```

**Refactored Code:**
```javascript
  useEffect(() => {
    const newCompleted = [];
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let step = 1; step <= TOTAL_STEPS; step++) {

      if (checkStepComplete(step)) {
        newCompleted.push(step);
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 235: Fix Using mutating array method in useRentalApplicationWizardLogic.js

**File:** app/src/islands/shared/RentalApplicationWizardModal/useRentalApplicationWizardLogic.js
**Line:** 269
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    for (let step = 1; step <= TOTAL_STEPS; step++) {
      if (checkStepComplete(step)) {
        newCompleted.push(step);
      }
    }
```

**Refactored Code:**
```javascript
    for (let step = 1; step <= TOTAL_STEPS; step++) {
      if (checkStepComplete(step)) {
        newCompleted = [...newCompleted, step];
      }
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 236: Fix Using mutating array method in ScheduleCohost.jsx

**File:** app/src/islands/shared/ScheduleCohost/ScheduleCohost.jsx
**Line:** 709
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
                  // Build class names array
                  const classNames = ['schedule-cohost-calendar-day'];
                  if (isOtherMonth) classNames.push('schedule-cohost-calendar-day--other');
                  if (isPast) classNames.push('schedule-cohost-calendar-day--past');
                  if (isActive) classNames.push('schedule-cohost-calendar-day--selected');
```

**Refactored Code:**
```javascript
                  // Build class names array
                  const classNames = ['schedule-cohost-calendar-day'];
                  classNames = [...classNames, 'schedule-cohost-calendar-day--other'];
                  if (isPast) classNames.push('schedule-cohost-calendar-day--past');
                  if (isActive) classNames.push('schedule-cohost-calendar-day--selected');
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 237: Fix Using mutating array method in ScheduleCohost.jsx

**File:** app/src/islands/shared/ScheduleCohost/ScheduleCohost.jsx
**Line:** 710
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
                  const classNames = ['schedule-cohost-calendar-day'];
                  if (isOtherMonth) classNames.push('schedule-cohost-calendar-day--other');
                  if (isPast) classNames.push('schedule-cohost-calendar-day--past');
                  if (isActive) classNames.push('schedule-cohost-calendar-day--selected');
                  if (hasSlots) classNames.push('schedule-cohost-calendar-day--has-slots');
```

**Refactored Code:**
```javascript
                  const classNames = ['schedule-cohost-calendar-day'];
                  if (isOtherMonth) classNames.push('schedule-cohost-calendar-day--other');
                  classNames = [...classNames, 'schedule-cohost-calendar-day--past'];
                  if (isActive) classNames.push('schedule-cohost-calendar-day--selected');
                  if (hasSlots) classNames.push('schedule-cohost-calendar-day--has-slots');
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 238: Fix Using mutating array method in ScheduleCohost.jsx

**File:** app/src/islands/shared/ScheduleCohost/ScheduleCohost.jsx
**Line:** 711
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
                  if (isOtherMonth) classNames.push('schedule-cohost-calendar-day--other');
                  if (isPast) classNames.push('schedule-cohost-calendar-day--past');
                  if (isActive) classNames.push('schedule-cohost-calendar-day--selected');
                  if (hasSlots) classNames.push('schedule-cohost-calendar-day--has-slots');
                  if (isTodayDate) classNames.push('schedule-cohost-calendar-day--today');
```

**Refactored Code:**
```javascript
                  if (isOtherMonth) classNames.push('schedule-cohost-calendar-day--other');
                  if (isPast) classNames.push('schedule-cohost-calendar-day--past');
                  classNames = [...classNames, 'schedule-cohost-calendar-day--selected'];
                  if (hasSlots) classNames.push('schedule-cohost-calendar-day--has-slots');
                  if (isTodayDate) classNames.push('schedule-cohost-calendar-day--today');
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 239: Fix Using mutating array method in ScheduleCohost.jsx

**File:** app/src/islands/shared/ScheduleCohost/ScheduleCohost.jsx
**Line:** 712
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
                  if (isPast) classNames.push('schedule-cohost-calendar-day--past');
                  if (isActive) classNames.push('schedule-cohost-calendar-day--selected');
                  if (hasSlots) classNames.push('schedule-cohost-calendar-day--has-slots');
                  if (isTodayDate) classNames.push('schedule-cohost-calendar-day--today');
```

**Refactored Code:**
```javascript
                  if (isPast) classNames.push('schedule-cohost-calendar-day--past');
                  if (isActive) classNames.push('schedule-cohost-calendar-day--selected');
                  classNames = [...classNames, 'schedule-cohost-calendar-day--has-slots'];
                  if (isTodayDate) classNames.push('schedule-cohost-calendar-day--today');
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 240: Fix Using mutating array method in ScheduleCohost.jsx

**File:** app/src/islands/shared/ScheduleCohost/ScheduleCohost.jsx
**Line:** 713
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
                  if (isActive) classNames.push('schedule-cohost-calendar-day--selected');
                  if (hasSlots) classNames.push('schedule-cohost-calendar-day--has-slots');
                  if (isTodayDate) classNames.push('schedule-cohost-calendar-day--today');

                  return (
```

**Refactored Code:**
```javascript
                  if (isActive) classNames.push('schedule-cohost-calendar-day--selected');
                  if (hasSlots) classNames.push('schedule-cohost-calendar-day--has-slots');
                  classNames = [...classNames, 'schedule-cohost-calendar-day--today'];

                  return (
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 241: Fix Imperative loop found (consider map/filter/reduce) in cohostService.js

**File:** app/src/islands/shared/ScheduleCohost/cohostService.js
**Line:** 40
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

  const days = [];
  for (let i = 0; i < totalDays; i++) {
    const date = new Date(startDate);
    date.setDate(startDate.getDate() + i);
```

**Refactored Code:**
```javascript

  const days = [];
  // TODO: Refactor imperative loop to .map() or .reduce()
  for (let i = 0; i < totalDays; i++) {

    const date = new Date(startDate);
    date.setDate(startDate.getDate() + i);
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 242: Fix Using mutating array method in cohostService.js

**File:** app/src/islands/shared/ScheduleCohost/cohostService.js
**Line:** 43
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    const date = new Date(startDate);
    date.setDate(startDate.getDate() + i);
    days.push(date);
  }
```

**Refactored Code:**
```javascript
    const date = new Date(startDate);
    date.setDate(startDate.getDate() + i);
    days = [...days, date];
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 243: Fix Imperative loop found (consider map/filter/reduce) in cohostService.js

**File:** app/src/islands/shared/ScheduleCohost/cohostService.js
**Line:** 61
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  const date = new Date(selectedDate);

  for (let hour = startHour; hour < endHour; hour++) {
    for (let minutes = 0; minutes < 60; minutes += intervalMinutes) {
      const slotTime = new Date(date);
```

**Refactored Code:**
```javascript
  const date = new Date(selectedDate);

  // TODO: Refactor imperative loop to .map() or .reduce()
  for (let hour = startHour; hour < endHour; hour++) {

    for (let minutes = 0; minutes < 60; minutes += intervalMinutes) {
      const slotTime = new Date(date);
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 244: Fix Imperative loop found (consider map/filter/reduce) in cohostService.js

**File:** app/src/islands/shared/ScheduleCohost/cohostService.js
**Line:** 62
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

  for (let hour = startHour; hour < endHour; hour++) {
    for (let minutes = 0; minutes < 60; minutes += intervalMinutes) {
      const slotTime = new Date(date);
      slotTime.setHours(hour, minutes, 0, 0);
```

**Refactored Code:**
```javascript

  for (let hour = startHour; hour < endHour; hour++) {
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let minutes = 0; minutes < 60; minutes += intervalMinutes) {

      const slotTime = new Date(date);
      slotTime.setHours(hour, minutes, 0, 0);
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 245: Fix Using mutating array method in cohostService.js

**File:** app/src/islands/shared/ScheduleCohost/cohostService.js
**Line:** 66
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      slotTime.setHours(hour, minutes, 0, 0);

      slots.push({
        id: `slot_${slotTime.getTime()}`,
        dateTime: slotTime,
```

**Refactored Code:**
```javascript
      slotTime.setHours(hour, minutes, 0, 0);

      // TODO: Refactor mutation to declarative
      // slots.push({
        id: `slot_${slotTime.getTime()}`,
        dateTime: slotTime,
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 246: Fix Using mutating array sort/reverse in SearchScheduleSelector.jsx

**File:** app/src/islands/shared/SearchScheduleSelector.jsx
**Line:** 319
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    }

    const sortedDays = [...daysArray].sort((a, b) => a - b);

    // STEP 1: Check if selected days are continuous (regular check)
```

**Refactored Code:**
```javascript
    }

    const sortedDays = [...daysArray].toSorted((a, b) => a - b);


    // STEP 1: Check if selected days are continuous (regular check)
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 247: Fix Imperative loop found (consider map/filter/reduce) in SearchScheduleSelector.jsx

**File:** app/src/islands/shared/SearchScheduleSelector.jsx
**Line:** 323
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    // STEP 1: Check if selected days are continuous (regular check)
    let isRegularContinuous = true;
    for (let i = 1; i < sortedDays.length; i++) {
      if (sortedDays[i] !== sortedDays[i - 1] + 1) {
        isRegularContinuous = false;
```

**Refactored Code:**
```javascript
    // STEP 1: Check if selected days are continuous (regular check)
    let isRegularContinuous = true;
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let i = 1; i < sortedDays.length; i++) {

      if (sortedDays[i] !== sortedDays[i - 1] + 1) {
        isRegularContinuous = false;
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 248: Fix Using mutating array sort/reverse in SearchScheduleSelector.jsx

**File:** app/src/islands/shared/SearchScheduleSelector.jsx
**Line:** 344
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

    // Check if unselected days are continuous
    const sortedUnselected = [...unselectedDays].sort((a, b) => a - b);
    for (let i = 1; i < sortedUnselected.length; i++) {
      if (sortedUnselected[i] !== sortedUnselected[i - 1] + 1) {
```

**Refactored Code:**
```javascript

    // Check if unselected days are continuous
    const sortedUnselected = [...unselectedDays].toSorted((a, b) => a - b);

    for (let i = 1; i < sortedUnselected.length; i++) {
      if (sortedUnselected[i] !== sortedUnselected[i - 1] + 1) {
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 249: Fix Imperative loop found (consider map/filter/reduce) in SearchScheduleSelector.jsx

**File:** app/src/islands/shared/SearchScheduleSelector.jsx
**Line:** 345
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    // Check if unselected days are continuous
    const sortedUnselected = [...unselectedDays].sort((a, b) => a - b);
    for (let i = 1; i < sortedUnselected.length; i++) {
      if (sortedUnselected[i] !== sortedUnselected[i - 1] + 1) {
        // Unselected days not continuous, selection is not valid
```

**Refactored Code:**
```javascript
    // Check if unselected days are continuous
    const sortedUnselected = [...unselectedDays].sort((a, b) => a - b);
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let i = 1; i < sortedUnselected.length; i++) {

      if (sortedUnselected[i] !== sortedUnselected[i - 1] + 1) {
        // Unselected days not continuous, selection is not valid
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 250: Fix Imperative loop found (consider map/filter/reduce) in SearchScheduleSelector.jsx

**File:** app/src/islands/shared/SearchScheduleSelector.jsx
**Line:** 446
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

        // Fill all days in range
        for (let i = 0; i < dayCount; i++) {
          const currentDay = (start + i) % totalDays;
          newSelection.add(currentDay);
```

**Refactored Code:**
```javascript

        // Fill all days in range
        // TODO: Refactor imperative loop to .map() or .reduce()
        for (let i = 0; i < dayCount; i++) {

          const currentDay = (start + i) % totalDays;
          newSelection.add(currentDay);
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 251: Fix Using mutating array sort/reverse in SearchScheduleSelector.jsx

**File:** app/src/islands/shared/SearchScheduleSelector.jsx
**Line:** 546
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

    // Multiple day selection
    const sortedDays = [...selectedDaysArray].sort((a, b) => a - b);
    const hasSunday = sortedDays.includes(0);
    const hasSaturday = sortedDays.includes(6);
```

**Refactored Code:**
```javascript

    // Multiple day selection
    const sortedDays = [...selectedDaysArray].toSorted((a, b) => a - b);

    const hasSunday = sortedDays.includes(0);
    const hasSaturday = sortedDays.includes(6);
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 252: Fix Imperative loop found (consider map/filter/reduce) in SearchScheduleSelector.jsx

**File:** app/src/islands/shared/SearchScheduleSelector.jsx
**Line:** 557
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

      // Look for the gap in the sorted days
      for (let i = 0; i < sortedDays.length - 1; i++) {
        if (sortedDays[i + 1] - sortedDays[i] > 1) {
          // Found the gap
```

**Refactored Code:**
```javascript

      // Look for the gap in the sorted days
      // TODO: Refactor imperative loop to .map() or .reduce()
      for (let i = 0; i < sortedDays.length - 1; i++) {

        if (sortedDays[i + 1] - sortedDays[i] > 1) {
          // Found the gap
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 253: Fix Using mutating array method in SearchScheduleSelector.jsx

**File:** app/src/islands/shared/SearchScheduleSelector.jsx
**Line:** 585
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
        if (sortedDays.some(day => day < gapStart)) {
          // There are days before the gap
          checkoutDayIndex = sortedDays.filter(day => day < gapStart).pop();
        } else {
          // Wrap to Saturday
```

**Refactored Code:**
```javascript
        if (sortedDays.some(day => day < gapStart)) {
          // There are days before the gap
          // TODO: Fix ViolationType.MUTATING_METHOD
          checkoutDayIndex = sortedDays.filter(day => day < gapStart).pop();

        } else {
          // Wrap to Saturday
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 254: Fix Using mutating array sort/reverse in SearchScheduleSelector.jsx

**File:** app/src/islands/shared/SearchScheduleSelector.jsx
**Line:** 617
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    }

    const selectedDaysArray = Array.from(selectedDays).sort((a, b) => a - b);

    if (selectedDaysArray.length > 0) {
```

**Refactored Code:**
```javascript
    }

    const selectedDaysArray = [...Array.from(selectedDays)].sort((a, b) => a - b);


    if (selectedDaysArray.length > 0) {
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 255: Fix Using mutating array method in suggestedProposalService.js

**File:** app/src/islands/shared/SuggestedProposals/suggestedProposalService.js
**Line:** 89
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
          summaryMap[proposalId] = [];
        }
        summaryMap[proposalId].push(summary);
      });
```

**Refactored Code:**
```javascript
          summaryMap[proposalId] = [];
        }
        // TODO: Refactor mutation to declarative
        // summaryMap[proposalId].push(summary);
      });
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 256: Fix Using mutating array method in BookTimeSlot.jsx

**File:** app/src/islands/shared/VirtualMeetingManager/BookTimeSlot.jsx
**Line:** 155
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

    if (isDateActive(date)) {
      classes.push('vm-date-button-active');
    }
```

**Refactored Code:**
```javascript

    if (isDateActive(date)) {
      classes = [...classes, 'vm-date-button-active'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 257: Fix Using mutating array method in BookTimeSlot.jsx

**File:** app/src/islands/shared/VirtualMeetingManager/BookTimeSlot.jsx
**Line:** 159
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

    if (dateHasSelectedSlots(date)) {
      classes.push('vm-date-button-has-slots');
    }
```

**Refactored Code:**
```javascript

    if (dateHasSelectedSlots(date)) {
      classes = [...classes, 'vm-date-button-has-slots'];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 258: Fix Imperative loop found (consider map/filter/reduce) in dateUtils.js

**File:** app/src/islands/shared/VirtualMeetingManager/dateUtils.js
**Line:** 71
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  const slots = [];

  for (let hour = startHour; hour < endHour; hour++) {
    for (let minute = 0; minute < 60; minute += interval) {
      const slotTime = new Date(date);
```

**Refactored Code:**
```javascript
  const slots = [];

  // TODO: Refactor imperative loop to .map() or .reduce()
  for (let hour = startHour; hour < endHour; hour++) {

    for (let minute = 0; minute < 60; minute += interval) {
      const slotTime = new Date(date);
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 259: Fix Imperative loop found (consider map/filter/reduce) in dateUtils.js

**File:** app/src/islands/shared/VirtualMeetingManager/dateUtils.js
**Line:** 72
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

  for (let hour = startHour; hour < endHour; hour++) {
    for (let minute = 0; minute < 60; minute += interval) {
      const slotTime = new Date(date);
      slotTime.setHours(hour, minute, 0, 0);
```

**Refactored Code:**
```javascript

  for (let hour = startHour; hour < endHour; hour++) {
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let minute = 0; minute < 60; minute += interval) {

      const slotTime = new Date(date);
      slotTime.setHours(hour, minute, 0, 0);
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 260: Fix Using mutating array method in dateUtils.js

**File:** app/src/islands/shared/VirtualMeetingManager/dateUtils.js
**Line:** 75
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      const slotTime = new Date(date);
      slotTime.setHours(hour, minute, 0, 0);
      slots.push(slotTime);
    }
  }
```

**Refactored Code:**
```javascript
      const slotTime = new Date(date);
      slotTime.setHours(hour, minute, 0, 0);
      slots = [...slots, slotTime];
    }
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 261: Fix Imperative loop found (consider map/filter/reduce) in dateUtils.js

**File:** app/src/islands/shared/VirtualMeetingManager/dateUtils.js
**Line:** 95
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

  // Add empty cells for days before month starts
  for (let i = 0; i < startingDayOfWeek; i++) {
    days.push(null);
  }
```

**Refactored Code:**
```javascript

  // Add empty cells for days before month starts
  // TODO: Refactor imperative loop to .map() or .reduce()
  for (let i = 0; i < startingDayOfWeek; i++) {

    days.push(null);
  }
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 262: Fix Using mutating array method in dateUtils.js

**File:** app/src/islands/shared/VirtualMeetingManager/dateUtils.js
**Line:** 96
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  // Add empty cells for days before month starts
  for (let i = 0; i < startingDayOfWeek; i++) {
    days.push(null);
  }
```

**Refactored Code:**
```javascript
  // Add empty cells for days before month starts
  for (let i = 0; i < startingDayOfWeek; i++) {
    days = [...days, null];
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 263: Fix Imperative loop found (consider map/filter/reduce) in dateUtils.js

**File:** app/src/islands/shared/VirtualMeetingManager/dateUtils.js
**Line:** 100
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

  // Add all days of the month
  for (let day = 1; day <= daysInMonth; day++) {
    days.push(new Date(currentMonth.getFullYear(), currentMonth.getMonth(), day));
  }
```

**Refactored Code:**
```javascript

  // Add all days of the month
  // TODO: Refactor imperative loop to .map() or .reduce()
  for (let day = 1; day <= daysInMonth; day++) {

    days.push(new Date(currentMonth.getFullYear(), currentMonth.getMonth(), day));
  }
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 264: Fix Using mutating array method in dateUtils.js

**File:** app/src/islands/shared/VirtualMeetingManager/dateUtils.js
**Line:** 101
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  // Add all days of the month
  for (let day = 1; day <= daysInMonth; day++) {
    days.push(new Date(currentMonth.getFullYear(), currentMonth.getMonth(), day));
  }
```

**Refactored Code:**
```javascript
  // Add all days of the month
  for (let day = 1; day <= daysInMonth; day++) {
    days = [...days, new Date(currentMonth.getFullYear(), currentMonth.getMonth(), day)];
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 265: Fix Imperative loop found (consider map/filter/reduce) in virtualMeetingService.js

**File:** app/src/islands/shared/VirtualMeetingManager/virtualMeetingService.js
**Line:** 312
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  let lastError = null;

  for (let attempt = 0; attempt < maxRetries; attempt++) {
    const result = await apiFunction();
```

**Refactored Code:**
```javascript
  let lastError = null;

  // TODO: Refactor imperative loop to .map() or .reduce()
  for (let attempt = 0; attempt < maxRetries; attempt++) {

    const result = await apiFunction();
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 266: Fix Using mutating array sort/reverse in aiService.js

**File:** app/src/lib/aiService.js
**Line:** 106
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  if (!Array.isArray(amenities)) return [];

  return [...amenities].sort((a, b) => {
    const aLower = a.toLowerCase();
    const bLower = b.toLowerCase();
```

**Refactored Code:**
```javascript
  if (!Array.isArray(amenities)) return [];

  return [...amenities].toSorted((a, b) => {

    const aLower = a.toLowerCase();
    const bLower = b.toLowerCase();
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 267: Fix Imperative loop found (consider map/filter/reduce) in auth.js

**File:** app/src/lib/auth.js
**Line:** 563
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      let verifyAttempts = 0;
      const maxVerifyAttempts = 5;
      while (verifyAttempts < maxVerifyAttempts) {
        const { data: { session: verifiedSession } } = await supabase.auth.getSession();
        if (verifiedSession && verifiedSession.access_token === access_token) {
```

**Refactored Code:**
```javascript
      let verifyAttempts = 0;
      const maxVerifyAttempts = 5;
      // TODO: Refactor while loop to recursive function or declarative method
      while (verifyAttempts < maxVerifyAttempts) {

        const { data: { session: verifiedSession } } = await supabase.auth.getSession();
        if (verifiedSession && verifiedSession.access_token === access_token) {
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 268: Fix Imperative loop found (consider map/filter/reduce) in auth.js

**File:** app/src/lib/auth.js
**Line:** 786
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    let verifyAttempts = 0;
    const maxVerifyAttempts = 5;
    while (verifyAttempts < maxVerifyAttempts) {
      const { data: { session: verifiedSession } } = await supabase.auth.getSession();
      if (verifiedSession && verifiedSession.access_token === access_token) {
```

**Refactored Code:**
```javascript
    let verifyAttempts = 0;
    const maxVerifyAttempts = 5;
    // TODO: Refactor while loop to recursive function or declarative method
    while (verifyAttempts < maxVerifyAttempts) {

      const { data: { session: verifiedSession } } = await supabase.auth.getSession();
      if (verifiedSession && verifiedSession.access_token === access_token) {
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 269: Fix Imperative loop found (consider map/filter/reduce) in availabilityValidation.js

**File:** app/src/lib/availabilityValidation.js
**Line:** 59
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    // Generate expected contiguous range for not-selected days
    const expectedNotSelected = [];
    for (let i = minNotSelected; i <= maxNotSelected; i++) {
      expectedNotSelected.push(i);
    }
```

**Refactored Code:**
```javascript
    // Generate expected contiguous range for not-selected days
    const expectedNotSelected = [];
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let i = minNotSelected; i <= maxNotSelected; i++) {

      expectedNotSelected.push(i);
    }
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 270: Fix Using mutating array method in availabilityValidation.js

**File:** app/src/lib/availabilityValidation.js
**Line:** 60
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    const expectedNotSelected = [];
    for (let i = minNotSelected; i <= maxNotSelected; i++) {
      expectedNotSelected.push(i);
    }
```

**Refactored Code:**
```javascript
    const expectedNotSelected = [];
    for (let i = minNotSelected; i <= maxNotSelected; i++) {
      expectedNotSelected = [...expectedNotSelected, i];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 271: Fix Using mutating array sort/reverse in availabilityValidation.js

**File:** app/src/lib/availabilityValidation.js
**Line:** 91
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  }

  const sorted = [...selectedDays].sort((a, b) => a - b);

  // Handle wrap-around case (e.g., Fri, Sat, Sun, Mon)
```

**Refactored Code:**
```javascript
  }

  const sorted = [...selectedDays].toSorted((a, b) => a - b);


  // Handle wrap-around case (e.g., Fri, Sat, Sun, Mon)
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 272: Fix Imperative loop found (consider map/filter/reduce) in availabilityValidation.js

**File:** app/src/lib/availabilityValidation.js
**Line:** 100
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    // Find gap to determine actual start/end
    let gapIndex = -1;
    for (let i = 1; i < sorted.length; i++) {
      if (sorted[i] !== sorted[i - 1] + 1) {
        gapIndex = i;
```

**Refactored Code:**
```javascript
    // Find gap to determine actual start/end
    let gapIndex = -1;
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let i = 1; i < sorted.length; i++) {

      if (sorted[i] !== sorted[i - 1] + 1) {
        gapIndex = i;
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 273: Fix Using mutating array method in availabilityValidation.js

**File:** app/src/lib/availabilityValidation.js
**Line:** 160
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  if (!selectedDays || selectedDays.length === 0) {
    result.valid = false;
    result.errors.push('Please select at least one day');
    return result;
  }
```

**Refactored Code:**
```javascript
  if (!selectedDays || selectedDays.length === 0) {
    result.valid = false;
    errors = [...errors, 'Please select at least one day'];
    return result;
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 274: Fix Using mutating array method in availabilityValidation.js

**File:** app/src/lib/availabilityValidation.js
**Line:** 169
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    result.valid = false;
    result.showTutorial = true;
    result.errors.push('Please check for contiguous nights to continue with your proposal');
    return result;
  }
```

**Refactored Code:**
```javascript
    result.valid = false;
    result.showTutorial = true;
    errors = [...errors, 'Please check for contiguous nights to continue with your proposal'];
    return result;
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 275: Fix Using mutating array method in availabilityValidation.js

**File:** app/src/lib/availabilityValidation.js
**Line:** 175
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  // Check against minimum nights
  if (listing['Minimum Nights'] && selectedDays.length < listing['Minimum Nights']) {
    result.warnings.push(`Host prefers at least ${listing['Minimum Nights']} nights per week`);
  }
```

**Refactored Code:**
```javascript
  // Check against minimum nights
  if (listing['Minimum Nights'] && selectedDays.length < listing['Minimum Nights']) {
    warnings = [...warnings, `Host prefers at least ${listing['Minimum Nights']} nights per week`];
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 276: Fix Using mutating array method in availabilityValidation.js

**File:** app/src/lib/availabilityValidation.js
**Line:** 180
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  // Check against maximum nights
  if (listing['Maximum Nights'] && selectedDays.length > listing['Maximum Nights']) {
    result.warnings.push(`Host prefers at most ${listing['Maximum Nights']} nights per week`);
  }
```

**Refactored Code:**
```javascript
  // Check against maximum nights
  if (listing['Maximum Nights'] && selectedDays.length > listing['Maximum Nights']) {
    warnings = [...warnings, `Host prefers at most ${listing['Maximum Nights']} nights per week`];
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 277: Fix Using mutating array method in availabilityValidation.js

**File:** app/src/lib/availabilityValidation.js
**Line:** 193
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    if (unavailableSelected.length > 0) {
      result.valid = false;
      result.errors.push('Some selected days are not available for this listing');
    }
  }
```

**Refactored Code:**
```javascript
    if (unavailableSelected.length > 0) {
      result.valid = false;
      errors = [...errors, 'Some selected days are not available for this listing'];
    }
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 278: Fix Using mutating array method in availabilityValidation.js

**File:** app/src/lib/availabilityValidation.js
**Line:** 265
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  if (!moveInDate) {
    result.valid = false;
    result.errors.push('Please select a move-in date');
    return result;
  }
```

**Refactored Code:**
```javascript
  if (!moveInDate) {
    result.valid = false;
    errors = [...errors, 'Please select a move-in date'];
    return result;
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 279: Fix Using mutating array method in availabilityValidation.js

**File:** app/src/lib/availabilityValidation.js
**Line:** 274
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  if (moveInDate < today) {
    result.valid = false;
    result.errors.push('Move-in date cannot be in the past');
    return result;
  }
```

**Refactored Code:**
```javascript
  if (moveInDate < today) {
    result.valid = false;
    errors = [...errors, 'Move-in date cannot be in the past'];
    return result;
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 280: Fix Using mutating array method in availabilityValidation.js

**File:** app/src/lib/availabilityValidation.js
**Line:** 281
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  if (!isDateInRange(moveInDate, listing['First Available'], listing['Last Available'])) {
    result.valid = false;
    result.errors.push('Move-in date is outside available range');
    return result;
  }
```

**Refactored Code:**
```javascript
  if (!isDateInRange(moveInDate, listing['First Available'], listing['Last Available'])) {
    result.valid = false;
    errors = [...errors, 'Move-in date is outside available range'];
    return result;
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 281: Fix Using mutating array method in availabilityValidation.js

**File:** app/src/lib/availabilityValidation.js
**Line:** 288
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  if (isDateBlocked(moveInDate, listing['Dates - Blocked'])) {
    result.valid = false;
    result.errors.push('Selected move-in date is not available');
    return result;
  }
```

**Refactored Code:**
```javascript
  if (isDateBlocked(moveInDate, listing['Dates - Blocked'])) {
    result.valid = false;
    errors = [...errors, 'Selected move-in date is not available'];
    return result;
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 282: Fix Using mutating array method in availabilityValidation.js

**File:** app/src/lib/availabilityValidation.js
**Line:** 299
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    if (checkInDay !== null && moveInDayOfWeek !== checkInDay) {
      result.valid = false;
      result.errors.push(`Move-in date must be on a ${DAY_NAMES[checkInDay]} based on your selected schedule`);
    }
  }
```

**Refactored Code:**
```javascript
    if (checkInDay !== null && moveInDayOfWeek !== checkInDay) {
      result.valid = false;
      errors = [...errors, `Move-in date must be on a ${DAY_NAMES[checkInDay]} based on your selected schedule`];
    }
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 283: Fix Using mutating array method in dataLookups.js

**File:** app/src/lib/dataLookups.js
**Line:** 562
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  const policies = [];
  lookupCache.cancellationPolicies.forEach((policy, id) => {
    policies.push({ id, display: policy.display });
  });
  return policies;
```

**Refactored Code:**
```javascript
  const policies = [];
  lookupCache.cancellationPolicies.forEach((policy, id) => {
    policies = [...policies, { id, display: policy.display }];
  });
  return policies;
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 284: Fix Using mutating array method in dataLookups.js

**File:** app/src/lib/dataLookups.js
**Line:** 592
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  const reasons = [];
  lookupCache.guestCancellationReasons.forEach((data, id) => {
    reasons.push({
      id,
      reason: data.reason,
```

**Refactored Code:**
```javascript
  const reasons = [];
  lookupCache.guestCancellationReasons.forEach((data, id) => {
    // TODO: Refactor mutation to declarative
    // reasons.push({
      id,
      reason: data.reason,
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 285: Fix Using mutating array sort/reverse in dataLookups.js

**File:** app/src/lib/dataLookups.js
**Line:** 598
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    });
  });
  return reasons.sort((a, b) => a.displayOrder - b.displayOrder);
}
```

**Refactored Code:**
```javascript
    });
  });
  return [...reasons].sort((a, b) => a.displayOrder - b.displayOrder);

}
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 286: Fix Using mutating array method in dataLookups.js

**File:** app/src/lib/dataLookups.js
**Line:** 609
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  const reasons = [];
  lookupCache.hostCancellationReasons.forEach((data, id) => {
    reasons.push({
      id,
      reason: data.reason,
```

**Refactored Code:**
```javascript
  const reasons = [];
  lookupCache.hostCancellationReasons.forEach((data, id) => {
    // TODO: Refactor mutation to declarative
    // reasons.push({
      id,
      reason: data.reason,
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 287: Fix Using mutating array sort/reverse in dataLookups.js

**File:** app/src/lib/dataLookups.js
**Line:** 615
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    });
  });
  return reasons.sort((a, b) => a.displayOrder - b.displayOrder);
}
```

**Refactored Code:**
```javascript
    });
  });
  return [...reasons].sort((a, b) => a.displayOrder - b.displayOrder);

}
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 288: Fix Using mutating array method in hotjar.js

**File:** app/src/lib/hotjar.js
**Line:** 18
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

  (function(h,o,t,j,a,r){
      h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
      h._hjSettings={hjid:siteId,hjsv:6};
      a=o.getElementsByTagName('head')[0];
```

**Refactored Code:**
```javascript

  (function(h,o,t,j,a,r){
      // TODO: Refactor mutation to declarative
      // h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
      h._hjSettings={hjid:siteId,hjsv:6};
      a=o.getElementsByTagName('head')[0];
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 289: Fix Using mutating array sort/reverse in listingDataFetcher.js

**File:** app/src/lib/listingDataFetcher.js
**Line:** 201
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

    // Sort photos (main photo first, then by SortOrder, then by _id)
    sortedPhotos = sortedPhotos.sort((a, b) => {
      if (a.toggleMainPhoto) return -1;
      if (b.toggleMainPhoto) return 1;
```

**Refactored Code:**
```javascript

    // Sort photos (main photo first, then by SortOrder, then by _id)
    sortedPhotos = [...sortedPhotos].sort((a, b) => {

      if (a.toggleMainPhoto) return -1;
      if (b.toggleMainPhoto) return 1;
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 290: Fix Using mutating array method in listingService.js

**File:** app/src/lib/listingService.js
**Line:** 335
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  const currentListings = userData.Listings || [];
  if (!currentListings.includes(listingId)) {
    currentListings.push(listingId);
  }
```

**Refactored Code:**
```javascript
  const currentListings = userData.Listings || [];
  if (!currentListings.includes(listingId)) {
    currentListings = [...currentListings, listingId];
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 291: Fix Imperative loop found (consider map/filter/reduce) in listingService.js

**File:** app/src/lib/listingService.js
**Line:** 766
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  const dayOrder = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];

  for (const day of dayOrder) {
    if (availableNights[day] && dayNameMapping[day]) {
      result.push(dayNameMapping[day]);
```

**Refactored Code:**
```javascript
  const dayOrder = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];

  // TODO: Refactor imperative loop to .map() or .reduce()
  for (const day of dayOrder) {

    if (availableNights[day] && dayNameMapping[day]) {
      result.push(dayNameMapping[day]);
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 292: Fix Using mutating array method in listingService.js

**File:** app/src/lib/listingService.js
**Line:** 768
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  for (const day of dayOrder) {
    if (availableNights[day] && dayNameMapping[day]) {
      result.push(dayNameMapping[day]);
    }
  }
```

**Refactored Code:**
```javascript
  for (const day of dayOrder) {
    if (availableNights[day] && dayNameMapping[day]) {
      result = [...result, dayNameMapping[day]];
    }
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 293: Fix Imperative loop found (consider map/filter/reduce) in listingService.js

**File:** app/src/lib/listingService.js
**Line:** 982
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  const normalized = {};

  for (const [key, value] of Object.entries(formData)) {
    // Check if this key needs to be remapped
    if (columnNameMap[key]) {
```

**Refactored Code:**
```javascript
  const normalized = {};

  // TODO: Refactor imperative loop to .map() or .reduce()
  for (const [key, value] of Object.entries(formData)) {

    // Check if this key needs to be remapped
    if (columnNameMap[key]) {
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 294: Fix Imperative loop found (consider map/filter/reduce) in listingService.js

**File:** app/src/lib/listingService.js
**Line:** 1076
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

  const result = [];
  for (const [day, isSelected] of Object.entries(availableNights)) {
    if (isSelected && dayMapping[day] !== undefined) {
      result.push(dayMapping[day]);
```

**Refactored Code:**
```javascript

  const result = [];
  // TODO: Refactor imperative loop to .map() or .reduce()
  for (const [day, isSelected] of Object.entries(availableNights)) {

    if (isSelected && dayMapping[day] !== undefined) {
      result.push(dayMapping[day]);
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 295: Fix Using mutating array method in listingService.js

**File:** app/src/lib/listingService.js
**Line:** 1078
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  for (const [day, isSelected] of Object.entries(availableNights)) {
    if (isSelected && dayMapping[day] !== undefined) {
      result.push(dayMapping[day]);
    }
  }
```

**Refactored Code:**
```javascript
  for (const [day, isSelected] of Object.entries(availableNights)) {
    if (isSelected && dayMapping[day] !== undefined) {
      result = [...result, dayMapping[day]];
    }
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 296: Fix Using mutating array sort/reverse in listingService.js

**File:** app/src/lib/listingService.js
**Line:** 1082
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  }

  return result.sort((a, b) => a - b);
}
```

**Refactored Code:**
```javascript
  }

  return [...result].sort((a, b) => a - b);

}
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 297: Fix Imperative loop found (consider map/filter/reduce) in listingService.js

**File:** app/src/lib/listingService.js
**Line:** 1240
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

  if (Array.isArray(daysArray)) {
    for (const dayNum of daysArray) {
      const dayName = dayMapping[dayNum];
      if (dayName) {
```

**Refactored Code:**
```javascript

  if (Array.isArray(daysArray)) {
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (const dayNum of daysArray) {

      const dayName = dayMapping[dayNum];
      if (dayName) {
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 298: Fix Imperative loop found (consider map/filter/reduce) in photoUpload.js

**File:** app/src/lib/photoUpload.js
**Line:** 28
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  const byteArrays = [];

  for (let offset = 0; offset < byteCharacters.length; offset += 512) {
    const slice = byteCharacters.slice(offset, offset + 512);
    const byteNumbers = new Array(slice.length);
```

**Refactored Code:**
```javascript
  const byteArrays = [];

  // TODO: Refactor imperative loop to .map() or .reduce()
  for (let offset = 0; offset < byteCharacters.length; offset += 512) {

    const slice = byteCharacters.slice(offset, offset + 512);
    const byteNumbers = new Array(slice.length);
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 299: Fix Imperative loop found (consider map/filter/reduce) in photoUpload.js

**File:** app/src/lib/photoUpload.js
**Line:** 32
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    const byteNumbers = new Array(slice.length);

    for (let i = 0; i < slice.length; i++) {
      byteNumbers[i] = slice.charCodeAt(i);
    }
```

**Refactored Code:**
```javascript
    const byteNumbers = new Array(slice.length);

    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let i = 0; i < slice.length; i++) {

      byteNumbers[i] = slice.charCodeAt(i);
    }
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 300: Fix Using mutating array method in photoUpload.js

**File:** app/src/lib/photoUpload.js
**Line:** 36
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    }

    byteArrays.push(new Uint8Array(byteNumbers));
  }
```

**Refactored Code:**
```javascript
    }

    byteArrays = [...byteArrays, new Uint8Array(byteNumbers)];
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 301: Fix Using mutating array method in photoUpload.js

**File:** app/src/lib/photoUpload.js
**Line:** 86
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  if (photo.file instanceof File) {
    blob = photo.file;
    extension = photo.file.name.split('.').pop().toLowerCase() || 'jpg';
  } else if (photo.url && photo.url.startsWith('data:')) {
    // Convert data URL to blob
```

**Refactored Code:**
```javascript
  if (photo.file instanceof File) {
    blob = photo.file;
    // TODO: Fix ViolationType.MUTATING_METHOD
    extension = photo.file.name.split('.').pop().toLowerCase() || 'jpg';

  } else if (photo.url && photo.url.startsWith('data:')) {
    // Convert data URL to blob
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 302: Fix Imperative loop found (consider map/filter/reduce) in photoUpload.js

**File:** app/src/lib/photoUpload.js
**Line:** 164
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  const uploadedPhotos = [];

  for (let i = 0; i < photos.length; i++) {
    const photo = photos[i];
```

**Refactored Code:**
```javascript
  const uploadedPhotos = [];

  // TODO: Refactor imperative loop to .map() or .reduce()
  for (let i = 0; i < photos.length; i++) {

    const photo = photos[i];
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 303: Fix Using mutating array method in photoUpload.js

**File:** app/src/lib/photoUpload.js
**Line:** 170
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      const result = await uploadPhoto(photo, listingId, i);

      uploadedPhotos.push({
        id: photo.id || `photo_${i}_${Date.now()}`,
        url: result.url,
```

**Refactored Code:**
```javascript
      const result = await uploadPhoto(photo, listingId, i);

      // TODO: Refactor mutation to declarative
      // uploadedPhotos.push({
        id: photo.id || `photo_${i}_${Date.now()}`,
        url: result.url,
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 304: Fix Using mutating array method in photoUpload.js

**File:** app/src/lib/photoUpload.js
**Line:** 184
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      console.error(`[PhotoUpload] Failed to upload photo ${i + 1}:`, error);
      // Continue with other photos, don't fail the entire upload
      uploadedPhotos.push({
        id: photo.id || `photo_${i}_${Date.now()}`,
        url: photo.url, // Keep data URL as fallback
```

**Refactored Code:**
```javascript
      console.error(`[PhotoUpload] Failed to upload photo ${i + 1}:`, error);
      // Continue with other photos, don't fail the entire upload
      // TODO: Refactor mutation to declarative
      // uploadedPhotos.push({
        id: photo.id || `photo_${i}_${Date.now()}`,
        url: photo.url, // Keep data URL as fallback
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 305: Fix Using mutating array method in userProposalQueries.js

**File:** app/src/lib/proposals/userProposalQueries.js
**Line:** 225
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    } else {
      // Legacy format - need to fetch from listing_photo table
      listingsNeedingPhotoFetch.push(listing._id);
    }
  });
```

**Refactored Code:**
```javascript
    } else {
      // Legacy format - need to fetch from listing_photo table
      listingsNeedingPhotoFetch = [...listingsNeedingPhotoFetch, listing._id];
    }
  });
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 306: Fix Using mutating array sort/reverse in dayHelpers.js

**File:** app/src/lib/scheduleSelector/dayHelpers.js
**Line:** 44
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
 */
export const sortDays = (days) => {
  return [...days].sort((a, b) => a.dayOfWeek - b.dayOfWeek);
};
```

**Refactored Code:**
```javascript
 */
export const sortDays = (days) => {
  return [...days].toSorted((a, b) => a.dayOfWeek - b.dayOfWeek);

};
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 307: Fix Imperative loop found (consider map/filter/reduce) in dayHelpers.js

**File:** app/src/lib/scheduleSelector/dayHelpers.js
**Line:** 112
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

  // Nights are between check-in and check-out (days - 1)
  for (let i = 0; i < sortedDays.length - 1; i++) {
    nights.push(createNight(sortedDays[i].dayOfWeek));
  }
```

**Refactored Code:**
```javascript

  // Nights are between check-in and check-out (days - 1)
  // TODO: Refactor imperative loop to .map() or .reduce()
  for (let i = 0; i < sortedDays.length - 1; i++) {

    nights.push(createNight(sortedDays[i].dayOfWeek));
  }
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 308: Fix Using mutating array method in dayHelpers.js

**File:** app/src/lib/scheduleSelector/dayHelpers.js
**Line:** 113
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  // Nights are between check-in and check-out (days - 1)
  for (let i = 0; i < sortedDays.length - 1; i++) {
    nights.push(createNight(sortedDays[i].dayOfWeek));
  }
```

**Refactored Code:**
```javascript
  // Nights are between check-in and check-out (days - 1)
  for (let i = 0; i < sortedDays.length - 1; i++) {
    nights = [...nights, createNight(sortedDays[i].dayOfWeek)];
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 309: Fix Imperative loop found (consider map/filter/reduce) in nightCalculations.js

**File:** app/src/lib/scheduleSelector/nightCalculations.js
**Line:** 14
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  // Nights are the periods between consecutive days
  // For example: Mon, Tue, Wed selected = Mon night, Tue night (2 nights)
  for (let i = 0; i < sorted.length - 1; i++) {
    nights.push(createNight(sorted[i].dayOfWeek));
  }
```

**Refactored Code:**
```javascript
  // Nights are the periods between consecutive days
  // For example: Mon, Tue, Wed selected = Mon night, Tue night (2 nights)
  // TODO: Refactor imperative loop to .map() or .reduce()
  for (let i = 0; i < sorted.length - 1; i++) {

    nights.push(createNight(sorted[i].dayOfWeek));
  }
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 310: Fix Using mutating array method in nightCalculations.js

**File:** app/src/lib/scheduleSelector/nightCalculations.js
**Line:** 15
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  // For example: Mon, Tue, Wed selected = Mon night, Tue night (2 nights)
  for (let i = 0; i < sorted.length - 1; i++) {
    nights.push(createNight(sorted[i].dayOfWeek));
  }
```

**Refactored Code:**
```javascript
  // For example: Mon, Tue, Wed selected = Mon night, Tue night (2 nights)
  for (let i = 0; i < sorted.length - 1; i++) {
    nights = [...nights, createNight(sorted[i].dayOfWeek)];
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 311: Fix Imperative loop found (consider map/filter/reduce) in nightCalculations.js

**File:** app/src/lib/scheduleSelector/nightCalculations.js
**Line:** 50
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    let gapStart = -1;

    for (let i = 0; i < dayNumbers.length - 1; i++) {
      if (dayNumbers[i + 1] - dayNumbers[i] > 1) {
        // Found a gap
```

**Refactored Code:**
```javascript
    let gapStart = -1;

    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let i = 0; i < dayNumbers.length - 1; i++) {

      if (dayNumbers[i + 1] - dayNumbers[i] > 1) {
        // Found a gap
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 312: Fix Imperative loop found (consider map/filter/reduce) in validators.js

**File:** app/src/lib/scheduleSelector/validators.js
**Line:** 101
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    // Generate expected contiguous range for not-selected days
    const expectedNotSelected = [];
    for (let i = minNotSelected; i <= maxNotSelected; i++) {
      expectedNotSelected.push(i);
    }
```

**Refactored Code:**
```javascript
    // Generate expected contiguous range for not-selected days
    const expectedNotSelected = [];
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let i = minNotSelected; i <= maxNotSelected; i++) {

      expectedNotSelected.push(i);
    }
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 313: Fix Using mutating array method in validators.js

**File:** app/src/lib/scheduleSelector/validators.js
**Line:** 102
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    const expectedNotSelected = [];
    for (let i = minNotSelected; i <= maxNotSelected; i++) {
      expectedNotSelected.push(i);
    }
```

**Refactored Code:**
```javascript
    const expectedNotSelected = [];
    for (let i = minNotSelected; i <= maxNotSelected; i++) {
      expectedNotSelected = [...expectedNotSelected, i];
    }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 314: Fix Imperative loop found (consider map/filter/reduce) in validators.js

**File:** app/src/lib/scheduleSelector/validators.js
**Line:** 114
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  // Normal case: no wrap-around, check standard contiguity
  let normallyContiguous = true;
  for (let i = 0; i < dayNumbers.length - 1; i++) {
    if (dayNumbers[i + 1] - dayNumbers[i] !== 1) {
      normallyContiguous = false;
```

**Refactored Code:**
```javascript
  // Normal case: no wrap-around, check standard contiguity
  let normallyContiguous = true;
  // TODO: Refactor imperative loop to .map() or .reduce()
  for (let i = 0; i < dayNumbers.length - 1; i++) {

    if (dayNumbers[i + 1] - dayNumbers[i] !== 1) {
      normallyContiguous = false;
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 315: Fix Imperative loop found (consider map/filter/reduce) in secureStorage.js

**File:** app/src/lib/secureStorage.js
**Line:** 233
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  // Clear Supabase auth storage (keys follow pattern: sb-<project-ref>-auth-token)
  const keysToRemove = [];
  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key && (key.startsWith('sb-') || key.startsWith('supabase.'))) {
```

**Refactored Code:**
```javascript
  // Clear Supabase auth storage (keys follow pattern: sb-<project-ref>-auth-token)
  const keysToRemove = [];
  // TODO: Refactor imperative loop to .map() or .reduce()
  for (let i = 0; i < localStorage.length; i++) {

    const key = localStorage.key(i);
    if (key && (key.startsWith('sb-') || key.startsWith('supabase.'))) {
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 316: Fix Using mutating array method in secureStorage.js

**File:** app/src/lib/secureStorage.js
**Line:** 236
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    const key = localStorage.key(i);
    if (key && (key.startsWith('sb-') || key.startsWith('supabase.'))) {
      keysToRemove.push(key);
    }
  }
```

**Refactored Code:**
```javascript
    const key = localStorage.key(i);
    if (key && (key.startsWith('sb-') || key.startsWith('supabase.'))) {
      keysToRemove = [...keysToRemove, key];
    }
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 317: Fix Imperative loop found (consider map/filter/reduce) in supabaseUtils.js

**File:** app/src/lib/supabaseUtils.js
**Line:** 178
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  const photoUrls = [];

  for (const photo of photos) {
    // New embedded format: photo is an object with url/Photo field
    if (typeof photo === 'object' && photo !== null) {
```

**Refactored Code:**
```javascript
  const photoUrls = [];

  // TODO: Refactor imperative loop to .map() or .reduce()
  for (const photo of photos) {

    // New embedded format: photo is an object with url/Photo field
    if (typeof photo === 'object' && photo !== null) {
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 318: Fix Using mutating array method in supabaseUtils.js

**File:** app/src/lib/supabaseUtils.js
**Line:** 189
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
          photoUrl = 'https:' + photoUrl;
        }
        photoUrls.push(photoUrl);
      }
      continue;
```

**Refactored Code:**
```javascript
          photoUrl = 'https:' + photoUrl;
        }
        photoUrls = [...photoUrls, photoUrl];
      }
      continue;
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 319: Fix Using mutating array method in supabaseUtils.js

**File:** app/src/lib/supabaseUtils.js
**Line:** 203
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
          photoUrl = 'https:' + photoUrl;
        }
        photoUrls.push(photoUrl);
        continue;
      }
```

**Refactored Code:**
```javascript
          photoUrl = 'https:' + photoUrl;
        }
        photoUrls = [...photoUrls, photoUrl];
        continue;
      }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 320: Fix Using mutating array method in supabaseUtils.js

**File:** app/src/lib/supabaseUtils.js
**Line:** 210
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      const url = photoMap[photo];
      if (url) {
        photoUrls.push(url);
      }
      continue;
```

**Refactored Code:**
```javascript
      const url = photoMap[photo];
      if (url) {
        photoUrls = [...photoUrls, url];
      }
      continue;
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 321: Fix Imperative loop found (consider map/filter/reduce) in supabaseUtils.js

**File:** app/src/lib/supabaseUtils.js
**Line:** 258
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    const featureText = typeof features === 'string' ? features.toLowerCase() : '';

    for (const [key, amenity] of Object.entries(amenitiesMap)) {
      if (featureText.includes(key) && !foundAmenities.has(amenity.name)) {
        amenities.push(amenity);
```

**Refactored Code:**
```javascript
    const featureText = typeof features === 'string' ? features.toLowerCase() : '';

    // TODO: Refactor imperative loop to .map() or .reduce()
    for (const [key, amenity] of Object.entries(amenitiesMap)) {

      if (featureText.includes(key) && !foundAmenities.has(amenity.name)) {
        amenities.push(amenity);
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 322: Fix Using mutating array method in supabaseUtils.js

**File:** app/src/lib/supabaseUtils.js
**Line:** 260
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    for (const [key, amenity] of Object.entries(amenitiesMap)) {
      if (featureText.includes(key) && !foundAmenities.has(amenity.name)) {
        amenities.push(amenity);
        foundAmenities.add(amenity.name);
      }
```

**Refactored Code:**
```javascript
    for (const [key, amenity] of Object.entries(amenitiesMap)) {
      if (featureText.includes(key) && !foundAmenities.has(amenity.name)) {
        amenities = [...amenities, amenity];
        foundAmenities.add(amenity.name);
      }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 323: Fix Using mutating array method in supabaseUtils.js

**File:** app/src/lib/supabaseUtils.js
**Line:** 269
**Violation:** MUTATING_METHOD - Using mutating array method
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  const kitchenType = dbListing['Kitchen Type'];
  if (kitchenType && kitchenType.toLowerCase().includes('kitchen') && !foundAmenities.has('Kitchen')) {
    amenities.push(amenitiesMap['kitchen']);
    foundAmenities.add('Kitchen');
  }
```

**Refactored Code:**
```javascript
  const kitchenType = dbListing['Kitchen Type'];
  if (kitchenType && kitchenType.toLowerCase().includes('kitchen') && !foundAmenities.has('Kitchen')) {
    amenities = [...amenities, amenitiesMap['kitchen']];
    foundAmenities.add('Kitchen');
  }
```

**Why This Matters:**
Mutating methods modify the original array, making code harder to test and reason about.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 324: Fix Using mutating array sort/reverse in supabaseUtils.js

**File:** app/src/lib/supabaseUtils.js
**Line:** 274
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript

  // Sort by priority (lower number = higher priority)
  amenities.sort((a, b) => a.priority - b.priority);

  return amenities; // Return empty array if no amenities found - this is truthful, not a fallback
```

**Refactored Code:**
```javascript

  // Sort by priority (lower number = higher priority)
  [...amenities].sort((a, b) => a.priority - b.priority);


  return amenities; // Return empty array if no amenities found - this is truthful, not a fallback
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 325: Fix Imperative loop found (consider map/filter/reduce) in workflowClient.js

**File:** app/src/lib/workflowClient.js
**Line:** 139
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  const startTime = Date.now();

  while (Date.now() - startTime < timeout) {
    const status = await getWorkflowStatus(executionId);
```

**Refactored Code:**
```javascript
  const startTime = Date.now();

  // TODO: Refactor while loop to recursive function or declarative method
  while (Date.now() - startTime < timeout) {

    const status = await getWorkflowStatus(executionId);
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 326: Fix Using mutating array sort/reverse in calculateCheckInOutDays.js

**File:** app/src/logic/calculators/scheduling/calculateCheckInOutDays.js
**Line:** 50
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  }

  const sorted = [...selectedDays].sort((a, b) => a - b)

  // Handle wrap-around case (selection includes both Sunday=0 and Saturday=6)
```

**Refactored Code:**
```javascript
  }

  const sorted = [...selectedDays].toSorted((a, b) => a - b)


  // Handle wrap-around case (selection includes both Sunday=0 and Saturday=6)
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 327: Fix Imperative loop found (consider map/filter/reduce) in calculateCheckInOutDays.js

**File:** app/src/logic/calculators/scheduling/calculateCheckInOutDays.js
**Line:** 59
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
    // Find gap to determine actual start/end
    let gapIndex = -1
    for (let i = 1; i < sorted.length; i++) {
      if (sorted[i] !== sorted[i - 1] + 1) {
        gapIndex = i
```

**Refactored Code:**
```javascript
    // Find gap to determine actual start/end
    let gapIndex = -1
    // TODO: Refactor imperative loop to .map() or .reduce()
    for (let i = 1; i < sorted.length; i++) {

      if (sorted[i] !== sorted[i - 1] + 1) {
        gapIndex = i
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 328: Fix Using mutating array sort/reverse in calculateNextAvailableCheckIn.js

**File:** app/src/logic/calculators/scheduling/calculateNextAvailableCheckIn.js
**Line:** 54
**Violation:** MUTATING_METHOD - Using mutating array sort/reverse
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  // Get the first selected day (check-in day of week)
  // Days should already be sorted, but sort to be safe
  const sortedDays = [...selectedDayIndices].sort((a, b) => a - b)
  const firstDayOfWeek = sortedDays[0]
```

**Refactored Code:**
```javascript
  // Get the first selected day (check-in day of week)
  // Days should already be sorted, but sort to be safe
  const sortedDays = [...selectedDayIndices].toSorted((a, b) => a - b)

  const firstDayOfWeek = sortedDays[0]
```

**Why This Matters:**
sort() and reverse() mutate the original array. Use immutable alternatives.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 329: Fix I/O operation found in core business logic in extractListingCoordinates.js

**File:** app/src/logic/processors/listing/extractListingCoordinates.js
**Line:** 46
**Violation:** IO_IN_CORE - I/O operation found in core business logic
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      parsedSlightlyDifferent = JSON.parse(locationSlightlyDifferent)
    } catch (error) {
      console.error(
        ' extractListingCoordinates: Failed to parse Location - slightly different address:',
        {
```

**Refactored Code:**
```javascript
      parsedSlightlyDifferent = JSON.parse(locationSlightlyDifferent)
    } catch (error) {
      // TODO: Move I/O operation to the edge/handler
      // console.error(
        ' extractListingCoordinates: Failed to parse Location - slightly different address:',
        {
```

**Why This Matters:**
Pure business logic (calculators/rules/processors) should not perform I/O. This makes testing harder and violates Functional Core principle.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 330: Fix I/O operation found in core business logic in extractListingCoordinates.js

**File:** app/src/logic/processors/listing/extractListingCoordinates.js
**Line:** 62
**Violation:** IO_IN_CORE - I/O operation found in core business logic
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      parsedAddress = JSON.parse(locationAddress)
    } catch (error) {
      console.error(' extractListingCoordinates: Failed to parse Location - Address:', {
        listingId,
        rawValue: locationAddress,
```

**Refactored Code:**
```javascript
      parsedAddress = JSON.parse(locationAddress)
    } catch (error) {
      // TODO: Move I/O operation to the edge/handler
      // console.error(' extractListingCoordinates: Failed to parse Location - Address:', {
        listingId,
        rawValue: locationAddress,
```

**Why This Matters:**
Pure business logic (calculators/rules/processors) should not perform I/O. This makes testing harder and violates Functional Core principle.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 331: Fix I/O operation found in core business logic in processUserData.js

**File:** app/src/logic/processors/user/processUserData.js
**Line:** 58
**Violation:** IO_IN_CORE - I/O operation found in core business logic
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
      // Use a default for users without any name fields
      fullName = 'Guest User'
      console.warn(`processUserData: User ${rawUser._id} has no name fields, using default`)
    }
  }
```

**Refactored Code:**
```javascript
      // Use a default for users without any name fields
      fullName = 'Guest User'
      // TODO: Move I/O operation to the edge/handler
      // console.warn(`processUserData: User ${rawUser._id} has no name fields, using default`)
    }
  }
```

**Why This Matters:**
Pure business logic (calculators/rules/processors) should not perform I/O. This makes testing harder and violates Functional Core principle.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected

~~~~~

## CHUNK 332: Fix Imperative loop found (consider map/filter/reduce) in isScheduleContiguous.js

**File:** app/src/logic/rules/scheduling/isScheduleContiguous.js
**Line:** 64
**Violation:** IMPERATIVE_LOOP - Imperative loop found (consider map/filter/reduce)
**Severity:** High

**Expected Affected Pages:** AUTO

**Current Code:**
```javascript
  // Check for standard contiguous sequence (no wrap around)
  let isStandardContiguous = true
  for (let i = 1; i < sorted.length; i++) {
    if (sorted[i] !== sorted[i - 1] + 1) {
      isStandardContiguous = false
```

**Refactored Code:**
```javascript
  // Check for standard contiguous sequence (no wrap around)
  let isStandardContiguous = true
  // TODO: Refactor imperative loop to .map() or .reduce()
  for (let i = 1; i < sorted.length; i++) {

    if (sorted[i] !== sorted[i - 1] + 1) {
      isStandardContiguous = false
```

**Why This Matters:**
Declarative array methods (map/filter/reduce) are more expressive and less error-prone than imperative loops.

**Testing:**
- [ ] Verify the page loads without errors
- [ ] Check that the functionality (sorting/adding) works as expected
