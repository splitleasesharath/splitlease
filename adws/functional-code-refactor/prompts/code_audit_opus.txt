/prime {target_path}

/ralph-loop:ralph-loop

You are auditing the codebase at `{target_path}` for **{audit_type}** improvements.

## Dependency Analysis Context

{high_impact_summary}

## Refactoring Guidelines

Based on the dependency analysis above:
- **Leaf files (0 dependents)**: Safe to modify first
- **CIRCULAR IMPORTS**: Must be modified together as atomic unit
- **HIGH impact files (30+ dependents)**: Require careful consideration - changes cascade widely

## Your Task

1. **Read all .js and .jsx files** in `{target_path}` recursively
2. **Identify refactoring opportunities**:
   - {audit_type} issues
   - Anti-patterns (mutation, side effects, impure functions)
   - Code duplication
   - Missing abstractions
3. **Create a comprehensive implementation plan**

## Output Requirements

Create an implementation plan at: `adws/adw_plans/{timestamp}_implementation_plan.md`

### Required Structure

```markdown
# Implementation Plan - {target_path}

**Date:** {date}
**Audit Type:** {audit_type}
**Generated By:** Claude Opus (ADW Pipeline)

---

## Summary

| Metric | Value |
|--------|-------|
| Files to modify | [count] |
| Risk level | LOW / MEDIUM / HIGH |
| Estimated changes | [brief description] |

## Implementation Order

List files in dependency order (leaves first):
1. `path/to/leaf-file.js` - No dependents
2. `path/to/mid-file.js` - Depends on #1
3. `path/to/root-file.js` - Depends on #1, #2

---

## File Changes

### 1. `path/to/file.js`

**Reason:** [Why this file needs changes]
**Dependents:** [Files that import this - from dependency analysis]
**Risk:** LOW / MEDIUM / HIGH

#### Current Code
```javascript
// COMPLETE current code (not snippets)
```

#### Refactored Code
```javascript
// COMPLETE refactored code
```

#### Changes Made
- [Bullet point summary of changes]

---

### 2. `path/to/next-file.js`
... [repeat for each file]

---

## Verification Steps

After implementation, verify with:
1. `bun run lint` - Expect 0 errors
2. `bun run build` - Expect successful build
3. Visual check pages: [list affected pages]

## Rollback Plan

If validation fails, reset these files:
- `path/to/file1.js`
- `path/to/file2.js`
```

## CRITICAL RULES

1. **COMPLETE CODE BLOCKS**: Include the entire function/module, not snippets
2. **DEPENDENCY ORDER**: Follow the order from dependency analysis (leaves first)
3. **CASCADING CHANGES**: If you modify exports, include ALL importing files
4. **ATOMIC CYCLES**: Files in circular imports MUST all be in the plan
5. **NO PARTIAL PLANS**: Every file change must have both Current and Refactored code

## Progressive Disclosure

Use `/ralph-loop` to iterate until the plan is complete:
- First pass: Identify all files that need changes
- Second pass: Write Current Code sections
- Third pass: Write Refactored Code sections
- Fourth pass: Verify completeness and dependency order

When the plan is complete and saved to the output file, respond with:
```
PLAN COMPLETE: adws/adw_plans/{timestamp}_implementation_plan.md
Files: [count]
Ready for implementation phase.
```
