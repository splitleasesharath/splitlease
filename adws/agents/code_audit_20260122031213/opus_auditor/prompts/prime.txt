/prime ../app

/ralph-loop:ralph-loop

You are auditing the codebase at `../app` for **general** improvements.

## Dependency Analysis Context

## Dependency Impact Analysis
Files: 806 | Edge reduction: 16%

### CRITICAL IMPACT (30+ dependents) - Avoid modifying
| File | Dependents |
|------|------------|
| `src\lib\supabase.js` | 112 |
| `src\lib\auth.js` | 100 |
| `src\lib\secureStorage.js` | 89 |
| `src\islands\shared\Toast.jsx` | 51 |
| `src\lib\constants.js` | 51 |
| `src\islands\shared\ErrorBoundary.jsx` | 45 |
| `src\styles\main.css` | 43 |
| `src\islands\shared\Header.jsx` | 41 |
| `src\lib\dataLookups.js` | 39 |
| `src\logic\constants\proposalStatuses.js` | 39 |
| ... | +2 more |

### HIGH IMPACT (15-29 dependents) - Change with caution
14 files in this tier
- `src\islands\pages\SelfListingPage\types\listing.types.ts` (28 dependents)
- `src\islands\pages\ModifyListingsPage\shared\index.js` (23 dependents)
- `src\islands\shared\HostEditingProposal\types.js` (22 dependents)
- `src\lib\logger.js` (18 dependents)
- `src\lib\scheduleSelector\dayHelpers.js` (18 dependents)
- ... and 9 more

### CIRCULAR IMPORTS
No circular dependencies detected

### LEAF FILES (safe to refactor): 212 files
### TOPOLOGICAL LEVELS: 1 levels

Level distribution:
- Level 0: 825 files

## Refactoring Guidelines

Based on the dependency analysis above:
- **Leaf files (0 dependents)**: Safe to modify first
- **CIRCULAR IMPORTS**: Must be modified together as atomic unit
- **HIGH impact files (30+ dependents)**: Require careful consideration - changes cascade widely

## Your Task

1. **Read all .js and .jsx files** in `../app` recursively
2. **Identify refactoring opportunities**:
   - general issues
   - Anti-patterns (mutation, side effects, impure functions)
   - Code duplication
   - Missing abstractions
3. **Create a comprehensive implementation plan**

## Output Requirements

Create an implementation plan at: `adws/adw_plans/20260122031213_implementation_plan.md`

### Required Structure

```markdown
# Implementation Plan - ../app

**Date:** 2026-01-22
**Audit Type:** general
**Generated By:** Claude Opus (ADW Pipeline)

---

## Summary

| Metric | Value |
|--------|-------|
| Files to modify | [count] |
| Risk level | LOW / MEDIUM / HIGH |
| Estimated changes | [brief description] |

## Implementation Order

List files in dependency order (leaves first):
1. `path/to/leaf-file.js` - No dependents
2. `path/to/mid-file.js` - Depends on #1
3. `path/to/root-file.js` - Depends on #1, #2

---

## File Changes

### 1. `path/to/file.js`

**Reason:** [Why this file needs changes]
**Dependents:** [Files that import this - from dependency analysis]
**Risk:** LOW / MEDIUM / HIGH

#### Current Code
```javascript
// COMPLETE current code (not snippets)
```

#### Refactored Code
```javascript
// COMPLETE refactored code
```

#### Changes Made
- [Bullet point summary of changes]

---

### 2. `path/to/next-file.js`
... [repeat for each file]

---

## Verification Steps

After implementation, verify with:
1. `bun run lint` - Expect 0 errors
2. `bun run build` - Expect successful build
3. Visual check pages: [list affected pages]

## Rollback Plan

If validation fails, reset these files:
- `path/to/file1.js`
- `path/to/file2.js`
```

## CRITICAL RULES

1. **COMPLETE CODE BLOCKS**: Include the entire function/module, not snippets
2. **DEPENDENCY ORDER**: Follow the order from dependency analysis (leaves first)
3. **CASCADING CHANGES**: If you modify exports, include ALL importing files
4. **ATOMIC CYCLES**: Files in circular imports MUST all be in the plan
5. **NO PARTIAL PLANS**: Every file change must have both Current and Refactored code

## Progressive Disclosure

Use `/ralph-loop` to iterate until the plan is complete:
- First pass: Identify all files that need changes
- Second pass: Write Current Code sections
- Third pass: Write Refactored Code sections
- Fourth pass: Verify completeness and dependency order

When the plan is complete and saved to the output file, respond with:
```
PLAN COMPLETE: adws/adw_plans/20260122031213_implementation_plan.md
Files: [count]
Ready for implementation phase.
```
