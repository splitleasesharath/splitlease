/ralph-loop:ralph-loop

Audit the codebase at: {target_path}

## PRE-COMPUTED DEPENDENCY CONTEXT

The following dependency analysis was generated by AST parsing (100% accurate):

{semantic_context}

### How to Use This Context

1. **Symbol Table**: Shows what each file exports. When renaming a function, this tells you exactly where it's defined.

2. **Dependency Graph**: Shows what each file imports. Use this instead of scanning files yourself.

3. **Reverse Dependencies**: Shows who depends on each file. When modifying `pricing.js`, the reverse deps tell you EVERY file that imports from it.

**IMPORTANT**: Trust this dataâ€”it's machine-parsed, not inferred. Use it for:
- Identifying affected files (don't guess, look up in reverse_dependencies)
- Grouping cascading changes (all dependents of a modified file go together)
- Ordering chunks (files with no dependents can be modified first)

---

**Your Task:**

1. **Scan all files** in {target_path} recursively.
2. **Identify issues:** performance, maintainability, duplication, anti-patterns, or specifically {audit_type} issues.
3. **For each issue, determine affected pages:**
   - Use the provided dependency graph to identify affected files (do NOT re-scan files).
   - Use reverse_dependencies to find all consumers of modified code.
   - List page URLs (e.g., "/search, /view-split-lease").
   - If it's a shared utility or logic, identify all entry points via reverse deps.
   - If uncertain, use "AUTO".

4. **Create a chunk-based refactoring plan** at: .claude/plans/New/{timestamp}_code_refactor_plan.md

**CRITICAL: Group chunks by affected page group.**

Structure:
# Code Refactoring Plan - {target_path}

Date: {date}
Audit Type: {audit_type}

~~~~~

## PAGE GROUP: /search (Chunks: 1, 3)

### CHUNK 1: [Brief description]
**File:** [path]
**Line:** [line]
**Issue:** [description]
**Affected Pages:** /search

**Current Code:**
```javascript
[exact code]
```

**Refactored Code:**
```javascript
[refactored code]
```

**Testing:**
- [ ] [step]

~~~~~

### CHUNK 3: [Brief description]
...

~~~~~

## PAGE GROUP: /view-split-lease (Chunks: 2)
...

**CRITICAL FORMATTING RULES:**
1. **Group by PAGE GROUP** header.
2. **One chunk = one atomic fix**.
3. **Use horizontal rules (EXACTLY `~~~~~`)** to separate chunks.
4. **MANDATORY: Each chunk MUST have TWO complete code blocks (Current vs Refactored)**.
5. **Line numbers must be accurate**.
6. **Include affected pages in EACH chunk metadata**.
