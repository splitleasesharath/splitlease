# App Directory - LLM Reference

**GENERATED**: 2025-12-11
**SCOPE**: Frontend application root - Configuration, build tools, static assets, entry points
**OPTIMIZATION**: Semantic Searchability + Digestibility

---

## QUICK_STATS

[TOTAL_ROOT_FILES]: 9
[TOTAL_SUBDIRECTORIES]: 6
[PRIMARY_LANGUAGE]: JavaScript/TypeScript (React 18)
[BUILD_TOOL]: Vite 5.0
[ARCHITECTURE]: Islands Architecture
[DEPLOYMENT]: Cloudflare Pages
[KEY_PATTERNS]: Multi-page app, Route Registry, Islands pattern, ESM modules

---

## ROOT_FILES

### package.json
[INTENT]: NPM package configuration and dependency management
[TYPE]: ESM module (type: "module")
[SCRIPTS]: dev (port 8000), build, preview, generate-routes, prebuild
[DEPENDENCIES]: React 18, Supabase client, Google Maps React, date-fns, framer-motion, react-hook-form, zod, styled-components
[DEV_DEPENDENCIES]: Vite 5, @vitejs/plugin-react, esbuild, supabase CLI
[RUNTIME]: Bun preferred, Node compatible

### vite.config.js
[INTENT]: Vite bundler configuration for multi-page React application
[PLUGINS]: @vitejs/plugin-react, multi-page-routing middleware, move-html-to-root post-build
[ROUTING_LOGIC]: Shared routing function for dev and preview servers using Route Registry
[BUILD_INPUT]: 27 HTML entry points from public/ directory
[BUILD_OUTPUT]: dist/ with HTML at root, assets in dist/assets/
[DEV_SERVER]: Port 8000, localhost + 127.0.0.1, /api proxy to wrangler (port 8788)
[PREVIEW_SERVER]: Port 8000, 127.0.0.1
[POST_BUILD_TASKS]: Move HTML to dist root, copy assets/, copy _redirects, copy _headers, copy _routes.json, create _internal/ files, copy images/, copy help-center-articles/, copy functions/
[IMPORTS]: routes, getInternalRoutes, getBasePath, buildRollupInputs from src/routes.config.js

### tsconfig.json
[INTENT]: TypeScript compiler configuration for React app
[TARGET]: ES2020
[MODULE]: ESNext
[JSX]: react-jsx
[MODE]: Bundler mode resolution
[STRICT]: Disabled (strict: false)
[INCLUDE]: src directory
[ALLOW_JS]: true
[NO_EMIT]: true (type checking only, Vite handles compilation)

### tsconfig.node.json
[INTENT]: TypeScript configuration for Node.js scripts
[COMPOSITE]: true
[MODULE]: ESNext
[INCLUDE]: vite.config.js

### .env.example
[INTENT]: Environment variable template for local development
[REQUIRED_VARS]: VITE_SUPABASE_URL, VITE_SUPABASE_ANON_KEY, VITE_GOOGLE_MAPS_API_KEY
[OPTIONAL_VARS]: SLACK_WEBHOOK_ACQUISITION, SLACK_WEBHOOK_GENERAL
[REMOVED_VARS]: VITE_BUBBLE_API_BASE_URL, VITE_BUBBLE_API_KEY (migrated to Edge Functions)
[SECURITY_NOTE]: Bubble API keys now stored server-side in Supabase Secrets

### .gitignore
[INTENT]: Git ignore patterns
[IGNORED]: node_modules/, dist/, .env, .env.local, *.log, .DS_Store, ../input

### bun.lock
[INTENT]: Bun package manager lockfile
[PURPOSE]: Reproducible dependency installation

### .gitkeep-functions
[INTENT]: Placeholder to keep functions directory in git

---

## SUBDIRECTORIES

### src/
[INTENT]: React application source code
[CONTAINS]: Entry points (*.jsx), islands/, lib/, logic/, styles/, routes/, config/, data/
[ARCHITECTURE]: Islands Architecture with hollow components
[DOCUMENTATION]: C:\Users\Split Lease\Documents\Split Lease\app\src\CLAUDE.md
[ENTRY_POINTS]: 27 JSX files that mount React components to HTML pages
[KEY_SUBDIRS]: islands/ (React components), lib/ (utilities + API clients), logic/ (4-layer business logic), styles/ (CSS)

### public/
[INTENT]: Static assets and HTML templates for multi-page app
[CONTAINS]: HTML files, assets/, images/, help-center-articles/, _redirects, _headers, _routes.json
[HTML_FILES]: 27 files (index.html, search.html, view-split-lease.html, etc.)
[DEPLOYMENT_FILES]: _redirects (Cloudflare routing), _headers (HTTP headers), _routes.json (Functions control)
[GENERATED_FILES]: _redirects and _routes.json are auto-generated by scripts/generate-redirects.js
[COPY_BEHAVIOR]: Assets copied to dist/ during build, HTML files moved to dist root

### public/assets/
[INTENT]: Static media assets
[SUBDIRS]: fonts/, games/, icons/, images/, lotties/, resources/, videos/
[USAGE]: Referenced via /assets/ path in HTML/CSS

### public/images/
[INTENT]: Public image files
[CONTAINS]: support-centre-icon.svg
[USAGE]: Referenced via /images/ path

### public/help-center-articles/
[INTENT]: Static HTML help articles
[USAGE]: Served directly by Cloudflare Pages

### scripts/
[INTENT]: Build and development scripts
[FILES]: generate-redirects.js
[USAGE]: Executed via npm/bun scripts (prebuild hook)

### functions/
[INTENT]: Cloudflare Pages Functions (API routes)
[SUBDIRS]: api/
[FILES]: api/faq-inquiry.js
[DEPLOYMENT]: Automatically deployed to /api/* routes on Cloudflare Pages
[NOTE]: Most backend logic now uses Supabase Edge Functions, not Cloudflare Functions

### functions/api/
[INTENT]: Cloudflare Pages API endpoints
[FILES]: faq-inquiry.js, CLAUDE.md
[ROUTES]: /api/faq-inquiry
[STATUS]: Deprecated in favor of Supabase Edge Functions

### dist/
[INTENT]: Production build output (generated, not in git)
[STRUCTURE]: HTML at root, assets/ subdir, _internal/ subdir, functions/ copy
[CREATED_BY]: vite build command
[DEPLOYMENT_TARGET]: Cloudflare Pages

---

## ROUTING_SYSTEM

### src/routes.config.js
[INTENT]: Single source of truth for all application routes
[EXPORTS]: routes array, apiRoutes, excludedFromFunctions, getInternalRoutes(), getBasePath(), matchRoute(), findRouteForUrl(), buildRollupInputs()
[ROUTE_COUNT]: 27 routes
[ROUTE_TYPES]: Static pages, dynamic routes (:id, :userId, :category), protected routes, dev-only routes
[DYNAMIC_ROUTES]: /view-split-lease/:id, /preview-split-lease/:id, /guest-proposals/:userId, /account-profile/:userId, /host-proposals/:userId, /help-center/:category
[PROTECTED_ROUTES]: /preview-split-lease, /guest-proposals, /account-profile, /host-proposals, /self-listing, /listing-dashboard, /host-overview, /favorite-listings, /rental-application
[CLOUDFLARE_INTERNAL]: Routes using _internal/ directory to avoid 308 redirects
[USAGE]: Consumed by vite.config.js, scripts/generate-redirects.js

### scripts/generate-redirects.js
[INTENT]: Generate Cloudflare Pages routing files from Route Registry
[EXECUTION]: prebuild hook (bun run generate-routes)
[GENERATES]: public/_redirects, public/_routes.json
[INPUT]: src/routes.config.js
[VALIDATION]: Checks for duplicate paths, missing fields, cloudflareInternal consistency
[OUTPUT_FORMAT]: _redirects (Cloudflare rewrite syntax), _routes.json (Functions control)

### public/_redirects
[INTENT]: Cloudflare Pages routing configuration
[GENERATED_BY]: scripts/generate-redirects.js
[SYNTAX]: Cloudflare Pages redirects format
[PATTERN]: path /_internal/name 200 OR path /file.html 200
[DYNAMIC_HANDLING]: Use _internal/ files to prevent Cloudflare's 308 redirects
[AUTO_GENERATED]: DO NOT EDIT MANUALLY

### public/_routes.json
[INTENT]: Control which routes use Cloudflare Functions
[GENERATED_BY]: scripts/generate-redirects.js
[INCLUDE]: /api/* (Cloudflare Functions)
[EXCLUDE]: /guest-proposals, /guest-proposals/*, /host-proposals, /host-proposals/*
[VERSION]: 1

---

## BUILD_PROCESS

### Development
[COMMAND]: bun run dev
[PORT]: 8000
[SERVER]: Vite dev server with HMR
[MIDDLEWARE]: Multi-page routing middleware using Route Registry
[PUBLIC_PREFIX]: /public (proxied to public/ directory)
[API_PROXY]: /api/* proxied to localhost:8788 (wrangler)

### Production Build
[COMMAND]: bun run build
[STEPS]: 1) Prebuild (generate routes), 2) Vite build, 3) Post-build (move HTML, copy assets)
[OUTPUT]: dist/ directory
[HTML_LOCATION]: dist root (e.g., dist/index.html)
[ASSETS_LOCATION]: dist/assets/ with hashed filenames
[INTERNAL_FILES]: dist/_internal/ (copies of HTML files for Cloudflare routing)
[COPIED_DIRS]: assets/, images/, help-center-articles/, functions/
[COPIED_FILES]: _redirects, _headers, _routes.json

### Preview
[COMMAND]: bun run preview
[PORT]: 8000
[SERVER]: Vite preview server (serves dist/)
[MIDDLEWARE]: Multi-page routing middleware using Route Registry
[PUBLIC_PREFIX]: Empty string (serves from dist root)

---

## DEPLOYMENT

### Platform
[TARGET]: Cloudflare Pages
[BUILD_COMMAND]: bun run build
[OUTPUT_DIR]: dist
[NODE_VERSION]: 18 or higher
[FRAMEWORK_PRESET]: None (custom Vite config)

### Routing Strategy
[METHOD]: Cloudflare _redirects file + _internal directory
[WHY_INTERNAL]: Avoid Cloudflare's "pretty URL" 308 redirects that strip query params/hash
[DYNAMIC_ROUTES]: Rewrite to _internal/route-name files
[STATIC_ROUTES]: Some use _internal/, some direct to .html

### Functions
[CLOUDFLARE_FUNCTIONS]: /api/* (legacy, deprecated)
[SUPABASE_EDGE_FUNCTIONS]: Preferred for all backend logic
[EXCLUDED_ROUTES]: /guest-proposals/*, /host-proposals/* (no Functions processing)

---

## ENTRY_POINTS

### HTML Templates (public/*.html)
[COUNT]: 27 files
[PURPOSE]: Shell pages that load React apps
[PATTERN]: <div id="root"></div> + <script type="module" src="/src/ENTRY.jsx"></script>
[BUILD_BEHAVIOR]: Vite processes, outputs to dist root with hashed asset references

### React Entry Points (src/*.jsx)
[COUNT]: 27 files
[PATTERN]: Import page component, createRoot, render to #root
[EXAMPLES]: main.jsx → HomePage, search.jsx → SearchPage, view-split-lease.jsx → ViewSplitLeasePage

### Entry Point Mapping
[HOMEPAGE]: index.html ← src/main.jsx ← HomePage
[SEARCH]: search.html ← src/search.jsx ← SearchPage
[LISTING_VIEW]: view-split-lease.html ← src/view-split-lease.jsx ← ViewSplitLeasePage
[LISTING_PREVIEW]: preview-split-lease.html ← src/preview-split-lease.jsx ← PreviewSplitLeasePage
[GUEST_PROPOSALS]: guest-proposals.html ← src/guest-proposals.jsx ← GuestProposalsPage
[HOST_PROPOSALS]: host-proposals.html ← src/host-proposals.jsx ← HostProposalsPage
[SELF_LISTING]: self-listing.html ← src/self-listing.jsx ← SelfListingPage
[SELF_LISTING_V2]: self-listing-v2.html ← src/self-listing-v2.jsx ← SelfListingPageV2
[LISTING_DASHBOARD]: listing-dashboard.html ← src/listing-dashboard.jsx ← ListingDashboardPage
[HOST_OVERVIEW]: host-overview.html ← src/host-overview.jsx ← HostOverviewPage
[ACCOUNT_PROFILE]: account-profile.html ← src/account-profile.jsx ← AccountProfilePage
[FAQ]: faq.html ← src/faq.jsx ← FAQPage
[HELP_CENTER]: help-center.html ← src/help-center.jsx ← HelpCenterPage
[HELP_CATEGORY]: help-center-category.html ← src/help-center-category.jsx ← HelpCenterCategoryPage
[POLICIES]: policies.html ← src/policies.jsx ← PoliciesPage
[CAREERS]: careers.html ← src/careers.jsx ← CareersPage
[ABOUT_US]: about-us.html ← src/about-us.jsx ← AboutUsPage
[LIST_WITH_US]: list-with-us.html ← src/list-with-us.jsx ← ListWithUsPage
[WHY_SPLIT_LEASE]: why-split-lease.html ← src/why-split-lease.jsx ← WhySplitLeasePage
[GUEST_SUCCESS]: guest-success.html ← src/guest-success.jsx ← GuestSuccessPage
[HOST_SUCCESS]: host-success.html ← src/host-success.jsx ← HostSuccessPage
[FAVORITE_LISTINGS]: favorite-listings.html ← src/favorite-listings.jsx ← FavoriteListingsPage
[RENTAL_APPLICATION]: rental-application.html ← src/rental-application.jsx ← RentalApplicationPage
[RESET_PASSWORD]: reset-password.html ← src/reset-password.jsx ← ResetPasswordPage
[NOT_FOUND]: 404.html ← src/404.jsx ← NotFoundPage
[SEARCH_TEST]: search-test.html ← src/search-test.jsx ← SearchPageTest
[INTERNAL_TEST]: _internal-test.html ← src/_internal-test.jsx ← InternalTestPage

---

## ARCHITECTURE_PATTERNS

### Islands Architecture
[DESCRIPTION]: Each HTML page is an independent React root
[BENEFIT]: No shared state between pages, simpler mental model
[NAVIGATION]: Full page loads (no client-side routing)
[STATE_PERSISTENCE]: URL params, localStorage, Supabase database

### Route Registry Pattern
[DESCRIPTION]: Single source of truth for all routes in src/routes.config.js
[CONSUMERS]: Vite dev server, Vite preview, Cloudflare _redirects, Vite build inputs
[BENEFIT]: Change route once, updates everywhere
[VALIDATION]: Automated checks in generate-redirects.js

### Cloudflare _internal Pattern
[DESCRIPTION]: Copy HTML files to dist/_internal/ with custom names
[WHY]: Avoid Cloudflare's automatic 308 redirects that strip query params/hash
[USAGE]: Dynamic routes and pages needing query/hash preservation
[EXAMPLE]: /search → /_internal/search-view

### Hollow Component Pattern
[DESCRIPTION]: Page components delegate all logic to custom hooks
[BENEFIT]: Testable business logic, focused UI components
[LOCATION]: src/islands/pages/
[EXAMPLE]: ViewSplitLeasePage.jsx (UI only) + useViewSplitLeasePageLogic.js (logic)

### Four-Layer Logic Architecture
[DESCRIPTION]: Business logic separated into calculators, rules, processors, workflows
[LOCATION]: src/logic/
[LAYER_1]: Calculators (pure math functions: calculate*, get*)
[LAYER_2]: Rules (boolean predicates: can*, is*, has*, should*)
[LAYER_3]: Processors (data transformation: adapt*, extract*, process*, format*)
[LAYER_4]: Workflows (orchestration: *Workflow)
[BENEFIT]: Reusable, testable, maintainable business logic

---

## ENVIRONMENT_VARIABLES

### Frontend (VITE_ prefix)
[VITE_SUPABASE_URL]: Supabase project URL (from Supabase dashboard)
[VITE_SUPABASE_ANON_KEY]: Supabase anonymous key (public, safe for client)
[VITE_GOOGLE_MAPS_API_KEY]: Google Maps JavaScript API key

### Backend (Supabase Secrets)
[BUBBLE_API_BASE_URL]: Bubble.io API endpoint (legacy backend)
[BUBBLE_API_KEY]: Bubble.io API authentication
[OPENAI_API_KEY]: OpenAI API for AI features
[SUPABASE_SERVICE_ROLE_KEY]: Supabase admin key (server-side only)

### Configuration Location
[FRONTEND_ENV]: app/.env (local), Cloudflare Pages settings (production)
[BACKEND_SECRETS]: Supabase Dashboard → Project Settings → Edge Functions Secrets
[SECURITY]: Never expose Bubble/OpenAI keys in frontend code

---

## CRITICAL_CONVENTIONS

### Day Indexing
[JS_FORMAT]: 0-6 (Sunday=0, Monday=1, ..., Saturday=6)
[BUBBLE_FORMAT]: 1-7 (Sunday=1, Monday=2, ..., Saturday=7)
[CONVERSION_FUNCTIONS]: adaptDaysFromBubble(), adaptDaysToBubble()
[LOCATION]: src/logic/processors/external/
[RULE]: Always convert at API boundaries, never mix formats

### Unique ID Generation
[METHOD]: Supabase RPC function generate_bubble_id
[USAGE]: const { data: newId } = await supabaseAdmin.rpc('generate_bubble_id')
[FORMAT]: 17-character alphanumeric string (Bubble-compatible)

### API Architecture
[FRONTEND_TO_BACKEND]: Frontend → Supabase Edge Functions → Bubble API
[DIRECT_SUPABASE]: Frontend → Supabase Database (for Supabase-native tables)
[NEVER]: Frontend → Bubble API directly (security violation)

---

## DO_RULES

[DO_USE_ROUTE_REGISTRY]: Always update src/routes.config.js for route changes
[DO_GENERATE_ROUTES]: Run bun run generate-routes after route config changes
[DO_USE_EDGE_FUNCTIONS]: Proxy all Bubble API calls through Supabase Edge Functions
[DO_STORE_SECRETS]: Keep API keys in Supabase Secrets, never in frontend
[DO_COMMIT_CHANGES]: Git commit after each logical change (per project instructions)
[DO_USE_ESM]: Use ES modules (import/export), not CommonJS
[DO_USE_BUN]: Prefer bun for package management and script execution
[DO_USE_HOLLOW_PATTERN]: Keep page components minimal, delegate logic to hooks
[DO_USE_FOUR_LAYERS]: Organize business logic into calculators/rules/processors/workflows
[DO_CONVERT_DAYS]: Use adaptDaysFromBubble/adaptDaysToBubble at API boundaries

---

## DONT_RULES

[DONT_EDIT_GENERATED]: Never manually edit _redirects or _routes.json (auto-generated)
[DONT_EXPOSE_KEYS]: Never put Bubble/OpenAI API keys in frontend code or .env
[DONT_SKIP_VALIDATION]: Always run generate-redirects.js validation before deploying
[DONT_CALL_BUBBLE_DIRECTLY]: Never call Bubble API from frontend (security risk)
[DONT_MIX_DAY_FORMATS]: Never use 0-based and 1-based days in same function
[DONT_PUSH_FORCE]: Never git push --force to main/master
[DONT_ADD_FALLBACKS]: No fallback mechanisms when encountering errors (per project philosophy)
[DONT_OVER_ENGINEER]: Match solution to actual scale, not hypothetical future needs
[DONT_MODIFY_DB]: Never modify Supabase tables without explicit instruction

---

## RELATED_DOCUMENTATION

[PROJECT_ROOT]: C:\Users\Split Lease\Documents\Split Lease\.claude\CLAUDE.md
[SOURCE_CODE]: C:\Users\Split Lease\Documents\Split Lease\app\src\CLAUDE.md
[SUPABASE]: C:\Users\Split Lease\Documents\Split Lease\supabase\CLAUDE.md
[DATABASE_SCHEMA]: C:\Users\Split Lease\Documents\Split Lease\DATABASE_SCHEMA_OVERVIEW.md
[ROUTING_GUIDE]: C:\Users\Split Lease\Documents\Split Lease\.claude\Documentation\Routing\ROUTING_GUIDE.md
